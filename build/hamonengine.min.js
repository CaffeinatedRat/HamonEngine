/*
 Hamonengine 波紋
 Copyright (c) 2020, CaffeinatedRat.
 All rights reserved.
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

     * Redistributions of source code must retain the above copyright
       notice, this list of conditions and the following disclaimer.
     * Redistributions in binary form must reproduce the above copyright
       notice, this list of conditions and the following disclaimer in the
       documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY
 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE AUTHOR AND CONTRIBUTORS BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if("prototype"!=d)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(m){c.reject(m)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(q){f(q)}}:b}var d,f,h=new e(function(a,
b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return h};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,
d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){h[b]=c;g--;0==g&&a(h)}}var h=[],g=0;do h.push(void 0),g++,c(d.value).callWhenSettled_(f(h.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function c(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(m){return!1}}())return a;var d="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var e=0,f=function(a){this.id_=(e+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};f.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};f.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};f.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};f.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return f},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(p){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,b){var c=d(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};c.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};c.prototype.has=function(a){return!!d(this,a).entry};c.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};c.prototype.entries=function(){return e(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return e(this,function(a){return a.key})};c.prototype.values=function(){return e(this,function(a){return a.value})};c.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(a,c){var d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++g,b.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=
e[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},e=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=a.next=a.head=a},g=0;return c},"es6","es3");
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),d=new a($jscomp.makeIterator([b]));if(!d.has(b)||1!=d.size||d.add(b)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=b||f.value[1]!=b)return!1;f=e.next();return f.done||f.value[0]==b||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:e.next().done}catch(g){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return b},"es6","es3");var hamonengine={debug:!1};hamonengine.util=hamonengine.util||{};
(function(){hamonengine.util.fpscounter=function(a){this._spf=this._fps=this._frameCounter=this._globalStartTime=0;this._minFPS=1E3;this._maxFPS=0};hamonengine.util.fpscounter.prototype.start=function(){this._globalStartTime=Date.now();this._spf=this._fps=this._frameCounter=0;this._minFPS=1E3;this._maxFPS=0};hamonengine.util.fpscounter.prototype.begin=function(){this._frameStartTime=Date.now()};hamonengine.util.fpscounter.prototype.end=function(){if(0===this._startTime)throw"[hamonengine.util.fpsCounter.end] Begin was not called before end.";var a=
Date.now();this._frameCounter++;this._spf=1E3*(a-this._frameStartTime);a>this._globalStartTime+1E3&&(this._fps=Math.round(1E3*this._frameCounter/(a-this._globalStartTime)),this._minFPS=Math.min(this._minFPS,this._fps),this._maxFPS=Math.max(this._maxFPS,this._fps),this._globalStartTime=a,this._frameCounter=0)};$jscomp.global.Object.defineProperties(hamonengine.util.fpscounter.prototype,{SPF:{configurable:!0,enumerable:!0,get:function(){return this._spf}},FPS:{configurable:!0,enumerable:!0,get:function(){return this._fps}},
minFPS:{configurable:!0,enumerable:!0,get:function(){return this._minFPS}},maxFPS:{configurable:!0,enumerable:!0,get:function(){return this._maxFPS}}})})();var LOG_TYPE={DISABLED:0,INFO:1,WARNING:2,CRITICAL:4,DEBUG:8,ALL:15};hamonengine.util=hamonengine.util||{loggerlevel:LOG_TYPE.DISABLED};
(function(){hamonengine.util.logger=function(){};hamonengine.util.logger.debug=function(a){(hamonengine.util.loggerlevel&LOG_TYPE.DEBUG)===LOG_TYPE.DEBUG&&console.log(a)};hamonengine.util.logger.info=function(a){(hamonengine.util.loggerlevel&LOG_TYPE.INFO)===LOG_TYPE.INFO&&console.info(a)};hamonengine.util.logger.warning=function(a){(hamonengine.util.loggerlevel&LOG_TYPE.WARNING)===LOG_TYPE.WARNING&&console.warn(a)};hamonengine.util.bitwise=function(){};hamonengine.util.bitwise.toggle=function(a,
b,c){return void 0!==c?c?a|1<<b:a&~(1<<b):a^1<<b};hamonengine.util.bitwise.isSet=function(a,b){b=1<<b;return(a&b)===b};Object.prototype.forEach=function(a){var b=this;a&&Object.keys(this).forEach(function(c){b.hasOwnProperty(c)&&a(c,b[c])})}})();hamonengine.math=hamonengine.math||{};(function(){Math.PI2=6.283185307179586;Math.PI3_2=3*Math.PI/2;Math.PI_2=Math.PI/2;Math.HalfPI=1.5707963267948966;Math.QuarterPI=4.71238898038469;Math.maxInt32=2147483647;Math.maxUInt32=4294967296;Math.bitRound=function(a){return.5+a<<0};Math.truncate=function(a){return a>=Math.maxInt32?Math.maxInt32:~~a};Math.sqr=function(a){return a*a};Math.toDegrees=function(a){return a*Math.PI/180};Math.toRadians=function(a){return 180*a/Math.PI}})();hamonengine.math=hamonengine.math||{};
(function(){hamonengine.math.sort=function(a){a=void 0===a?{}:a;this._compareFunc=a.compareFunc?a.compareFunc:hamonengine.math.sort.sort.ascending};hamonengine.math.sort.prototype.quickSort=function(a){hamonengine.math.sort.iquicksort(this._compareFunc,a,0,a.length-1)};hamonengine.math.sort.ascending=function(a,b){return a===b?0:a<b?-1:1};hamonengine.math.sort.descending=function(a,b){return a===b?0:a<b?1:-1};hamonengine.math.sort.iquicksort=function(a,b,c,d){for(var e=c,f=d,g=b[Math.truncate((c+
d)/2)];e<=f;){for(;0>a(b[e],g);)e++;for(;0<a(b[f],g);)f--;if(e<=f){var h=b[e];b[e]=b[f];b[f]=h;e++;f--}}c<f&&hamonengine.math.sort.iquicksort(a,b,c,f);e<d&&hamonengine.math.sort.iquicksort(a,b,e,d)}})();hamonengine.math=hamonengine.math||{};(function(){var a=Math.maxUInt32;hamonengine.math.LCGRandom=function(a){this._seed=a};hamonengine.math.LCGRandom.prototype.random=function(){return this._seed=(214013*this._seed+2531011)%a}})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.line=function(a,b){this.min=void 0===a?0:a;this.max=void 0===b?0:b};hamonengine.geometry.line.clone=function(a){return new hamonengine.geometry.line(a.min,a.max)};hamonengine.geometry.line.prototype.clone=function(){return hamonengine.geometry.line.clone(this)};hamonengine.geometry.line.prototype.toString=function(){return"{min: '"+this.min+"', max: '"+this.max+"'}"};hamonengine.geometry.line.prototype.mirror=function(){return new hamonengine.geometry.line(this.max,this.min)};
hamonengine.geometry.line.prototype.add=function(a){return new hamonengine.geometry.line(this.min+a.min,this.max+a.max)};hamonengine.geometry.line.prototype.subtract=function(a){return new hamonengine.geometry.line(this.min-a.min,this.max-a.max)};hamonengine.geometry.line.prototype.multiplyScalar=function(a){return new hamonengine.geometry.line(this.min*a,this.max*a)};hamonengine.geometry.line.prototype.overlap=function(a){var b=function(a,b){return a>=b.min&&a<=b.max},c=NaN;b(this.min,a)?c=this.min:
b(a.min,this)&&(c=a.min);var d=NaN;b(this.max,a)?d=this.max:b(a.max,this)&&(d=a.max);return new hamonengine.geometry.line(c,d)};$jscomp.global.Object.defineProperties(hamonengine.geometry.line.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this.max-this.min}},isLine:{configurable:!0,enumerable:!0,get:function(){return!isNaN(this.min)&&!isNaN(this.max)}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.polygon=function(a){a=void 0===a?{}:a;a instanceof hamonengine.geometry.polygon&&(a={vertices:a.vertices});this._vertices=a.vertices||[];this._edges=[];this._normals=[];this._dimensions={center:null,max:null,min:null};this._dirty=15;this._shapeType=SHAPE_TYPE.UNKNOWN};hamonengine.geometry.polygon.prototype.clone=function(){return new hamonengine.geometry.polygon(this)};hamonengine.geometry.polygon.prototype.toString=function(){for(var a="",b=0;b<this._vertices.length;b++)a+=
""+(""!==a?",":"")+this._vertices[b].toString();return"["+a+"]"};hamonengine.geometry.polygon.prototype.toRect=function(){return new hamonengine.geometry.rect(this.min.x,this.min.y,this.max.x-this.min.x,this.max.y-this.min.y)};hamonengine.geometry.polygon.prototype.addVertex=function(a,b){this._vertices.push(new hamonengine.geometry.vector2(a,b));this._dirty=15};hamonengine.geometry.polygon.prototype.translate=function(a){a=a||new hamonengine.geometry.vector2(0,0);for(var b=[],c=0;c<this.vertices.length;c++)b.push(this.vertices[c].add(a));
return new hamonengine.geometry.polygon({vertices:b})};hamonengine.geometry.polygon.prototype.rotate=function(a,b){var c=Math.sin(a);a=Math.cos(a);b=b||new hamonengine.geometry.vector2(0,0);for(var d=[],e=0;e<this.vertices.length;e++){var f=this.vertices[e].x-b.x,g=this.vertices[e].y-b.y;d.push(new hamonengine.geometry.vector2(f*a-g*c+b.x,f*c+g*a+b.y))}return new hamonengine.geometry.polygon({vertices:d})};hamonengine.geometry.polygon.prototype.rotateAtCenter=function(a){return this.rotate(a,this.center)};
hamonengine.geometry.polygon.prototype.scale=function(a){a=a||new hamonengine.geometry.vector2(0,0);for(var b=[],c=0;c<this.vertices.length;c++)b.push(this.vertices[c].multiplyVector(a));return new hamonengine.geometry.polygon({vertices:b})};hamonengine.geometry.polygon.prototype.isCollision=function(a){return a instanceof hamonengine.geometry.rect?this.isCollisionRect(a):a instanceof hamonengine.geometry.polygon?this.isCollisionPolygon(a):new hamonengine.geometry.vector2(0,0)};hamonengine.geometry.polygon.prototype.isCollisionPolygon=
function(a){if(!(a instanceof hamonengine.geometry.polygon))throw"Parameter polygon is not of type hamonengine.geometry.polygon.";for(var b=NaN,c,d=a.normals,e=0;e<d.length;e++){var f=this.project(d[e]),g=a.project(d[e]);f=f.overlap(g);if(!f.isLine)return new hamonengine.geometry.vector2;if(isNaN(b)||f.length<b)b=f.length,c=d[e]}d=this.normals;for(e=0;e<d.length;e++){f=this.project(d[e]);g=a.project(d[e]);f=f.overlap(g);if(!f.isLine)return new hamonengine.geometry.vector2;if(isNaN(b)||f.length<b)b=
f.length,c=d[e]}return c.multiply(b)};hamonengine.geometry.polygon.prototype.isCollisionRect=function(a){return a.toPolygon().isCollision(this)};hamonengine.geometry.polygon.prototype.isContained=function(a,b){b instanceof hamonengine.geometry.polygon||hamonengine.util.logger.warning("[hamonengine.geometry.polygon.isContained] The polygon parameter is not of type hamonengine.geometry.polygon!");return new hamonengine.geometry.vector2};hamonengine.geometry.polygon.prototype.project=function(a){var b=
0,c=0;if(0<this.vertices.length){c=b=a.dot(this.vertices[0]);for(var d=1;d<this.vertices.length;d++){var e=a.dot(this.vertices[d]);e<b?b=e:e>c&&(c=e)}}return new hamonengine.geometry.line(b,c)};hamonengine.geometry.polygon.calcEdges=function(a){a=void 0===a?[]:a;for(var b=[],c=0;c<a.length;c++)b.push(a[(c+1)%a.length].subtract(a[c]));return b};hamonengine.geometry.polygon.calcNormals=function(a){a=void 0===a?[]:a;return a.map(function(a){return a.normal()})};hamonengine.geometry.polygon.calcDimensions=
function(a){a=void 0===a?[]:a;for(var b=NaN,c=NaN,d=NaN,e=NaN,f=0;f<a.length;f++)b=b>a[f].x?b:a[f].x,c=c<a[f].x?c:a[f].x,d=d>a[f].y?d:a[f].y,e=e<a[f].y?e:a[f].y;return{max:new hamonengine.geometry.vector2(b,d),min:new hamonengine.geometry.vector2(c,e),center:new hamonengine.geometry.vector2((b-c)/2,(d-e)/2)}};hamonengine.geometry.polygon.calcShapeType=function(a){a=void 0===a?[]:a;for(var b=0,c=0;c<a.length;c++){var d=a[(c+1)%a.length],e=a[(c+2)%a.length],f=d.subtract(a[c]);d=e.subtract(d);b+=0<d.cross(f).z?
1:-1}return a.length===b?SHAPE_TYPE.CONVEX:SHAPE_TYPE.CONCAVE};$jscomp.global.Object.defineProperties(hamonengine.geometry.polygon.prototype,{vertices:{configurable:!0,enumerable:!0,get:function(){return this._vertices}},edges:{configurable:!0,enumerable:!0,get:function(){hamonengine.util.bitwise.isSet(this._dirty,2)&&(this._edges=hamonengine.geometry.polygon.calcEdges(this.vertices),hamonengine.util.bitwise.toggle(this._dirty,2,!1));return this._edges}},normals:{configurable:!0,enumerable:!0,get:function(){hamonengine.util.bitwise.isSet(this._dirty,
0)&&(this._normals=hamonengine.geometry.polygon.calcNormals(this.edges),hamonengine.util.bitwise.toggle(this._dirty,0,!1));return this._normals}},center:{configurable:!0,enumerable:!0,get:function(){hamonengine.util.bitwise.isSet(this._dirty,1)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),hamonengine.util.bitwise.toggle(this._dirty,1,!1));return this._dimensions.center}},max:{configurable:!0,enumerable:!0,get:function(){hamonengine.util.bitwise.isSet(this._dirty,1)&&
(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),hamonengine.util.bitwise.toggle(this._dirty,1,!1));return this._dimensions.max}},min:{configurable:!0,enumerable:!0,get:function(){hamonengine.util.bitwise.isSet(this._dirty,1)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),hamonengine.util.bitwise.toggle(this._dirty,1,!1));return this._dimensions.min}},width:{configurable:!0,enumerable:!0,get:function(){return this.max.x-this.min.x}},height:{configurable:!0,
enumerable:!0,get:function(){return this.max.y-this.min.y}},shapeType:{configurable:!0,enumerable:!0,get:function(){hamonengine.util.bitwise.isSet(this._dirty,3)&&(this._shapeType=hamonengine.geometry.polygon.calcShapeType(this.vertices),hamonengine.util.bitwise.toggle(this._dirty,3,!1));return this._shapeType}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.rect=function(a,b,c,d){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.width=void 0===c?0:c;this.height=void 0===d?0:d};hamonengine.geometry.rect.prototype.clone=function(){return new hamonengine.geometry.rect(this.x,this.y,this.width,this.height)};hamonengine.geometry.rect.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"};hamonengine.geometry.rect.prototype.toPolygon=function(){return new hamonengine.geometry.polygon({vertices:[new hamonengine.geometry.vector2(this.x,
this.y),new hamonengine.geometry.vector2(this.x+this.width,this.y),new hamonengine.geometry.vector2(this.x+this.width,this.y+this.height),new hamonengine.geometry.vector2(this.x,this.y+this.height)]})};hamonengine.geometry.rect.prototype.isCollision=function(a){return a instanceof hamonengine.geometry.rect?this.isCollisionRect(a):a instanceof hamonengine.geometry.polygon?this.isCollisionPolygon(a):new hamonengine.geometry.vector2(0,0)};hamonengine.geometry.rect.prototype.isCollisionRect=function(a){a instanceof
hamonengine.geometry.rect||hamonengine.util.logger.warning("[hamonengine.geometry.rect.isCollision] The otherRect parameter is not of type hamonengine.geometry.rect!");var b=NaN,c=new hamonengine.geometry.line(this.y,this.y+this.height),d=new hamonengine.geometry.line(a.y,a.y+a.height);c=c.overlap(d);if(!c.isLine)return new hamonengine.geometry.vector2;if(isNaN(b)||c.length<b){b=c.length;var e=hamonengine.geometry.vector2.Y_AXIS_NORMAL}c=new hamonengine.geometry.line(this.x,this.x+this.width);a=new hamonengine.geometry.line(a.x,
a.x+a.width);a=c.overlap(a);if(!a.isLine)return new hamonengine.geometry.vector2;if(isNaN(b)||a.length<b)b=a.length,e=hamonengine.geometry.vector2.X_AXIS_NORMAL;return e.multiply(b)};hamonengine.geometry.rect.prototype.isCollisionPolygon=function(a){return a.isCollision(this.toPolygon())};hamonengine.geometry.rect.prototype.isContained=function(a,b){b instanceof hamonengine.geometry.rect||hamonengine.util.logger.warning("[hamonengine.geometry.rect.isContained] The rect parameter is not of type hamonengine.geometry.rect!");
var c=new hamonengine.geometry.vector2,d=a.x+b.x,e=a.y+b.y;d<this.x?(hamonengine.util.logger.debug("[hamonengine.geometry.rect.isContained] Outside -x: ("+d+", "+e+")"),c.x=-1):a.x+b.right>this.right&&(hamonengine.util.logger.debug("[hamonengine.geometry.rect.isContained] Outside +x: ("+d+", "+e+")"),c.x=1);e<this.y?(hamonengine.util.logger.debug("[hamonengine.geometry.rect.isContained] Outside -y: ("+d+", "+e+")"),c.y=-1):a.y+b.bottom>this.bottom&&(hamonengine.util.logger.debug("[hamonengine.geometry.rect.isContained] Outside +y: ("+
d+", "+e+")"),c.y=1);return c};$jscomp.global.Object.defineProperties(hamonengine.geometry.rect.prototype,{right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height}}})})();hamonengine.geometry=hamonengine.geometry||{};var COLLISION_TYPES={NONE:0,EDGE:1,INSIDE:2},COORDINATE_SYSTEM={LEFT:0,RIGHT:1},SHAPE_TYPE={UNKNOWN:0,CONVEX:1,CONCAVE:2};hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.vector2=function(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b};hamonengine.geometry.vector2.clone=function(a){return new hamonengine.geometry.vector2(a.x,a.y)};hamonengine.geometry.vector2.prototype.clone=function(){return hamonengine.geometry.vector2.clone(this)};hamonengine.geometry.vector2.prototype.toString=function(){return"{x: '"+this.x+"', y: '"+this.y+"'}"};hamonengine.geometry.vector2.prototype.normalize=function(){var a=this.length;return 0<a?new hamonengine.geometry.vector2(this.x/
a,this.y/a):new hamonengine.geometry.vector2};hamonengine.geometry.vector2.prototype.normal=function(a){a=void 0===a?COORDINATE_SYSTEM.LEFT:a;var b=this.length;return a===COORDINATE_SYSTEM.LEFT?new hamonengine.geometry.vector2(-this.y/b,this.x/b):new hamonengine.geometry.vector2(this.y/b,-this.x/b)};hamonengine.geometry.vector2.prototype.mirror=function(){return new hamonengine.geometry.vector2(-this.x,this.y)};hamonengine.geometry.vector2.prototype.flip=function(){return new hamonengine.geometry.vector2(this.x,
-this.y)};hamonengine.geometry.vector2.prototype.invert=function(){return new hamonengine.geometry.vector2(-this.x,-this.y)};hamonengine.geometry.vector2.prototype.add=function(a){return new hamonengine.geometry.vector2(this.x+a.x,this.y+a.y)};hamonengine.geometry.vector2.prototype.subtract=function(a){return new hamonengine.geometry.vector2(this.x-a.x,this.y-a.y)};hamonengine.geometry.vector2.prototype.multiply=function(a){return a instanceof hamonengine.geometry.vector2?this.multiplyVector(a):this.multiplyScalar(a)};
hamonengine.geometry.vector2.prototype.multiplyScalar=function(a){return new hamonengine.geometry.vector2(this.x*a,this.y*a)};hamonengine.geometry.vector2.prototype.multiplyVector=function(a){return new hamonengine.geometry.vector2(this.x*a.x,this.y*a.y)};hamonengine.geometry.vector2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};hamonengine.geometry.vector2.prototype.cross=function(a){return new hamonengine.geometry.vector3(0,0,this.x*a.y-this.y*a.x)};hamonengine.geometry.vector2.prototype.equals=
function(a){return this.x===a.x&&this.y===a.y};$jscomp.global.Object.defineProperties(hamonengine.geometry.vector2.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},theta:{configurable:!0,enumerable:!0,get:function(){return(Math.atan2(this.y,this.x)+Math.PI2)%Math.PI2}}});hamonengine.geometry.vector2.X_AXIS_NORMAL=new hamonengine.geometry.vector2(1,0);hamonengine.geometry.vector2.Y_AXIS_NORMAL=new hamonengine.geometry.vector2(0,1)})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.vector3=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};hamonengine.geometry.vector3.clone=function(a){return new hamonengine.geometry.vector3(a.x,a.y,a.z)};hamonengine.geometry.vector3.prototype.clone=function(){return hamonengine.geometry.vector3.clone(this)};hamonengine.geometry.vector3.prototype.toString=function(){return"{x: '"+this.x+"', y: '"+this.y+"', z: '"+this.z+"'}"};hamonengine.geometry.vector3.prototype.normalize=function(){var a=
this.length;return 0<a?new hamonengine.geometry.vector3(this.x/a,this.y/a,this.z/a):new hamonengine.geometry.vector3};hamonengine.geometry.vector3.prototype.invert=function(){return new hamonengine.geometry.vector2(-this.x,-this.y,-this.z)};hamonengine.geometry.vector3.prototype.add=function(a){return new hamonengine.geometry.vector3(this.x+a.x,this.y+a.y,this.z+a.z)};hamonengine.geometry.vector3.prototype.subtract=function(a){return new hamonengine.geometry.vector3(this.x-a.x,this.y-a.y,this.z-a.z)};
hamonengine.geometry.vector3.prototype.multiplyScalar=function(a){return new hamonengine.geometry.vector3(this.x*a,this.y*a,this.z*a)};hamonengine.geometry.vector3.prototype.multiplyVector=function(a){return new hamonengine.geometry.vector3(this.x*a.x,this.y*a.y,this.z*a.z)};hamonengine.geometry.vector3.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};hamonengine.geometry.vector3.prototype.cross=function(a){return new hamonengine.geometry.vector3(this.y*a.z-this.z*a.y,a.x*this.z-
this.x*a.z,this.x*a.y-this.y*a.x)};hamonengine.geometry.vector3.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};$jscomp.global.Object.defineProperties(hamonengine.geometry.vector3.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}});hamonengine.geometry.vector3.X_AXIS_NORMAL=new hamonengine.geometry.vector3(1,0,0);hamonengine.geometry.vector3.Y_AXIS_NORMAL=new hamonengine.geometry.vector3(0,1,
0);hamonengine.geometry.vector3.Z_AXIS_NORMAL=new hamonengine.geometry.vector3(0,0,1)})();hamonengine.graphics=hamonengine.graphics||{};var BLENDING_OPS={REPLACE:0,ADD:1,MULTIPLY:2,OR:3,AND:4,XOR:5,DIFFERENCE:6},TEXT_DRAW_TYPE={STROKE:0,FILL:1};hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.imageext=function(a){a=void 0===a?{}:a;a instanceof hamonengine.graphics.imageext&&(a={image:a._image});this._image=a.image||new Image;this._state=0;this._backbufferCtx=this._backbufferResource=null;hamonengine.util.logger.debug("[hamonengine.graphics.imageext.constructor] Starting State: {"+this._state+"}")};hamonengine.graphics.imageext.prototype.clone=function(){return new hamonengine.graphics.imageext(this)};hamonengine.graphics.imageext.prototype.load=function(a){var b=
this;this.src=a;this._state=1;return new Promise(function(a,d){b.image.addEventListener("load",function(){b._state=2;a()},!1);b.image.addEventListener("error",function(a){b._state=3;d("The image '"+(a&&a.path&&0<a.path.length&&a.path[0].src||"")+"' could not be loaded.")},!1)})};hamonengine.graphics.imageext.createNewCanvas=function(a,b,c){c=void 0===c?"":c;var d=document.createElement("canvas");d.setAttribute("width",a);d.setAttribute("height",b);c&&d.setAttribute("id",c);return d};hamonengine.graphics.imageext.prototype.getImageData=
function(a){this._backbufferResource=this._backbufferResource||hamonengine.graphics.imageext.createNewCanvas(this.rawImage.width,this.rawImage.height);this._backbufferCtx=this._backbufferCtx||this._backbufferResource.getContext("2d");this._backbufferCtx.drawImage(this.rawImage,0,0);a=a||new hamonengine.geometry.rect;return this._backbufferCtx.getImageData(a.x,a.y,a.width||this.rawImage.width,a.height||this.rawImage.height)};hamonengine.graphics.imageext.prototype.blendColorRegion=function(a,b,c,d,
e,f){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?null:e;f=void 0===f?BLENDING_OPS.REPLACE:f;if(this.complete){var g=this.getImageData(e),h=function(a,b){return 0<a?a:b};switch(f){case BLENDING_OPS.ADD:h=function(a,b){return 0<a?Math.min(a+b,255):b};break;case BLENDING_OPS.MULTIPLY:h=function(a,b){return 0<a?Math.min(a*b,255):b};break;case BLENDING_OPS.AND:h=function(a,b){return 0<a?Math.min(a&b,255):b};break;case BLENDING_OPS.OR:h=function(a,b){return 0<a?Math.min(a|
b,255):b};break;case BLENDING_OPS.XOR:h=function(a,b){return 0<a?Math.min(a^b,255):b};break;case BLENDING_OPS.DIFFERENCE:h=function(a,b){return 0<a?Math.min(a-b,255):b}}f=g.data;for(var k=0;k<f.length;k+=4)f[k]=h(a,f[k]),f[k+1]=h(b,f[k+1]),f[k+2]=h(c,f[k+2]),f[k+3]=h(d,f[k+3]);this._backbufferCtx.putImageData(g,e.x,e.y)}};hamonengine.graphics.imageext.prototype.adjustColorChannel=function(a,b,c,d,e){a=void 0===a?1:a;b=void 0===b?1:b;c=void 0===c?1:c;d=void 0===d?1:d;e=void 0===e?null:e;if(this.complete){for(var f=
this.getImageData(e),g=f.data,h=0;h<g.length;h+=4)g[h]=Math.bitRound(g[h]*a),g[h+1]=Math.bitRound(g[h+1]*b),g[h+2]=Math.bitRound(g[h+2]*c),g[h+3]=Math.bitRound(g[h+3]*d);this._backbufferCtx.putImageData(f,e.x,e.y)}};hamonengine.graphics.imageext.prototype.bitblit=function(a,b,c,d){if(this.complete){a instanceof hamonengine.graphics.imageext&&(a=a.rawImage);d=Math.max(Math.min(void 0===d?1:d,1),0);var e=this.getImageData(c),f=hamonengine.graphics.imageext.createNewCanvas(a.width,a.height).getContext("2d");
f.drawImage(a,0,0);f=f.getImageData(b.x,b.y,b.width,b.height);a=e.data;f=f.data;for(var g=Math.max(b.height,c.height),h=Math.max(b.width,c.width),k=0;k<g;k++)for(var m=0;m<h;m++){var l=4*(k*c.width+m),p=4*(k*b.width+m),n=0<f[p+3]?1-d:1;a[l]=Math.bitRound(a[l]*n+f[p]*d);a[l+1]=Math.bitRound(a[l+1]*n+f[p+1]*d);a[l+2]=Math.bitRound(a[l+2]*n+f[p+2]*d);a[l+3]=Math.bitRound(a[l+3]*(1-d)+f[p+3]*d)}this._backbufferCtx.putImageData(e,c.x,c.y)}};$jscomp.global.Object.defineProperties(hamonengine.graphics.imageext.prototype,
{src:{configurable:!0,enumerable:!0,get:function(){return this._image.src},set:function(a){this._image.src=a}},complete:{configurable:!0,enumerable:!0,get:function(){return this._image.complete}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return 2===this._state}},image:{configurable:!0,enumerable:!0,get:function(){return this._backbufferResource?this._backbufferResource:this._image}},rawImage:{configurable:!0,enumerable:!0,get:function(){return this._image}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.layer=function(a){a=void 0===a?{}:a;this._canvasId=a.canvasId||"";this._name=a.name||"";this._alpha=void 0!==a.alpha?a.alpha:!1;this._allowEventBinding=void 0!==a.allowEventBinding?a.allowEventBinding:!1;this._wrapVertical=void 0!==a.wrapVertical?a.wrapVertical:!1;this._wrapHorizontal=void 0!==a.wrapHorizontal?a.wrapHorizontal:!1;this._clipToViewPort=void 0!==a.clipToViewPort?a.clipToViewPort:!0;this._enableImageSmoothing=void 0!==a.enableImageSmoothing?a.enableImageSmoothing:
!0;this._invertYAxis=void 0!==a.invertYAxis?a.invertYAxis:!1;this._invertXAxis=void 0!==a.invertXAxis?a.invertXAxis:!1;if(!this._canvasId)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvasId: '"+this._canvasId+"' unable to create the engine!"),"Cannot create the layer";this._canvas=document.getElementById(this._canvasId);if(!this._canvas)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvas: '"+this._canvasId+"' unable to create the engine!"),"Cannot create the layer";
try{this._canvasContext=this._canvas.getContext("2d",{alpha:this._alpha})}catch(b){}this.enableImageSmoothing(a.enableImageSmoothing);if(!this._canvasContext)throw console.error("[hamonengine.graphics.layer.constructor] Unable to get the 2d context: '"+this._canvasId+"' unable to create the engine!"),"Cannot create the layer";this._viewPort=a.viewPort||new hamonengine.geometry.rect(0,0,this._canvas.width,this._canvas.height);this._wasReset=!1;this._allowSaveStateEnabled=!0;this._viewPortBorderColor=
"";hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] Canvas Id: "+this._canvasId);hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] Name: "+this._name);hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] Alpha: "+this._alpha);hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] AllowEventBinding: "+this._allowEventBinding);hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] WrapVertical: "+this._wrapVertical);
hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] WrapHorizontal: "+this._wrapHorizontal);hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] ClipToViewPort: "+this._clipToViewPort)};hamonengine.graphics.layer.prototype.enableImageSmoothing=function(a){a=void 0===a?!0:a;hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] EnableImageSmoothing: "+a);this._enableImageSmoothing=a;try{this.context.webkitImageSmoothingEnabled=a,this.context.mozImageSmoothingEnabled=
a,this.context.imageSmoothingEnabled=a}catch(b){}};hamonengine.graphics.layer.prototype.clear=function(a,b,c,d){a=void 0===a?this.viewPort.x:a;b=void 0===b?this.viewPort.y:b;c=void 0===c?this.viewPort.width:c;d=void 0===d?this.viewPort.height:d;this._wasReset=!1;this.context.clearRect(a,b,c,d)};hamonengine.graphics.layer.prototype.reset=function(){this._wasReset||(this.context.resetTransform(),this._wasReset=!0)};hamonengine.graphics.layer.prototype.save=function(){this.allowSaveState&&this.context.save()};
hamonengine.graphics.layer.prototype.restore=function(){this.allowSaveState&&this.context.restore()};hamonengine.graphics.layer.prototype.fillLayerImage=function(a,b,c){b=void 0===b?this.viewPort.x:b;c=void 0===c?this.viewPort.y:c;this.context.drawImage(a,b,c,this.viewPort.width,this.viewPort.height)};hamonengine.graphics.layer.prototype.beginPainting=function(){this.clear();this.borderColor&&(this.context.strokeStyle=this.borderColor,this.context.strokeRect(this.viewPort.x,this.viewPort.y,this.viewPort.width,
this.viewPort.height));!this.clipToViewPort||0===this.viewPort.x&&0===this.viewPort.y&&this.viewPort.width===this.width&&this.viewPort.height===this.height||(this.context.beginPath(),this.context.rect(this.viewPort.x,this.viewPort.y,this.viewPort.width,this.viewPort.height),this.context.clip())};hamonengine.graphics.layer.prototype.endPainting=function(){this.reset()};hamonengine.graphics.layer.prototype.drawText=function(a,b,c,d,e,f){b=void 0===b?0:b;c=void 0===c?0:c;e=void 0===e?"white":e;f=void 0===
f?TEXT_DRAW_TYPE.FILL:f;this.context.font=void 0===d?"16px serif":d;this.context.textBaseline="top";f===TEXT_DRAW_TYPE.STROKE?(this.context.strokeStyle=e,this.context.strokeText(a,b,c)):(this.context.fillStyle=e,this.context.fillText(a,b,c))};hamonengine.graphics.layer.prototype.drawImage=function(a,b,c,d,e,f,g,h,k){a.complete&&this.context.drawImage(a instanceof hamonengine.graphics.imageext?a.image:a,b,c,d,e,f,g,h,k)};hamonengine.graphics.layer.prototype.drawRect=function(a,b,c,d,e){if(!(a instanceof
hamonengine.geometry.rect))throw"Parameter rect is not of type hamonengine.geometry.rect.";this.context.lineWidth=void 0===d?1:d;this.context.strokeStyle=void 0===e?"white":e;b=a.x+(void 0===b?0:b);c=a.y+(void 0===c?0:c);this.invertYAxis&&(c=this.viewPort.height-c);this.invertXAxis&&(b=this.viewPort.width-b);this.context.beginPath();this.context.moveTo(b,c);this.context.lineTo(b+a.width,c);this.context.lineTo(b+a.width,c+a.height);this.context.lineTo(b,c+a.height);this.context.closePath();this.context.stroke()};
hamonengine.graphics.layer.prototype.drawPolygon=function(a,b,c,d,e,f){b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?1:d;e=void 0===e?"white":e;f=void 0===f?!1:f;this.simpleDrawPolygon(a,b,c,d,e,f);if(this.wrapHorizontal){var g=b+a.min.x-this.viewPort.x;0>=g&&this.simpleDrawPolygon(a,this.viewPort.width+g,c,d,e,f);b+a.width>=this.viewPort.width&&this.simpleDrawPolygon(a,this.viewPort.x-(this.viewPort.width-(b+a.min.x)),c,d,e,f)}this.wrapVertical&&(g=c+a.min.y-this.viewPort.y,0>=g&&this.simpleDrawPolygon(a,
b,this.viewPort.height+g,d,e,f),c+a.height>=this.viewPort.height&&this.simpleDrawPolygon(a,b,this.viewPort.y-(this.viewPort.height-(c+a.min.y)),d,e,f))};hamonengine.graphics.layer.prototype.simpleDrawPolygon=function(a,b,c,d,e,f){b=void 0===b?0:b;c=void 0===c?0:c;f=void 0===f?!1:f;if(!(a instanceof hamonengine.geometry.polygon))throw"Parameter polygon is not of type hamonengine.geometry.polygon.";this.context.lineWidth=void 0===d?1:d;this.context.strokeStyle=void 0===e?"white":e;this.context.beginPath();
for(d=0;d<a.vertices.length;d++){e=Math.bitRound(b+a.vertices[d].x);var g=Math.bitRound(c+a.vertices[d].y);this.invertYAxis&&(g=this.viewPort.height-g);this.invertXAxis&&(e=this.viewPort.width-e);0===d?this.context.moveTo(e,g):this.context.lineTo(e,g)}this.context.closePath();this.context.stroke();if(hamonengine.debug&&f)for(this.context.strokeStyle="white",f=0;f<a.vertices.length;f++){g=a.vertices[f];e=a.edges[f];d=Math.bitRound(b+g.x+e.x/2);g=Math.bitRound(c+g.y+e.y/2);this.invertYAxis&&(g=this.viewPort.height-
g);this.invertXAxis&&(d=this.viewPort.width-d);this.context.beginPath();this.context.moveTo(d,g);var h=a.normals[f];e=Math.bitRound(e.length/2);h=h.invert();this.invertYAxis&&(h.y=-h.y);this.invertXAxis&&(h.x=-h.x);this.context.lineTo(d+h.x*e,g+h.y*e);this.context.stroke()}};$jscomp.global.Object.defineProperties(hamonengine.graphics.layer.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},allowEventBinding:{configurable:!0,enumerable:!0,get:function(){return this._allowEventBinding}},
context:{configurable:!0,enumerable:!0,get:function(){return this._canvasContext}},canvas:{configurable:!0,enumerable:!0,get:function(){return this._canvas}},clipToViewPort:{configurable:!0,enumerable:!0,get:function(){return this._clipToViewPort}},width:{configurable:!0,enumerable:!0,get:function(){return this._canvas.width}},height:{configurable:!0,enumerable:!0,get:function(){return this._canvas.height}},offsetX:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetLeft}},offsetY:{configurable:!0,
enumerable:!0,get:function(){return this.canvas.offsetTop}},viewPort:{configurable:!0,enumerable:!0,get:function(){return this._viewPort}},wrapHorizontal:{configurable:!0,enumerable:!0,get:function(){return this._wrapHorizontal},set:function(a){this._wrapHorizontal=a}},wrapVertical:{configurable:!0,enumerable:!0,get:function(){return this._wrapVertical},set:function(a){this._wrapVertical=a}},allowSaveState:{configurable:!0,enumerable:!0,get:function(){return this._allowSaveStateEnabled},set:function(a){this._allowSaveStateEnabled=
a}},borderColor:{configurable:!0,enumerable:!0,get:function(){return this._viewPortBorderColor},set:function(a){this._viewPortBorderColor=a}},invertYAxis:{configurable:!0,enumerable:!0,get:function(){return this._invertYAxis},set:function(a){this._invertYAxis=a}},invertXAxis:{configurable:!0,enumerable:!0,get:function(){return this._invertXAxis},set:function(a){this._invertXAxis=a}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.sprite=function(a){a=void 0===a?{}:a;a instanceof hamonengine.graphics.sprite&&(a={name:a.name,image:a._image&&a._image.clone(),dimensions:a._dimensions,theta:a.theta});this._name=a.name;this._image=a.image;this._dimensions=a.dimensions||new hamonengine.geometry.rect;this._theta=a.theta||0;this._scaleVector=new hamonengine.geometry.vector2(1,1);this._spriteOrientation=0;this._showFullImage=this._showDiagnosisLines=!1;this._maxWrapping=0;hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] Starting Dimensions: {"+
this._dimensions.toString()+"}");hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] Name: "+this._name);hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] Theta: "+this._theta);hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] ScaleVector: {"+this._scaleVector.toString()+"}")};hamonengine.graphics.sprite.prototype.copyProperties=function(a){this._theta=a.theta;this._scaleVector=a._scaleVector;this._spriteOrientation=a._spriteOrientation;
this._showDiagnosisLines=a._showDiagnosisLines;this._showFullImage=a._showFullImage};hamonengine.graphics.sprite.prototype.clone=function(){return new hamonengine.graphics.sprite(this)};hamonengine.graphics.sprite.prototype.rotate=function(a){this._theta=a||0};hamonengine.graphics.sprite.prototype.scale=function(a,b){this._scaleVector.x=a;this._scaleVector.y=b};hamonengine.graphics.sprite.prototype.mirror=function(a){this._spriteOrientation=hamonengine.util.bitwise.toggle(this._spriteOrientation,
2,a)};hamonengine.graphics.sprite.prototype.flip=function(a){this._spriteOrientation=hamonengine.util.bitwise.toggle(this._spriteOrientation,1,a)};hamonengine.graphics.sprite.prototype.blendColor=function(a,b,c,d,e){e=void 0===e?BLENDING_OPS.REPLACE:e;this._image.blendColorRegion(void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d,this._dimensions,e)};hamonengine.graphics.sprite.prototype.adjustColorChannel=function(a,b,c,d){this._image.adjustColorChannel(void 0===a?1:a,void 0===b?1:b,void 0===
c?1:c,void 0===d?1:d,this._dimensions)};hamonengine.graphics.sprite.prototype.bitblit=function(a,b){this._image.bitblit(a._image,a._dimensions,this._dimensions,void 0===b?1:b)};hamonengine.graphics.sprite.prototype.drawRaw=function(a,b,c,d,e,f){e=void 0===e?this._dimensions.width:e;f=void 0===f?this._dimensions.height:f;this._image.complete&&(this.showFullImage?a.context.drawImage(this._image.image,Math.bitRound(c),Math.bitRound(d),Math.bitRound(e),Math.bitRound(f)):a.drawImage(this._image,this._dimensions.x,
this._dimensions.y,this._dimensions.width,this._dimensions.height,Math.bitRound(c),Math.bitRound(d),Math.bitRound(e),Math.bitRound(f)))};hamonengine.graphics.sprite.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?this._dimensions.width:e;f=void 0===f?this._dimensions.height:f;c=Math.bitRound(c);d=Math.bitRound(d);var g=Math.bitRound(e/2)+c,h=Math.bitRound(f/2)+d,k=hamonengine.util.bitwise.isSet(this._spriteOrientation,1)?-1:1,m=hamonengine.util.bitwise.isSet(this._spriteOrientation,2)?-1:1;a.save();
if(1!==this._scaleVector.x||1!==this._scaleVector.y)a.context.translate(c,d),a.context.scale(this._scaleVector.x,this._scaleVector.y),a.context.translate(-c,-d);0<this._spriteOrientation&&(a.context.translate(g,h),a.context.scale(m,k),a.context.translate(-g,-h));0!==this.theta&&(a.context.translate(g,h),a.context.rotate(this.theta),a.context.translate(-g,-h));(a.wrapHorizontal||a.wrapVertical)&&this.drawSpriteWrapping(a,b,c,d,e,f,m,k);this.drawRaw(a,b,c,d,e,f);if(hamonengine.debug&&this.showDiagnosisLines){g=
Math.bitRound(e/2)+c;h=Math.bitRound(f/2)+d;if(a.wrapHorizontal||a.wrapVertical)a.context.strokeStyle="red",a.context.lineWidth=2,a.context.beginPath(),a.context.moveTo(g,h),a.context.lineTo(g+a.viewPort.width,h),a.context.stroke(),a.context.beginPath(),a.context.moveTo(g,h),a.context.lineTo(g-a.viewPort.width,h),a.context.stroke(),a.context.beginPath(),a.context.moveTo(g,h),a.context.lineTo(g,h+a.viewPort.height),a.context.stroke(),a.context.beginPath(),a.context.moveTo(g,h),a.context.lineTo(g,h-
a.viewPort.height),a.context.stroke(),this.drawRaw(a,b,c+a.viewPort.width,d,e,f),this.drawRaw(a,b,c-a.viewPort.width,d,e,f),this.drawRaw(a,b,c,d+a.viewPort.height,e,f),this.drawRaw(a,b,c,d-a.viewPort.height,e,f),a.context.strokeStyle="white",a.context.strokeRect(g-a.viewPort.width/2,h-a.viewPort.height/2,a.viewPort.width,a.viewPort.height);a.context.strokeStyle="red";a.context.strokeRect(c,d,e,f);a.context.strokeStyle="cyan";a.context.strokeRect(a.viewPort.x,a.viewPort.y,a.viewPort.width,a.viewPort.height)}a.restore()};
hamonengine.graphics.sprite.prototype.drawSpriteWrapping=function(a,b,c,d,e,f,g,h){var k=Math.cos(-this.theta),m=Math.sin(-this.theta),l=e*this._scaleVector.x,p=f*this._scaleVector.y,n=new hamonengine.geometry.vector2;if(a.wrapHorizontal){var r=a.viewPort.width/this._scaleVector.x*g;var t=Math.bitRound(k*r);r=Math.bitRound(m*r);if(c-l<=a.viewPort.x){if(n.x=1,l=Math.abs(parseInt((c-l)/a.viewPort.width,10))+1,0===this._maxWrapping||l<this._maxWrapping)this.drawRaw(a,b,c+t*l,d+r*l,e,f),0<--l&&this.drawRaw(a,
b,c+t*l,d+r*l,e,f)}else c+l>=a.viewPort.width&&(n.x=-1,l=parseInt((c+l)/a.viewPort.width,10),0===this._maxWrapping||l<this._maxWrapping)&&(this.drawRaw(a,b,c-t*l,d-r*l,e,f),0<--l&&this.drawRaw(a,b,c-t*l,d-r*l,e,f))}if(a.wrapVertical){var q=a.viewPort.height/this._scaleVector.y*h;var u=Math.bitRound(m*q);q=Math.bitRound(k*q);if(d-p<=a.viewPort.y){if(n.y=1,k=Math.abs(parseInt((d-p)/a.viewPort.height,10))+1,0===this._maxWrapping||k<this._maxWrapping)this.drawRaw(a,b,c-u*k,d+q*k,e,f),0<--k&&this.drawRaw(a,
b,c-u*k,d+q*k,e,f)}else d+p>=a.viewPort.height&&(n.y=-1,k=parseInt((d+p)/a.viewPort.height,10),0===this._maxWrapping||k<this._maxWrapping)&&(this.drawRaw(a,b,c+u*k,d-q*k,e,f),0<--k&&this.drawRaw(a,b,c+u*k,d-q*k,e,f))}a.wrapVertical&&a.wrapHorizontal&&(c=c-n.y*u+n.x*t,d=d+n.y*q+n.x*r,c&&d&&this.drawRaw(a,b,c,d,e,f))};$jscomp.global.Object.defineProperties(hamonengine.graphics.sprite.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},theta:{configurable:!0,enumerable:!0,
get:function(){return this._theta}},showDiagnosisLines:{configurable:!0,enumerable:!0,get:function(){return this._showDiagnosisLines},set:function(a){this._showDiagnosisLines=a}},showFullImage:{configurable:!0,enumerable:!0,get:function(){return this._showFullImage},set:function(a){this._showFullImage=a}},maxWrapping:{configurable:!0,enumerable:!0,set:function(a){this._maxWrapping=a}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.animsprite=function(a){a=void 0===a?{}:a;hamonengine.graphics.sprite.call(this,a);a instanceof hamonengine.graphics.animsprite&&(a={frames:a._frames.map(function(a){return a.clone()}),animationRate:a._animationRate,animationCycles:a._animationCycles});this._frames=a.frames||[];this._animationRate=a.animationRate||0;this._animationCycles=a.animationCycles||-1;this._numberOfAnimationCycles=this._timeSinceLastFrame=this._index=0;this._enableAnimation=!0;hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Rate: "+
this._animationRate);hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Cycle: "+this._animationCycles);hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Index: "+this._index);hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Enable Animation: "+this._enableAnimation)};$jscomp.inherits(hamonengine.graphics.animsprite,hamonengine.graphics.sprite);hamonengine.graphics.animsprite.prototype.clone=
function(){return new hamonengine.graphics.animsprite(this)};hamonengine.graphics.animsprite.prototype.start=function(){this._enableAnimation=!0;this._numberOfAnimationCycles=0};hamonengine.graphics.animsprite.prototype.stop=function(){this._enableAnimation=!1};hamonengine.graphics.animsprite.prototype.pause=function(){this._enableAnimation=!this._enableAnimation};hamonengine.graphics.animsprite.prototype.addFrame=function(a){hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.animsprite.addFrame]");
this._frames.push(a)};hamonengine.graphics.animsprite.prototype.blendColor=function(a,b,c,d,e){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?BLENDING_OPS.REPLACE:e;for(var f=0;f<this._frames.length;f++)this._frames[f].blendColor(a,b,c,d,e)};hamonengine.graphics.animsprite.prototype.adjustColorChannel=function(a,b,c,d){a=void 0===a?1:a;b=void 0===b?1:b;c=void 0===c?1:c;d=void 0===d?1:d;for(var e=0;e<this._frames.length;e++)this._frames[e].adjustColorChannel(a,b,c,
d)};hamonengine.graphics.animsprite.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?null:e;f=void 0===f?null:f;var g=this._timeSinceLastFrame+b;if(this._enableAnimation){var h=parseInt(g/this.animationRate,10);h=this.index+h;-1<this.animationCycles&&(this._numberOfAnimationCycles+=parseInt(h/this._frames.length,10),this._enableAnimation=this._numberOfAnimationCycles<=this.animationCycles);this.index=h%this._frames.length}0<this._frames.length&&(this._frames[this.index].copyProperties(this),this._frames[this.index].draw(a,
b,c,d,e,f));this._timeSinceLastFrame=g%this.animationRate};$jscomp.global.Object.defineProperties(hamonengine.graphics.animsprite.prototype,{index:{configurable:!0,enumerable:!0,get:function(){return this._index},set:function(a){this._index=a%this._frames.length||0}},animationRate:{configurable:!0,enumerable:!0,get:function(){return this._animationRate},set:function(a){this._animationRate=a}},animationCycles:{configurable:!0,enumerable:!0,get:function(){return this._animationCycles},set:function(a){this._animationCycles=
a;this._enableAnimation=!0}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.spritesheet=function(a){this._imageResource=new hamonengine.graphics.imageext;this._sprites={};this._spriteIndex=[]};hamonengine.graphics.spritesheet.prototype.load=function(a){for(var b=this._imageResource.load(a.spritesheetUrl),c=0;c<a.sprites.length;c++){var d=a.sprites[c];this._spriteIndex.push(d.name);this._sprites[d.name]=new hamonengine.graphics.sprite({image:this._imageResource,name:d.name,dimensions:new hamonengine.geometry.rect(d.x,d.y,d.width,d.height)})}for(c=
0;c<a.animSprites.length;c++){d=a.animSprites[c];for(var e=new hamonengine.graphics.animsprite({animationRate:d.animationRate}),f=0;f<d.frames.length;f++){var g=d.frames[f];e.addFrame(new hamonengine.graphics.sprite({image:this._imageResource,name:g.name,dimensions:new hamonengine.geometry.rect(g.x,g.y,g.width,g.height)}))}this._spriteIndex.push(d.name);this._sprites[d.name]=e}return b};hamonengine.graphics.spritesheet.prototype.getSprite=function(a){return this._sprites[a].clone()};hamonengine.graphics.spritesheet.prototype.getSpriteByOrdinal=
function(a){return this._sprites[this._spriteIndex[a]].clone()};$jscomp.global.Object.defineProperties(hamonengine.graphics.spritesheet.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this._spriteIndex.length}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._imageResource.isLoaded()}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.object2d=function(a){a=void 0===a?{}:a;this._name=a.name||"";this._boundingShape=a.boundingShape;this._width=a.width||0;this._height=a.height||0;this._zindex=a.zindex||0;this._movementRate=a.movementRate||0;this._position=a.position||new hamonengine.geometry.vector2;this._direction=a.direction||new hamonengine.geometry.vector2;this._theta=a.theta||0;this._isSolid=void 0===a.isSolid?!0:!1;this._isMoveable=void 0===a.isMoveable?!1:!0;this._isVisible=void 0===a.isVisible?
!0:!1;hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] Name: "+this.name);hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] Starting Dimensions {Width: "+this.width+", Height: "+this.height+"}");hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] Starting Direction: {x: "+this.direction.x+", y: "+this.direction.y+"}");hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] Starting Position: {x: "+this.position.x+
", y: "+this.position.y+"}");hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] Starting Theta: "+this.theta);hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] Movement Rate: "+this._movementRate);hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] isSolid: "+this.isSolid);hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] isMoveable: "+this.isMoveable);hamonengine.util.logger.debug("[hamonengine.entities.object2d.constructor] isVisible: "+
this.isVisible)};hamonengine.entities.object2d.prototype.move=function(a,b){this.isMoveable&&(b=(void 0===b?null:b)||this.calcMove(a),this.position.x+=b.x,this.position.y+=b.y)};hamonengine.entities.object2d.prototype.calcMove=function(a){return new hamonengine.geometry.vector2(this._movementRate*this.direction.x*a,this._movementRate*this.direction.y*a)};hamonengine.entities.object2d.prototype.isCollision=function(a){return this.boundingShape.isCollision(a)};hamonengine.entities.object2d.prototype.isContained=
function(a){return this.boundingShape.isContained(a.position,a.boundingShape)};hamonengine.entities.object2d.prototype.render=function(a,b){};hamonengine.entities.object2d.prototype.toString=function(){return"{name: '"+this.name+"', position: '"+this.position+"'}"};hamonengine.entities.object2d.prototype.onEnvironmentCollision=function(a,b){this._position=a;return!0};hamonengine.entities.object2d.prototype.onObjectCollision=function(a,b,c){};$jscomp.global.Object.defineProperties(hamonengine.entities.object2d.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){this._position=a}},direction:{configurable:!0,enumerable:!0,get:function(){return this._direction}},theta:{configurable:!0,enumerable:!0,get:function(){return this._theta||0}},width:{configurable:!0,enumerable:!0,get:function(){return this._width}},height:{configurable:!0,enumerable:!0,get:function(){return this._height}},zIndex:{configurable:!0,
enumerable:!0,get:function(){return this._zindex},set:function(a){this._zindex=a}},boundingShape:{configurable:!0,enumerable:!0,get:function(){return this._boundingShape=this._boundingShape||new hamonengine.geometry.rect(0,0,this.width,this.height)}},isMoveable:{configurable:!0,enumerable:!0,get:function(){return this._isMoveable}},isSolid:{configurable:!0,enumerable:!0,get:function(){return this._isSolid}},isVisible:{configurable:!0,enumerable:!0,get:function(){return this._isVisible},set:function(a){this._isVisible=
a}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.cell=function(a){a=void 0===a?{}:a;hamonengine.entities.object2d.call(this,a);this._movementRate=0;this._direction=new hamonengine.geometry.vector2;this._theta=0;this._children=[];this._objects=[];this._zIndexSorter=new hamonengine.math.sort({compareFunc:function(a,c){return a===c?0:a.zIndex<c.zIndex?-1:1}})};$jscomp.inherits(hamonengine.entities.cell,hamonengine.entities.object2d);hamonengine.entities.cell.prototype.addChild=function(a){this._children.push(a)};hamonengine.entities.cell.prototype.addObject=
function(a){this._objects.push(a)};hamonengine.entities.cell.prototype.addObjects=function(a){for(var b=0;b<a.length;b++)this._objects.push(a[b])};hamonengine.entities.cell.prototype.process=function(a){if(this.objects)for(var b=new Set,c=0;c<this.objects.length;c++){var d=this.objects[c];if(d.isMoveable&&(d.move(a),this.isSolid)){var e=hamonengine.geometry.vector2.clone(d.position),f=this.isContained(d);0>f.x?e.x=this.boundingShape.x-d.boundingShape.x:0<f.x&&(e.x=this.boundingShape.width-d.boundingShape.right);
0>f.y?e.y=this.boundingShape.y-d.boundingShape.y:0<f.y&&(e.y=this.boundingShape.height-d.boundingShape.bottom);if(!d.onEnvironmentCollision(e,this))break}for(e=0;e<this.objects.length;e++)if(f=this.objects[e],d!==f){var g=d.name+"->"+f.name;b.has(g)||(b.add(g),b.add(f.name+"->"+d.name))}}};hamonengine.entities.cell.prototype.render=function(a,b){if(this.objects&&(this._zIndexSorter.quickSort(this._objects),this.objects))for(var c=0;c<this.objects.length;c++)this.objects[c].render(a,b)};$jscomp.global.Object.defineProperties(hamonengine.entities.cell.prototype,
{children:{configurable:!0,enumerable:!0,get:function(){return this._children}},objects:{configurable:!0,enumerable:!0,get:function(){return this._objects}}})})();hamonengine.core=hamonengine.core||{};
(function(){hamonengine.core.engine=function(a){a=void 0===a?{}:a;hamonengine.util.logger.info("HamonEngine -- Using version: 0.1.0");this._movementRate=a.movementRate||.25;this._size=a.size||64;this._showFPS=void 0!==a.showFPS?a.showFPS:!1;this._animationId=this._lastFrameTimeStamp=this._startTimeStamp=this._state=0;this._fpsCounter=new hamonengine.util.fpscounter;this._layers={};for(var b=0,c=0;c<a.canvas.length;c++){var d=a.canvas[c],e=d.name||"canvas"+b++;this._layers[e]=new hamonengine.graphics.layer({name:e,
canvasId:d.id,viewPort:d.viewPort,allowEventBinding:d.allowEventBinding,enableImageSmoothing:a.enableImageSmoothing,clipToViewPort:d.clipToViewPort})}this._resourcesLoaded=!1;hamonengine.util.logger.debug("[hamonengine.core.engine.constructor] MovementRate: "+this._movementRate);hamonengine.util.logger.debug("[hamonengine.core.engine.constructor] State: "+this._state)};hamonengine.core.engine.prototype.getLayer=function(a){return this._layers[a]};hamonengine.core.engine.prototype.load=function(){var a=
this;hamonengine.util.logger.info("[hamonengine.core.engine.load]");this.onPreload();this._state=2;hamonengine.util.logger.debug("[hamonengine.core.engine.constructor] State: "+this._state);return new Promise(function(b,c){a.onEventBinding().then(function(){hamonengine.util.logger.info("[hamonengine.core.engine.load] Event binding completed.")});a.onloadResources().then(function(){a._resourcesLoaded=!0;hamonengine.util.logger.info("[hamonengine.core.engine.load] Load resources completed.");b(a)}).catch(function(b){hamonengine.util.logger.info("[hamonengine.core.engine.load] Failed!");
a.stop();c()})})};hamonengine.core.engine.prototype.start=function(){hamonengine.util.logger.info("[hamonengine.core.engine.start]");2===this._state&&(this._state=1,hamonengine.util.logger.debug("[hamonengine.core.engine.start] State: "+this._state),this.fpsCounter.start(),this.onDraw(0));return this};hamonengine.core.engine.prototype.stop=function(){hamonengine.util.logger.info("[hamonengine.core.engine.stop]");window.cancelAnimationFrame(this._animationId);this._state=this._startTimeStamp=this._animationId=
0;hamonengine.util.logger.debug("[hamonengine.core.engine.stop] State: "+this._state);return this};hamonengine.core.engine.prototype.onPreload=function(){hamonengine.util.logger.info("[hamonengine.core.engine.onPreload]")};hamonengine.core.engine.prototype.onloadResources=function(){hamonengine.util.logger.info("[hamonengine.core.engine.onloadResources]");return Promise.resolve()};hamonengine.core.engine.prototype.onEventBinding=function(){var a=this;return new Promise(function(b,c){window.addEventListener("DOMContentLoaded",
function(b){a._layers.forEach(function(b,c){if(c.allowEventBinding){var d=function(b,d){return a.onMouseEvent(b,new hamonengine.geometry.vector2(d.clientX,d.clientY),d,c)},e=function(b,d){for(var e=[],f=0;f<d.touches.length;f++)e.push({left:d.touches[f].clientX-(c.offsetX||0),top:d.touches[f].clientY-(c.offsetY||0)});a.onTouchEvent(b,d,e,c)};c.canvas.addEventListener("keyup",function(b){return a.onKeyEvent("up",b.code,b,c)});c.canvas.addEventListener("keydown",function(b){return a.onKeyEvent("down",
b.code,b,c)});c.canvas.addEventListener("click",function(b){a.onMouseClick(b,c)});c.canvas.addEventListener("mouseup",function(a){return d("up",a)});c.canvas.addEventListener("mousedown",function(a){return d("down",a)});c.canvas.addEventListener("touchstart",function(a){return e("start",a)});c.canvas.addEventListener("touchmove",function(a){return e("move",a)});c.canvas.addEventListener("touchend",function(b){return a.onTouchEnd(b,c)});c.canvas.addEventListener("touchcancel",function(b){return a.onTouchCancel(b,
c)})}})});b()})};hamonengine.core.engine.prototype.onMouseClick=function(a,b){hamonengine.util.logger.debug("[hamonengine.core.engine.onMouseClick] '"+a+"'")};hamonengine.core.engine.prototype.onMouseEvent=function(a,b,c,d){hamonengine.util.logger.debug("[hamonengine.core.engine.onMouseEvent] Type: '"+a+"' '"+b.toString()+"'")};hamonengine.core.engine.prototype.onKeyEvent=function(a,b,c,d){c&&c.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onKeyEvent] Type: '"+a+"' '"+b+
"'")};hamonengine.core.engine.prototype.onTouchEvent=function(a,b,c,d){b&&b.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchEvent] Type: '"+a+"' '"+b+"'")};hamonengine.core.engine.prototype.onTouchEnd=function(a,b){a&&a.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchEnd] '"+a+"'")};hamonengine.core.engine.prototype.onTouchCancel=function(a,b){a&&a.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchCancel] '"+
a+"'")};hamonengine.core.engine.prototype.onDraw=function(a){var b=this;a=a||0;this._startTimeStamp||(this._startTimeStamp=a);var c=a-this._lastFrameTimeStamp;try{this._animationId=window.requestAnimationFrame(function(a){b._state=3;b.onFrame(c);b.onDraw(a)})}catch(d){this.stop(),hamonengine.util.logger.debug(d)}this._lastFrameTimeStamp=a;return this};hamonengine.core.engine.prototype.onFrame=function(a){return this};$jscomp.global.Object.defineProperties(hamonengine.core.engine.prototype,{primaryLayer:{configurable:!0,
enumerable:!0,get:function(){return this._layers.canvas0}},resourcesLoaded:{configurable:!0,enumerable:!0,get:function(){return this._resourcesLoaded}},fpsCounter:{configurable:!0,enumerable:!0,get:function(){return this._fpsCounter}}})})();
