/*
 Hamonengine 波紋
 Copyright \(c\) 2020-2023, CaffeinatedRat.
 All rights reserved.
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

     * Redistributions of source code must retain the above copyright
       notice, this list of conditions and the following disclaimer.
     * Redistributions in binary form must reproduce the above copyright
       notice, this list of conditions and the following disclaimer in the
       documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY
 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE AUTHOR AND CONTRIBUTORS BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(g){return g instanceof e?g:new e(function(k,h){k(g)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(g)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(g){d(g,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=
this.batch_;this.batch_=[];for(var k=0;k<g.length;++k){var h=g[k];g[k]=null;try{h()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;})};var e=function(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var k=this.createResolveAndReject_();try{g(k.resolve,k.reject)}catch(h){k.reject(h)}};e.prototype.createResolveAndReject_=function(){function g(l){return function(m){h||(h=!0,l.call(k,m))}}var k=this,h=!1;
return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};e.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof e)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var k=null!=g;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(g):this.fulfill_(g)}};e.prototype.resolveToNonPromiseObj_=function(g){var k=void 0;try{k=g.then}catch(h){this.reject_(h);return}"function"==typeof k?
this.settleSameAsThenable_(k,g):this.fulfill_(g)};e.prototype.reject_=function(g){this.settle_(2,g)};e.prototype.fulfill_=function(g){this.settle_(1,g)};e.prototype.settle_=function(g,k){if(0!=this.state_)throw Error("Cannot settle("+g+", "+k+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=k;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)f.asyncExecute(this.onSettledCallbacks_[g]);
this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(g){var k=this.createResolveAndReject_();g.callWhenSettled_(k.resolve,k.reject)};e.prototype.settleSameAsThenable_=function(g,k){var h=this.createResolveAndReject_();try{g.call(k,h.resolve,h.reject)}catch(l){h.reject(l)}};e.prototype.then=function(g,k){function h(t,r){return"function"==typeof t?function(p){try{l(t(p))}catch(q){m(q)}}:r}var l,m,n=new e(function(t,r){l=t;m=r});this.callWhenSettled_(h(g,l),h(k,m));return n};
e.prototype.catch=function(g){return this.then(void 0,g)};e.prototype.callWhenSettled_=function(g,k){function h(){switch(l.state_){case 1:g(l.result_);break;case 2:k(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?f.asyncExecute(h):this.onSettledCallbacks_.push(h)};e.resolve=c;e.reject=function(g){return new e(function(k,h){h(g)})};e.race=function(g){return new e(function(k,h){for(var l=$jscomp.makeIterator(g),m=l.next();!m.done;m=l.next())c(m.value).callWhenSettled_(k,
h)})};e.all=function(g){var k=$jscomp.makeIterator(g),h=k.next();return h.done?c([]):new e(function(l,m){function n(p){return function(q){t[p]=q;r--;0==r&&l(t)}}var t=[],r=0;do t.push(void 0),r++,c(h.value).callWhenSettled_(n(t.length-1),m),h=k.next();while(!h.done)})};return e},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};
$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),m=Object.seal({}),n=new a([[l,2],[m,3]]);if(2!=n.get(l)||3!=n.get(m))return!1;n.delete(l);n.set(m,4);return!n.has(l)&&4==n.get(m)}catch(t){return!1}}function c(){}function d(l){var m=typeof l;return"object"===m&&null!==l||"function"===m}function e(l){if(!$jscomp.owns(l,g)){var m=new c;$jscomp.defineProperty(l,g,{value:m})}}function f(l){if(!$jscomp.ISOLATE_POLYFILLS){var m=Object[l];m&&(Object[l]=
function(n){if(n instanceof c)return n;Object.isExtensible(n)&&e(n);return m(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var g="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var k=0,h=function(l){this.id_=(k+=Math.random()+1).toString();if(l){l=$jscomp.makeIterator(l);for(var m;!(m=l.next()).done;)m=m.value,this.set(m[0],m[1])}};h.prototype.set=function(l,m){if(!d(l))throw Error("Invalid WeakMap key");
e(l);if(!$jscomp.owns(l,g))throw Error("WeakMap key fail: "+l);l[g][this.id_]=m;return this};h.prototype.get=function(l){return d(l)&&$jscomp.owns(l,g)?l[g][this.id_]:void 0};h.prototype.has=function(l){return d(l)&&$jscomp.owns(l,g)&&$jscomp.owns(l[g],this.id_)};h.prototype.delete=function(l){return d(l)&&$jscomp.owns(l,g)&&$jscomp.owns(l[g],this.id_)?delete l[g][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),l=new a($jscomp.makeIterator([[h,"s"]]));if("s"!=l.get(h)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;var m=l.entries(),n=m.next();if(n.done||n.value[0]!=h||"s"!=n.value[1])return!1;n=m.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!m.next().done?!1:!0}catch(t){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(h){this.data_={};this.head_=g();this.size=0;if(h){h=$jscomp.makeIterator(h);for(var l;!(l=h.next()).done;)l=l.value,this.set(l[0],l[1])}};d.prototype.set=function(h,l){h=0===h?0:h;var m=e(this,h);m.list||(m.list=this.data_[m.id]=[]);m.entry?m.entry.value=l:(m.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:l},m.list.push(m.entry),
this.head_.previous.next=m.entry,this.head_.previous=m.entry,this.size++);return this};d.prototype.delete=function(h){h=e(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(h){return!!e(this,h).entry};d.prototype.get=function(h){return(h=
e(this,h).entry)&&h.value};d.prototype.entries=function(){return f(this,function(h){return[h.key,h.value]})};d.prototype.keys=function(){return f(this,function(h){return h.key})};d.prototype.values=function(){return f(this,function(h){return h.value})};d.prototype.forEach=function(h,l){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,h.call(l,n[1],n[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(h,l){var m=l&&typeof l;"object"==m||"function"==m?c.has(l)?m=c.get(l):
(m=""+ ++k,c.set(l,m)):m="p_"+l;var n=h.data_[m];if(n&&$jscomp.owns(h.data_,m))for(h=0;h<n.length;h++){var t=n[h];if(l!==l&&t.key!==t.key||l===t.key)return{id:m,list:n,index:h,entry:t}}return{id:m,list:n,index:-1,entry:void 0}},f=function(h,l){var m=h.head_;return $jscomp.iteratorPrototype(function(){if(m){for(;m.head!=h.head_;)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:l(m)};m=null}return{done:!0,value:void 0}})},g=function(){var h={};return h.previous=h.next=h.head=h},k=0;
return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),e=new a($jscomp.makeIterator([d]));if(!e.has(d)||1!=e.size||e.add(d)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=d||g.value[1]!=d)return!1;g=f.next();return g.done||g.value[0]==d||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size};c.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};c.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=
function(d){return this.map_.has(d)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(d,e){var f=this;this.map_.forEach(function(g){return d.call(e,g,g,f)})};return c},"es6","es3");
$jscomp.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");var hamonengine={debug:!1,verbose:!1};var bitflag=function(){};bitflag.toggle=function(a,b,c){return void 0!==c?c?a|1<<b:a&~(1<<b):a^1<<b};bitflag.isSet=function(a,b){b=1<<b;return(a&b)===b};var connect=function(a){a=void 0===a?{}:a;this._timeout=a.timeout};
connect.get=function(a,b){var c=void 0===b?{}:b;b=c.timeout;c=c.responseType;if(!a)throw"Invalid url '"+a+"'";var d=new XMLHttpRequest;if(!d)throw"Unable to create XMLHttpRequest";void 0!==b&&(d.timeout=b);void 0!==c&&(d.responseType=c);return new Promise(function(e,f){d.addEventListener("load",function(g){var k=d.status;0===k||200<=k&&400>k?e({data:d.response,status:d.status,statusText:d.statusText,event:g}):f({status:d.status,statusText:d.statusText,event:g})});d.addEventListener("error",function(g){return f({status:d.status,
statusText:d.statusText,event:g})});d.open("GET",a);d.send()})};
connect.post=function(a,b,c){var d=void 0===c?{}:c;c=d.timeout;var e=d.contentType,f=d.accept;d=d.responseType;if(!a)throw"Invalid url '"+a+"'";var g=new XMLHttpRequest;if(!g)throw"Unable to create XMLHttpRequest";void 0!==c&&(g.timeout=c);d||(g.responseType=d);return new Promise(function(k,h){g.addEventListener("load",function(l){var m=g.status;0===m||200<=m&&400>m?k({data:g.response,status:g.status,statusText:g.statusText,event:l}):h({status:g.status,statusText:g.statusText,event:l})});g.addEventListener("error",
function(l){return h({status:g.status,statusText:g.statusText,event:l})});g.open("POST",a);void 0!==e?g.setRequestHeader("Content-Type",e):g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");void 0!==f?g.setRequestHeader("Accept",f):g.setRequestHeader("Accept","application/x-www-form-urlencoded");g.send(b)})};$jscomp.global.Object.defineProperties(connect.prototype,{timeout:{configurable:!0,enumerable:!0,get:function(){return this._timeout}}});Array.prototype.first=function(){return 0<this.length?this[0]:null};Array.prototype.last=function(){return 0<this.length?this[this.length-1]:null};var MILLISECONDS=1E3,fpscounter=function(a){this._spf=this._fps=this._frameCounter=this._globalStartTime=0;this._minFPS=MILLISECONDS;this._maxFPS=0};fpscounter.prototype.start=function(){this._globalStartTime=Date.now();this._spf=this._fps=this._frameCounter=0;this._minFPS=MILLISECONDS;this._maxFPS=0};fpscounter.prototype.begin=function(){this._frameStartTime=Date.now()};
fpscounter.prototype.end=function(){if(0===this._startTime)throw"[fpscounter.end] Begin was not called before end.";var a=Date.now();this._frameCounter++;this._spf=(a-this._frameStartTime)*MILLISECONDS;a>this._globalStartTime+MILLISECONDS&&(this._fps=Math.round(MILLISECONDS*this._frameCounter/(a-this._globalStartTime)),this._minFPS=Math.min(this._minFPS,this._fps),this._maxFPS=Math.max(this._maxFPS,this._fps),this._globalStartTime=a,this._frameCounter=0)};
$jscomp.global.Object.defineProperties(fpscounter.prototype,{SPF:{configurable:!0,enumerable:!0,get:function(){return this._spf}},FPS:{configurable:!0,enumerable:!0,get:function(){return this._fps}},minFPS:{configurable:!0,enumerable:!0,get:function(){return this._minFPS}},maxFPS:{configurable:!0,enumerable:!0,get:function(){return this._maxFPS}}});var listenerPool=function(a){this._listeners=[]};listenerPool.prototype.register=function(a){this._listeners.push(a)};listenerPool.prototype.invoke=function(a,b){this._listeners.forEach(function(c){return c[a]&&c[a](b)})};listenerPool.prototype.clear=function(){this._listeners=[]};$jscomp.global.Object.defineProperties(listenerPool.prototype,{listeners:{configurable:!0,enumerable:!0,get:function(){return this._listeners}}});hamonengine.util=hamonengine.util||{};
(function(){hamonengine.util.sort=function(a){a=void 0===a?{}:a;this._compareFunc=a.compareFunc?a.compareFunc:hamonengine.util.sort.sort.ascending};hamonengine.util.sort.prototype.quickSort=function(a){hamonengine.util.sort.iquicksort(this._compareFunc,a,0,a.length-1)};hamonengine.util.sort.ascending=function(a,b){return a===b?0:a<b?-1:1};hamonengine.util.sort.descending=function(a,b){return a===b?0:a<b?1:-1};hamonengine.util.sort.iquicksort=function(a,b,c,d){for(var e=c,f=d,g=b[Math.truncate((c+
d)/2)];e<=f;){for(;0>a(b[e],g);)e++;for(;0<a(b[f],g);)f--;if(e<=f){var k=b[e];b[e]=b[f];b[f]=k;e++;f--}}c<f&&hamonengine.util.sort.iquicksort(a,b,c,f);e<d&&hamonengine.util.sort.iquicksort(a,b,e,d)}})();var worker=function(a){a=void 0===a?{}:a;a instanceof worker&&(a={blob:a.blob,method:a.method});if(!a.method)throw console.error("[worker.constructor] Unable to create a workert: options.method is undefined!"),"Cannot create the worker";this._method=a.method;this._blob=a.blob||new Blob(["onmessage = "+a.method.toString()+";"],{type:"text/javascript"});this._url=URL.createObjectURL(this._blob);this._worker=new Worker(this._url)};worker.create=function(a){return new worker({method:a})};
worker.prototype.run=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){return c.return(new Promise(function(d,e){b.worker.onmessage=function(f){d(f.data);URL.revokeObjectURL(b.url)};b.worker.onerror=function(f){e(f);URL.revokeObjectURL(b.url)};b.worker.postMessage(a)}))})};
$jscomp.global.Object.defineProperties(worker.prototype,{blob:{configurable:!0,enumerable:!0,get:function(){return this._blob}},method:{configurable:!0,enumerable:!0,get:function(){return this._method}},url:{configurable:!0,enumerable:!0,get:function(){return this._url}},worker:{configurable:!0,enumerable:!0,get:function(){return this._worker}}});hamonengine.math=hamonengine.math||{};(function(){var a=Math.maxUInt32;hamonengine.math.LCGRandom=function(b){this._seed=b};hamonengine.math.LCGRandom.prototype.random=function(){return this._seed=(214013*this._seed+2531011)%a}})();var ROTATION_TYPE={CW:0,CCW:1};hamonengine.math=hamonengine.math||{};(function(){Math.PI2=6.283185307179586;Math.PI3_2=3*Math.PI/2;Math.PI_2=Math.PI/2;Math.HalfPI=1.5707963267948966;Math.QuarterPI=4.71238898038469;Math.maxInt32=2147483647;Math.maxUInt32=4294967296;Math.bitRound=function(a){return.5+a<<0};Math.truncate=function(a){return a>=Math.maxInt32?Math.maxInt32:~~a};Math.sqr=function(a){return a*a};Math.toDegrees=function(a){return a*Math.PI/180};Math.toRadians=function(a){return 180*a/Math.PI}})();hamonengine.math=hamonengine.math||{};
(function(){hamonengine.math.vector2=function(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b};hamonengine.math.vector2.clone=function(a){return new hamonengine.math.vector2(a.x,a.y)};hamonengine.math.vector2.prototype.clone=function(){return hamonengine.math.vector2.clone(this)};hamonengine.math.vector2.prototype.toString=function(){return"{x: '"+this.x+"', y: '"+this.y+"'}"};hamonengine.math.vector2.prototype.normalize=function(){var a=this.length;return 0<a?new hamonengine.math.vector2(this.x/
a,this.y/a):new hamonengine.math.vector2};hamonengine.math.vector2.prototype.normal=function(a){a=void 0===a?ROTATION_TYPE.CCW:a;var b=this.length;return 0<b?a===ROTATION_TYPE.CCW?new hamonengine.math.vector2(-this.y/b,this.x/b):new hamonengine.math.vector2(this.y/b,-this.x/b):new hamonengine.math.vector2};hamonengine.math.vector2.prototype.mirror=function(){return new hamonengine.math.vector2(-this.x,this.y)};hamonengine.math.vector2.prototype.flip=function(){return new hamonengine.math.vector2(this.x,
-this.y)};hamonengine.math.vector2.prototype.invert=function(){return new hamonengine.math.vector2(-this.x,-this.y)};hamonengine.math.vector2.prototype.add=function(a){return new hamonengine.math.vector2(this.x+a.x,this.y+a.y)};hamonengine.math.vector2.prototype.subtract=function(a){return new hamonengine.math.vector2(this.x-a.x,this.y-a.y)};hamonengine.math.vector2.prototype.multiply=function(a){return a instanceof hamonengine.math.vector2?this.multiplyVector(a):this.multiplyScalar(a)};hamonengine.math.vector2.prototype.multiplyScalar=
function(a){return new hamonengine.math.vector2(this.x*a,this.y*a)};hamonengine.math.vector2.prototype.multiplyVector=function(a){return new hamonengine.math.vector2(this.x*a.x,this.y*a.y)};hamonengine.math.vector2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};hamonengine.math.vector2.prototype.cross=function(a){return new hamonengine.math.vector3(0,0,this.x*a.y-this.y*a.x)};hamonengine.math.vector2.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};hamonengine.math.vector2.prototype.isEmpty=
function(){return 0===this.x&&0===this.y};$jscomp.global.Object.defineProperties(hamonengine.math.vector2.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},theta:{configurable:!0,enumerable:!0,get:function(){return(Math.atan2(this.y,this.x)+Math.PI2)%Math.PI2}},midPoint:{configurable:!0,enumerable:!0,get:function(){return new hamonengine.math.vector2(this.x/2,this.y/2)}},min:{configurable:!0,enumerable:!0,get:function(){return this.x<this.y?
this.x:this.y}},max:{configurable:!0,enumerable:!0,get:function(){return this.x>this.y?this.x:this.y}}});hamonengine.math.vector2.X_AXIS_NORMAL=new hamonengine.math.vector2(1,0);hamonengine.math.vector2.Y_AXIS_NORMAL=new hamonengine.math.vector2(0,1)})();hamonengine.math=hamonengine.math||{};
(function(){hamonengine.math.vector3=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};hamonengine.math.vector3.clone=function(a){return new hamonengine.math.vector3(a.x,a.y,a.z)};hamonengine.math.vector3.prototype.clone=function(){return hamonengine.math.vector3.clone(this)};hamonengine.math.vector3.prototype.toString=function(){return"{x: '"+this.x+"', y: '"+this.y+"', z: '"+this.z+"'}"};hamonengine.math.vector3.prototype.normalize=function(){var a=this.length;return 0<
a?new hamonengine.math.vector3(this.x/a,this.y/a,this.z/a):new hamonengine.math.vector3};hamonengine.math.vector3.prototype.invert=function(){return new hamonengine.math.vector2(-this.x,-this.y,-this.z)};hamonengine.math.vector3.prototype.add=function(a){return new hamonengine.math.vector3(this.x+a.x,this.y+a.y,this.z+a.z)};hamonengine.math.vector3.prototype.subtract=function(a){return new hamonengine.math.vector3(this.x-a.x,this.y-a.y,this.z-a.z)};hamonengine.math.vector3.prototype.multiplyScalar=
function(a){return new hamonengine.math.vector3(this.x*a,this.y*a,this.z*a)};hamonengine.math.vector3.prototype.multiplyVector=function(a){return new hamonengine.math.vector3(this.x*a.x,this.y*a.y,this.z*a.z)};hamonengine.math.vector3.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};hamonengine.math.vector3.prototype.cross=function(a){return new hamonengine.math.vector3(this.y*a.z-this.z*a.y,a.x*this.z-this.x*a.z,this.x*a.y-this.y*a.x)};hamonengine.math.vector3.prototype.equals=
function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};hamonengine.math.vector3.prototype.isEmpty=function(){return 0===this.x&&0===this.y&&0===this.z};$jscomp.global.Object.defineProperties(hamonengine.math.vector3.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},midPoint:{configurable:!0,enumerable:!0,get:function(){return new hamonengine.math.vector3(this.x/2,this.y/2,this.z/2)}},min:{configurable:!0,enumerable:!0,
get:function(){var a=this.x<this.y?this.x:this.y;return a<this.z?a:this.z}},max:{configurable:!0,enumerable:!0,get:function(){var a=this.x>this.y?this.x:this.y;return a>this.z?a:this.z}}});hamonengine.math.vector3.X_AXIS_NORMAL=new hamonengine.math.vector3(1,0,0);hamonengine.math.vector3.Y_AXIS_NORMAL=new hamonengine.math.vector3(0,1,0);hamonengine.math.vector3.Z_AXIS_NORMAL=new hamonengine.math.vector3(0,0,1)})();hamonengine.math=hamonengine.math||{};hamonengine.math.datastructures=hamonengine.math.datastructures||{};
(function(){hamonengine.math.datastructures.tree=function(a){a=void 0===a?{}:a;if(a instanceof hamonengine.math.datastructures.tree){var b;a.top=null!=(b=a.top)?b:a.parent;for(b=a.first;null!=b;)this.append(b.clone()),b=b.next}this._top=a.top||null;this._parent=a.parent||null;this._first=a.first||null;this._last=a.last||null;this._prev=this._next=null};hamonengine.math.datastructures.tree.prototype.clone=function(){return new hamonengine.math.datastructures.tree(this)};hamonengine.math.datastructures.tree.prototype.append=
function(a){var b;a._top=null!=(b=this.top)?b:this;a._parent=this;this.last?(a._prev=this.last,this._last=this._last._next=a):this._first=this._last=a};hamonengine.math.datastructures.tree.prototype.prepend=function(a){var b;a._top=null!=(b=this.top)?b:this;a._parent=this;this.first?(a._next=this.first,this._first=this._first._prev=a):this._first=this._last=a};hamonengine.math.datastructures.tree.prototype.__internalClear=function(a){for(var b=this.first;null!==b;){var c=b.next;b._prev=b._next=b._parent=
b._top=null;a&&b.clear();b=c}this._first=this._last=null};hamonengine.math.datastructures.tree.prototype.clear=function(){this.__internalClear(!0)};hamonengine.math.datastructures.tree.prototype.empty=function(){this.__internalClear(!1)};hamonengine.math.datastructures.tree.prototype.findChildByIndex=function(a){var b=0;return hamonengine.events.node.searchByPredicate(this.first,function(c){return null!==c&&0<a&&b++<a})};hamonengine.math.datastructures.tree.searchAncestorByPredicate=function(a,b){for(;b&&
b(a);)a=a.parent;return a};hamonengine.math.datastructures.tree.searchByPredicate=function(a,b){for(;b&&b(a);)a=a.next;return a};hamonengine.math.datastructures.tree.findLast=function(a){return hamonengine.events.node.searchByPredicate(a,function(b){return null!==b&&null!==b.next})};$jscomp.global.Object.defineProperties(hamonengine.math.datastructures.tree.prototype,{first:{configurable:!0,enumerable:!0,get:function(){return this._first}},last:{configurable:!0,enumerable:!0,get:function(){return this._last}},
next:{configurable:!0,enumerable:!0,get:function(){return this._next},set:function(a){this._next=a}},prev:{configurable:!0,enumerable:!0,get:function(){return this._prev},set:function(a){this._prev=a}},parent:{configurable:!0,enumerable:!0,get:function(){return this._parent}},top:{configurable:!0,enumerable:!0,get:function(){return this._top}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.interval=function(a,b){this.min=void 0===a?0:a;this.max=void 0===b?0:b};hamonengine.geometry.interval.clone=function(a){return new hamonengine.geometry.interval(a.min,a.max)};hamonengine.geometry.interval.prototype.clone=function(){return hamonengine.geometry.interval.clone(this)};hamonengine.geometry.interval.prototype.toString=function(){return"{min: '"+this.min+"', max: '"+this.max+"'}"};hamonengine.geometry.interval.prototype.mirror=function(){return new hamonengine.geometry.interval(this.max,
this.min)};hamonengine.geometry.interval.prototype.add=function(a){return new hamonengine.geometry.interval(this.min+a.min,this.max+a.max)};hamonengine.geometry.interval.prototype.subtract=function(a){return new hamonengine.geometry.interval(this.min-a.min,this.max-a.max)};hamonengine.geometry.interval.prototype.multiplyScalar=function(a){return new hamonengine.geometry.interval(this.min*a,this.max*a)};hamonengine.geometry.interval.prototype.overlap=function(a){if(this.isPoint&&a.isPoint)return this.min===
a.min?new hamonengine.geometry.interval(0,0):new hamonengine.geometry.interval(NaN,NaN);if(this.isPoint||a.isPoint){var b=this;this.isPoint||(b=a,a=this);var c=NaN,d=NaN;a.contains(b)&&(b.min-a.min<a.max-b.min?(c=a.min,d=b.min):(c=b.min,d=a.max));return new hamonengine.geometry.interval(c,d)}c=b=NaN;this.isPoint||a.isPoint||(d=function(e,f){return e>=f.min&&e<=f.max},d(this.min,a)?b=this.min:d(a.min,this)&&(b=a.min),d(this.max,a)?c=this.max:d(a.max,this)&&(c=a.max));return new hamonengine.geometry.interval(b,
c)};hamonengine.geometry.interval.prototype.contains=function(a){return a.min>=this.min&&a.max<=this.max};hamonengine.geometry.interval.prototype.getOrientation=function(a){var b=this.midPoint;a=a.midPoint;return a===b?0:a<b?-1:1};hamonengine.geometry.interval.prototype.getDistance=function(a){return Math.abs(this.midPoint-a.midPoint)};hamonengine.geometry.interval.prototype.getMinimumDistance=function(a){return this.getDistanceParams(a).min};hamonengine.geometry.interval.prototype.getMaximumDistance=
function(a){return this.getDistanceParams(a).max};hamonengine.geometry.interval.prototype.getDistanceParams=function(a){var b=Math.abs(this.min-a.min);a=Math.abs(this.max-a.max);return{min:b<a?b:a,max:b>a?b:a}};hamonengine.geometry.interval.prototype.getPointDistance=function(a,b){var c=this;this.isPoint||(c=a,a=this);return 0<b?a.max-c.max:c.max-a.min};$jscomp.global.Object.defineProperties(hamonengine.geometry.interval.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.abs(this.max-
this.min)}},isLine:{configurable:!0,enumerable:!0,get:function(){return!isNaN(this.min)&&!isNaN(this.max)}},isPoint:{configurable:!0,enumerable:!0,get:function(){return this.isLine&&this.min===this.max}},midPoint:{configurable:!0,enumerable:!0,get:function(){return this.isPoint?this.min:(this.max-this.min)/2}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.lineSegment=function(a,b,c,d,e){e=void 0===e?{}:e;this._coords=e.coords||[void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d];this._offset=e.offset||0;this._normalOrientation=void 0!==e.normalOrientation?e.normalOrientation:ROTATION_TYPE.CW;this._direction=new hamonengine.math.vector2(this.x2-this.x,this.y2-this.y)};hamonengine.geometry.lineSegment.prototype.clone=function(){return new hamonengine.geometry.lineSegment(this.x,this.y,this.x2,this.y2,{coords:[].concat($jscomp.arrayFromIterable(this._coords)),
offset:this._offset})};hamonengine.geometry.lineSegment.prototype.toString=function(){return"({x1: "+this.x+", y1: "+this.y+"}, {x2: "+this.x2+", y2: "+this.y2+"})"};hamonengine.geometry.lineSegment.prototype.toVertices=function(){return[new hamonengine.math.vector2(this.x,this.y),new hamonengine.math.vector2(this.x2,this.y2)]};hamonengine.geometry.lineSegment.prototype.toPolygon=function(){return new hamonengine.geometry.polygon({vertices:this.toVertices()})};hamonengine.geometry.lineSegment.prototype.equals=
function(a){return this.x===a.x&&this.y===a.y&&this.x2===a.x2&&this.y2===a.y2||this.x===a.x2&&this.y===a.y2&&this.x2===a.x&&this.y2===a.y};hamonengine.geometry.lineSegment.prototype.sharesEndPoint=function(a){return this.x2===a.x&&this.y2===a.y||this.x===a.x2&&this.y===a.y2};hamonengine.geometry.lineSegment.prototype.sharesPoints=function(a){return this.x===a.x&&this.y===a.y||this.x2===a.x2&&this.y2===a.y2||this.sharesEndPoint(a)};hamonengine.geometry.lineSegment.prototype.translate=function(a){a=
a||new hamonengine.math.vector2(0,0);return new hamonengine.geometry.lineSegment(this.x+a.x,this.y+a.y,this.x2+a.x,this.y2+a.y)};hamonengine.geometry.lineSegment.prototype.rotate=function(a,b,c){var d=void 0===c?{}:c;c=d.sinTheta;d=d.cosTheta;a=a||0;b=b||new hamonengine.math.vector2(0,0);c=c||Math.sin(a);d=d||Math.cos(a);var e=this.x-b.x,f=this.y-b.y,g=this.x2-b.x,k=this.y2-b.y;hamonengine.geometry.settings.coordinateSystem===COORDINATE_SYSTEM.RHS?(a=e*d-f*c,e=e*c+f*d,f=g*d-k*c,c=g*c+k*d):(a=e*d+
f*c,e=-(e*c)+f*d,f=g*d+k*c,c=-(g*c)+k*d);a+=b.x;e+=b.y;f+=b.x;c+=b.y;return new hamonengine.geometry.lineSegment(a,e,f,c)};hamonengine.geometry.lineSegment.prototype.rotateAtCenter=function(a){return this.rotate(a,this.center)};hamonengine.geometry.lineSegment.prototype.scale=function(a,b,c){var d=void 0===c?{}:c;c=d.xFlipped;d=d.yFlipped;a=a||new hamonengine.math.vector2(0,0);b=b||new hamonengine.math.vector2(0,0);c=c||0>a.x;d=d||0>a.y;if(!c&&d||c&!d){c=this.x2*a.x+b.x;d=this.y2*a.y+b.y;var e=this.x*
a.x+b.x;a=this.y*a.y+b.y}else c=this.x*a.x+b.x,d=this.y*a.y+b.y,e=this.x2*a.x+b.x,a=this.y2*a.y+b.y;return new hamonengine.geometry.lineSegment(c,d,e,a)};hamonengine.geometry.lineSegment.prototype.scaleAtCenter=function(a){return this.scale(a,this.center.subtract(this.center.multiplyVector(a)))};hamonengine.geometry.lineSegment.prototype.isCollision=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;return a instanceof hamonengine.geometry.rect?this.isCollisionRect(a,b):a instanceof hamonengine.geometry.polygon?
this.isCollisionPolygon(a,b):new hamonengine.math.vector2(0,0)};hamonengine.geometry.lineSegment.prototype.isCollisionPolygon=function(a,b){void 0===b&&new hamonengine.math.vector2;a instanceof hamonengine.geometry.polygon||console.warn("[hamonengine.geometry.lineSegment.isCollisionPolygon] The polygon parameter is not of type hamonengine.geometry.polygon!");b=a.normals;for(var c=0;c<b.length;c++){var d=this.project(b[c]),e=a.project(b[c]);if(!d.overlap(e).isLine)return new hamonengine.math.vector2}b=
this.normal;a=a.project(b);c=this.project(b);if(!a.overlap(c).isLine)return new hamonengine.math.vector2;a=a.getPointDistance(c,b);a=a<hamonengine.geometry.settings.collisionDetection.floor?0:a;return b.multiply(a)};hamonengine.geometry.lineSegment.prototype.isCollisionRect=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;a instanceof hamonengine.geometry.rect||console.warn("[hamonengine.geometry.lineSegment.isCollisionRect] The rect parameter is not of type hamonengine.geometry.rect!");
b=function(e,f){return e.overlap(f).isLine?!0:!1};var c=new hamonengine.geometry.interval(a.y,a.y+a.height);if(!b(this.project(hamonengine.math.vector2.Y_AXIS_NORMAL),c))return new hamonengine.math.vector2;c=new hamonengine.geometry.interval(a.x,a.x+a.width);if(!b(this.project(hamonengine.math.vector2.X_AXIS_NORMAL),c))return new hamonengine.math.vector2;c=this.normal;a=a.project(c);var d=this.project(c);if(!b(a,d))return new hamonengine.math.vector2;b=a.getPointDistance(d,c);b=b<hamonengine.geometry.settings.collisionDetection.floor?
0:b;return c.multiply(b)};hamonengine.geometry.lineSegment.prototype.project=function(a){var b;var c=b=a.dot({x:this.x,y:this.y});a=a.dot({x:this.x2,y:this.y2});a<b?b=a:a>c&&(c=a);return new hamonengine.geometry.interval(b,c)};hamonengine.geometry.lineSegment.prototype.move=function(a,b){b=b?b._offset+(b.sharesEndPoint(this)?2:4):0;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.x2;a[b+3]=this.y2;this._coords=a;this._offset=b};$jscomp.global.Object.defineProperties(hamonengine.geometry.lineSegment.prototype,
{x:{configurable:!0,enumerable:!0,get:function(){return this._coords[this._offset+0]},set:function(a){this._coords[this._offset+0]=a}},y:{configurable:!0,enumerable:!0,get:function(){return this._coords[this._offset+1]},set:function(a){this._coords[this._offset+1]=a}},x2:{configurable:!0,enumerable:!0,get:function(){return this._coords[this._offset+2]},set:function(a){this._coords[this._offset+2]=a}},y2:{configurable:!0,enumerable:!0,get:function(){return this._coords[this._offset+3]},set:function(a){this._coords[this._offset+
3]=a}},length:{configurable:!0,enumerable:!0,get:function(){return this._direction.length}},center:{configurable:!0,enumerable:!0,get:function(){return this._direction.midPoint}},slope:{configurable:!0,enumerable:!0,get:function(){return this._direction.y/this._direction.x}},normal:{configurable:!0,enumerable:!0,get:function(){return this._direction.normal(this.normalOrientation)}},normals:{configurable:!0,enumerable:!0,get:function(){return[this.normal]}},normalOrientation:{configurable:!0,enumerable:!0,
get:function(){return this._normalOrientation},set:function(a){this._normalOrientation=a}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.polyChain=function(a){a=void 0===a?{}:a;a instanceof hamonengine.geometry.polyChain&&(a={lines:a.lines});this._lines=[];this._coords=[];this._normals=a.normals||[];this._dirty=DIRTY_FLAG.ALL;if(a.lines&&0<a.lines.length)for(var b=0;b<a.lines.length;b++)a.lines[b].move(this._coords,0<a.lines.length?a.lines[b-1]:null),this._lines.push(a.lines[b])};hamonengine.geometry.polyChain.prototype.clone=function(){return new hamonengine.geometry.polyChain({lines:this.lines})};hamonengine.geometry.polyChain.prototype.toString=
function(){return this.lines.reduce(function(a,b){return a.toString()+", "+b.toString()})};hamonengine.geometry.polyChain.prototype.toVertices=function(){for(var a=[],b=0;b+1<this._coords.length;b+=2){var c=(b+2)%this._coords.length;this._coords[b]===this._coords[c]&&this._coords[b+1]===this._coords[c+1]||a.push(new hamonengine.math.vector2(this._coords[b],this._coords[b+1]))}return a};hamonengine.geometry.polyChain.prototype.toPolygon=function(){return new hamonengine.geometry.polygon({vertices:this.toVertices()})};
hamonengine.geometry.polyChain.prototype.addVertex=function(a,b){var c=2<=this._coords.length?this._coords.length-2:0;if(this._coords[c]!==a||this._coords[c+1]!==b)this._coords.push(a),this._coords.push(b),this._dirty=DIRTY_FLAG.ALL,2<this._coords.length&&this.lines.push(new hamonengine.geometry.lineSegment(0,0,0,0,{coords:this._coords,offset:c}))};hamonengine.geometry.polyChain.prototype.addLine=function(a){var b=0<this.lines.length?this.lines[this.lines.length-1]:null;if(b&&!b.sharesEndPoint(a)){var c=
new hamonengine.geometry.lineSegment(b.x2,b.y2,a.x,a.y);c.move(this._coords,b);this.lines.push(c);b=c}a.move(this._coords,b);this.lines.push(a);this._dirty=DIRTY_FLAG.ALL};hamonengine.geometry.polyChain.prototype.translate=function(a){a=a||new hamonengine.math.vector2(0,0);return new hamonengine.geometry.polyChain({lines:this.lines.map(function(b){return b.translate(a)})})};hamonengine.geometry.polyChain.prototype.rotate=function(a,b){a=a||0;b=b||new hamonengine.math.vector2(0,0);var c=Math.sin(a),
d=Math.cos(a);return new hamonengine.geometry.polyChain({lines:this.lines.map(function(e){return e.rotate(a,b,{sinTheta:c,cosTheta:d})})})};hamonengine.geometry.polyChain.prototype.scale=function(a,b){a=a||new hamonengine.math.vector2(0,0);b=b||new hamonengine.math.vector2(0,0);var c=0>a.x,d=0>a.y;return new hamonengine.geometry.polyChain({lines:this.lines.map(function(e){return e.scale(a,b,{xFlipped:c,yFlipped:d})})})};hamonengine.geometry.polyChain.prototype.isCollision=function(a,b){b=void 0===
b?new hamonengine.math.vector2:b;for(var c=new hamonengine.math.vector2,d=0;d<this.lines.length;d++){var e=a.isCollision(this.lines[d],b);0<e.length&&(c=c.add(e))}return c};$jscomp.global.Object.defineProperties(hamonengine.geometry.polyChain.prototype,{lines:{configurable:!0,enumerable:!0,get:function(){return this._lines}},normals:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.NORMAL)&&(this._normals=this.lines.map(function(a){return a.normal}),bitflag.toggle(this._dirty,
DIRTY_FLAG.NORMAL,!1));return this._normals}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.polygon=function(a){a=void 0===a?{}:a;a instanceof hamonengine.geometry.polygon&&(a={vertices:[].concat($jscomp.arrayFromIterable(a.vertices))});this._vertices=a.vertices||[];this._edges=[];this._normals=[];this._dimensions={center:null,max:null,min:null,minVertex:null,maxVertex:null};this._dirty=DIRTY_FLAG.ALL;this._shapeType=SHAPE_TYPE.UNKNOWN};hamonengine.geometry.polygon.prototype.clone=function(){return new hamonengine.geometry.polygon(this)};hamonengine.geometry.polygon.prototype.toString=
function(){for(var a="",b=0;b<this.vertices.length;b++)a+=(""!==a?",":"")+this.vertices[b].toString();return"["+a+"]"};hamonengine.geometry.polygon.prototype.toRect=function(){return new hamonengine.geometry.rect(this.min.x,this.min.y,this.max.x-this.min.x,this.max.y-this.min.y)};hamonengine.geometry.polygon.prototype.addVertex=function(a,b){this._vertices.push(new hamonengine.math.vector2(a,b));this._dirty=DIRTY_FLAG.ALL};hamonengine.geometry.polygon.prototype.addLine=function(a){this._vertices.push.apply(this._vertices,
$jscomp.arrayFromIterable(a.toVertices()));this._dirty=DIRTY_FLAG.ALL};hamonengine.geometry.polygon.prototype.reverse=function(){for(var a=[],b=this.vertices.length-1;0<=b;b--)a.push(this.vertices[b]);return new hamonengine.geometry.polygon({vertices:a})};hamonengine.geometry.polygon.prototype.translate=function(a){a=a||new hamonengine.math.vector2(0,0);for(var b=[],c=0;c<this.vertices.length;c++)b.push(this.vertices[c].add(a));return new hamonengine.geometry.polygon({vertices:b})};hamonengine.geometry.polygon.prototype.rotate=
function(a,b){a=a||0;b=b||new hamonengine.math.vector2(0,0);var c=Math.sin(a);a=Math.cos(a);for(var d=[],e=0;e<this.vertices.length;e++){var f=this.vertices[e].x-b.x,g=this.vertices[e].y-b.y;if(hamonengine.geometry.settings.coordinateSystem===COORDINATE_SYSTEM.RHS){var k=f*a-g*c;f=f*c+g*a}else k=f*a+g*c,f=-(f*c)+g*a;d.push(new hamonengine.math.vector2(k+b.x,f+b.y))}return new hamonengine.geometry.polygon({vertices:d})};hamonengine.geometry.polygon.prototype.rotateAtCenter=function(a){return this.rotate(a,
this.center)};hamonengine.geometry.polygon.prototype.scale=function(a,b){a=a||new hamonengine.math.vector2(0,0);b=b||new hamonengine.math.vector2(0,0);var c=0>a.x,d=0>a.y,e=[];if(!c&&d||c&!d)for(c=this.vertices.length-1;0<=c;c--)e.push(this.vertices[c].multiplyVector(a).add(b));else for(c=0;c<this.vertices.length;c++)e.push(this.vertices[c].multiplyVector(a).add(b));return new hamonengine.geometry.polygon({vertices:e})};hamonengine.geometry.polygon.prototype.scaleAtCenter=function(a){return this.scale(a,
this.center.subtract(this.center.multiplyVector(a)))};hamonengine.geometry.polygon.prototype.mirror=function(a){return a?this.scaleAtCenter(new hamonengine.math.vector2(-1,1)):this};hamonengine.geometry.polygon.prototype.flip=function(a){return a?this.scaleAtCenter(new hamonengine.math.vector2(1,-1)):this};hamonengine.geometry.polygon.prototype.isCollision=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;return a instanceof hamonengine.geometry.rect?a.toPolygon().isCollisionPolygon(this,
b):a instanceof hamonengine.geometry.polygon?this.isCollisionPolygon(a,b):a instanceof hamonengine.geometry.lineSegment||a instanceof hamonengine.geometry.polyChain?a.isCollision(this,b):new hamonengine.math.vector2(0,0)};hamonengine.geometry.polygon.prototype.isCollisionPolygon=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;if(!(a instanceof hamonengine.geometry.polygon))throw"Parameter polygon is not of type hamonengine.geometry.polygon.";for(var c=NaN,d,e=a.normals,f=0;f<e.length;f++){var g=
this.project(e[f]),k=a.project(e[f]),h=g.overlap(k);if(!h.isLine)return new hamonengine.math.vector2;h=h.length;if(g.contains(k)||k.contains(g))h+=g.getMinimumDistance(k);if(isNaN(c)||h<c)c=h,d=e[f]}e=this.normals;for(f=0;f<e.length;f++){g=this.project(e[f]);k=a.project(e[f]);h=g.overlap(k);if(!h.isLine)return new hamonengine.math.vector2;h=h.length;if(g.contains(k)||k.contains(g))h+=g.getMinimumDistance(k);if(isNaN(c)||h<c)c=h,d=e[f]}c=c<hamonengine.geometry.settings.collisionDetection.floor?0:c;
a=d.multiply(c);0<=a.dot(b)&&(a=a.invert());return a};hamonengine.geometry.polygon.prototype.isContained=function(a){return new hamonengine.math.vector2};hamonengine.geometry.polygon.prototype.project=function(a){var b=0,c=0;if(0<this.vertices.length){c=b=a.dot(this.vertices[0]);for(var d=1;d<this.vertices.length;d++){var e=a.dot(this.vertices[d]);e<b?b=e:e>c&&(c=e)}}return new hamonengine.geometry.interval(b,c)};hamonengine.geometry.polygon.calcEdges=function(a){a=void 0===a?[]:a;for(var b=[],c=
0;c<a.length;c++)b.push(a[(c+1)%a.length].subtract(a[c]));return b};hamonengine.geometry.polygon.calcNormals=function(a){a=void 0===a?[]:a;return a.map(function(b){return b.normal(ROTATION_TYPE.CW)})};hamonengine.geometry.polygon.calcDimensions=function(a){a=void 0===a?[]:a;for(var b=null,c=null,d=NaN,e=NaN,f=NaN,g=NaN,k=0;k<a.length;k++){d=d>a[k].x?d:a[k].x;e=e<a[k].x?e:a[k].x;f=f>a[k].y?f:a[k].y;g=g<a[k].y?g:a[k].y;if(null===b||b.x>a[k].x&&b.y>a[k].y)b=a[k];if(null===c||c.x<a[k].x&&c.y<a[k].y)c=
a[k]}return{max:new hamonengine.math.vector2(d,f),min:new hamonengine.math.vector2(e,g),center:new hamonengine.math.vector2(e+(d-e)/2,g+(f-g)/2),minVertex:b,maxVertex:c}};hamonengine.geometry.polygon.calcShapeType=function(a){a=void 0===a?[]:a;for(var b=0,c=0;c<a.length;c++){var d=a[(c+1)%a.length],e=a[(c+2)%a.length],f=d.subtract(a[c]);d=e.subtract(d);b+=0<d.cross(f).z?1:-1}return a.length===b?SHAPE_TYPE.CONVEX:SHAPE_TYPE.CONCAVE};$jscomp.global.Object.defineProperties(hamonengine.geometry.polygon.prototype,
{vertices:{configurable:!0,enumerable:!0,get:function(){return this._vertices}},edges:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.EDGE)&&(this._edges=hamonengine.geometry.polygon.calcEdges(this.vertices),this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.EDGE,!1));return this._edges}},normals:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.NORMAL)&&(this._normals=hamonengine.geometry.polygon.calcNormals(this.edges),this._dirty=
bitflag.toggle(this._dirty,DIRTY_FLAG.NORMAL,!1));return this._normals}},center:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.DIMS)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.DIMS,!1));return this._dimensions.center}},max:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.DIMS)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),
this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.DIMS,!1));return this._dimensions.max}},min:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.DIMS)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.DIMS,!1));return this._dimensions.min}},minVertex:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.DIMS)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),
this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.DIMS,!1));return this._dimensions.minVertex}},maxVertex:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.DIMS)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.DIMS,!1));return this._dimensions.maxVertex}},width:{configurable:!0,enumerable:!0,get:function(){return this.max.x-this.min.x}},height:{configurable:!0,enumerable:!0,get:function(){return this.max.y-
this.min.y}},shapeType:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,DIRTY_FLAG.SHAPE)&&(this._shapeType=hamonengine.geometry.polygon.calcShapeType(this.vertices),this._dirty=bitflag.toggle(this._dirty,DIRTY_FLAG.SHAPE,!1));return this._shapeType}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.rect=function(a,b,c,d){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.width=void 0===c?0:c;this.height=void 0===d?0:d};hamonengine.geometry.rect.prototype.clone=function(){return new hamonengine.geometry.rect(this.x,this.y,this.width,this.height)};hamonengine.geometry.rect.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"};hamonengine.geometry.rect.prototype.toPolygon=function(){return new hamonengine.geometry.polygon({vertices:[new hamonengine.math.vector2(this.x,
this.y),new hamonengine.math.vector2(this.x+this.width,this.y),new hamonengine.math.vector2(this.x+this.width,this.y+this.height),new hamonengine.math.vector2(this.x,this.y+this.height)]})};hamonengine.geometry.rect.prototype.translate=function(a){a=a||new hamonengine.math.vector2(0,0);return new hamonengine.geometry.rect(this.x+a.x,this.y+a.y,this.width,this.height)};hamonengine.geometry.rect.prototype.isCollision=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;return a instanceof hamonengine.geometry.rect?
this.isCollisionRect(a,b):a instanceof hamonengine.geometry.polygon?a.isCollision(this,b):a instanceof hamonengine.math.vector2?this.isCollisionPoint(a):a instanceof hamonengine.geometry.lineSegment||a instanceof hamonengine.geometry.polyChain?a.isCollision(this,b):new hamonengine.math.vector2(0,0)};hamonengine.geometry.rect.prototype.isCollisionRect=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;a instanceof hamonengine.geometry.rect||console.warn("[hamonengine.geometry.rect.isCollision] The otherRect parameter is not of type hamonengine.geometry.rect!");
var c=NaN,d=new hamonengine.geometry.interval(this.y,this.y+this.height),e=new hamonengine.geometry.interval(a.y,a.y+a.height),f=d.overlap(e);if(!f.isLine)return new hamonengine.math.vector2;f=f.length;if(d.contains(e)||e.contains(d))f+=d.getMinimumDistance(e);if(isNaN(c)||f<c){c=f;var g=hamonengine.math.vector2.Y_AXIS_NORMAL}d=new hamonengine.geometry.interval(this.x,this.x+this.width);a=new hamonengine.geometry.interval(a.x,a.x+a.width);e=d.overlap(a);if(!e.isLine)return new hamonengine.math.vector2;
e=e.length;if(d.contains(a)||a.contains(d))e+=d.getMinimumDistance(a);if(isNaN(c)||e<c)c=e,g=hamonengine.math.vector2.X_AXIS_NORMAL;c=c<hamonengine.geometry.settings.collisionDetection.floor?0:c;c=g.multiply(c);0<=c.dot(b)&&(c=c.invert());return c};hamonengine.geometry.rect.prototype.isCollisionPoint=function(a){var b=new hamonengine.math.vector2;if(a.x>=this.x&&a.x<=this.right&&a.y>=this.y&&a.y<=this.bottom){var c=a.x-this.x,d=this.right-a.x;b.x=c<d?c:d;c=a.y-this.y;a=this.bottom-a.y;b.y=c<a?c:a}return b};
hamonengine.geometry.rect.prototype.isContained=function(a,b){b instanceof hamonengine.geometry.rect||console.warn("[hamonengine.geometry.rect.isContained] The rect parameter is not of type hamonengine.geometry.rect!");var c=new hamonengine.math.vector2,d=a.x+b.x,e=a.y+b.y;d<this.x?(hamonengine.debug&&console.debug("[hamonengine.geometry.rect.isContained] Outside -x: ("+d+", "+e+")"),c.x=-1):a.x+b.right>this.right&&(hamonengine.debug&&console.debug("[hamonengine.geometry.rect.isContained] Outside +x: ("+
d+", "+e+")"),c.x=1);e<this.y?(hamonengine.debug&&console.debug("[hamonengine.geometry.rect.isContained] Outside -y: ("+d+", "+e+")"),c.y=-1):a.y+b.bottom>this.bottom&&(hamonengine.debug&&console.debug("[hamonengine.geometry.rect.isContained] Outside +y: ("+d+", "+e+")"),c.y=1);return c};hamonengine.geometry.rect.prototype.project=function(a){var b=max=a.dot(new hamonengine.math.vector2(this.x,this.y)),c=function(d){d=a.dot(d);d<b?b=d:d>max&&(max=d)};c(new hamonengine.math.vector2(this.x+this.width,
this.y));c(new hamonengine.math.vector2(this.x+this.width,this.y+this.height));c(new hamonengine.math.vector2(this.x,this.y+this.height));return new hamonengine.geometry.interval(b,max)};$jscomp.global.Object.defineProperties(hamonengine.geometry.rect.prototype,{right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height}}})})();var COORDINATE_SYSTEM={LHS:0,RHS:1},COLLISION_TYPES={NONE:0,EDGE:1,INSIDE:2},SHAPE_TYPE={UNKNOWN:0,CONVEX:1,CONCAVE:2};hamonengine.geometry=hamonengine.geometry||{};hamonengine.geometry.settings=hamonengine.geometry.settings||{collisionDetection:{floor:.01,limit:15},coordinateSystem:COORDINATE_SYSTEM.RHS};hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.album=function(a){a=void 0===a?{}:a;a instanceof hamonengine.audio.album&&(a={audioResource:a._audioResource,tracks:a._tracks,trackIndex:a._trackIndex,url:a._url,name:a._name});this._audioResource=a.audioResource||new hamonengine.audio.audioext;this._tracks=a.tracks||{};this._trackIndex=a.trackIndex||[];this._url=a.url||"";this._name=a.name||"";hamonengine.debug&&(console.debug("[hamonengine.audio.album.constructor] Name: '"+this.name+"'"),console.debug("[hamonengine.audio.album.constructor] Url: '"+
this._url+"'"))};hamonengine.audio.album.prototype.clone=function(){return new hamonengine.audio.album(this)};hamonengine.audio.album.prototype.load=function(a){var b=this,c,d,e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:a=a||b._url;if("string"!==typeof a){k.jumpTo(2);break}return k.yield(connect.get(a),3);case 3:c=k.yieldResult,a=JSON.parse(c.data);case 2:return b._name=b._name||a.name,k.yield(b._audioResource.load(a.albumUrl),4);case 4:d=k.yieldResult;
for(e=0;e<a.tracks.length;e++)f=a.tracks[e],g=f.name.toLowerCase(),b._trackIndex.push(g),b._tracks[g]=new hamonengine.audio.track({audioext:b._audioResource.clone(),name:f.name,trackBegin:f.begin,trackEnd:f.end});return k.return(d)}})};hamonengine.audio.album.prototype.getTrack=function(a){return this._tracks[a.toLowerCase()].clone()};hamonengine.audio.album.prototype.getTrackByOrdinal=function(a){return this._tracks[this._trackIndex[a]].clone()};hamonengine.audio.album.prototype.release=function(){this._audioResource&&
this._audioResource.release();this._tracks.forEach(function(a){return a&&a.release()});this._tracks=[];delete this._audioResource};$jscomp.global.Object.defineProperties(hamonengine.audio.album.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},length:{configurable:!0,enumerable:!0,get:function(){return this._trackIndex.length}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._audioResource.isLoaded()}}})})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.audioext=function(a){a=void 0===a?{}:a;a instanceof hamonengine.audio.audioext&&(a={audio:a._audio,src:a._src,loop:a._loop,buffer:a._buffer,resourceState:a._resourceState,audioCtx:a._audio?a._audioCtx:null,gainNode:a._audio?a._gainNode:null,panNode:a._audio?a._panNode:null,mediaSource:a._audio?a._mediaSource:null});this._loop=void 0!==a.loop?a.loop:!1;this._src=a.src;this._audio=a.audio;this._buffer=a.buffer;this._fallbackSourceURLs=[];if(this.audio){var b=this.audio.children;
if(0<b.length)for(var c=0;c<b.length;c++)this._fallbackSourceURLs.push(b[c].src)}this._resourceState=a.resourceState||0;this._playingState=5;this._startTime=0;this._mediaSource=a.mediaSource;this._audioNodes=[];this._audioCtx=a.audioCtx||new AudioContext;this._gainNode=a.gainNode||this._audioCtx.createGain();this._panNode=a.panNode||new StereoPannerNode(this._audioCtx,{pan:0});this._audioListenerDelegate=null;hamonengine.debug&&(console.debug("[hamonengine.audio.audioext.constructor] ResourceState: "+
this._resourceState),console.debug("[hamonengine.audio.audioext.constructor] PlayingState: "+this._playingState))};hamonengine.audio.audioext.prototype.clone=function(){return new hamonengine.audio.audioext(this)};hamonengine.audio.audioext.prototype.load=function(a){a=void 0===a?"":a;var b=this,c,d,e,f,g,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:if(b.isLoaded)return h.return(Promise.resolve(b));b.audio?(a=a?a:b.audio.src,b.audio.load()):a=a?a:b.src;
b._resourceState=1;c=function(l){b.audio?b._mediaSource||(b._mediaSource=b.context.createMediaElementSource(b.audio),b._mediaSource.connect(b._gainNode).connect(b._panNode).connect(b.context.destination)):b._buffer=l;b._src=a;b._resourceState=2;b.audio&&b.audio.removeEventListener("loadeddata",function(){return c()},!1);hamonengine.debug&&console.debug("[hamonengine.audio.audioext.load] Audio '"+b.src+"' has loaded successfully.");return Promise.resolve(b)};d=function(l){b._resourceState=3;b._buffer=
null;l="The audio '"+a+"' could not be loaded.  Due to '"+(l instanceof String?l:l.statusText||l)+"'.";b.audio&&(b.audio.removeEventListener("error",function(m){return d(m)},!1),b.audio.removeEventListener("stalled",function(m){return d(m)},!1));return Promise.reject(l)};if(b.audio)return b.audio.addEventListener("error",function(l){return d(l)},!1),b.audio.addEventListener("stalled",function(l){return d(l)},!1),b.audio.addEventListener("ended",function(){return b.onAudioEnd()},!1),0===b.audio.readyState?
(b.audio.addEventListener("loadeddata",function(){return c()},!1),h.return(Promise.resolve(b))):h.return(c());h.setCatchFinallyBlocks(3);return h.yield(connect.get(a,{responseType:"arraybuffer"}),5);case 5:return e=h.yieldResult,f=e.data,g=c,h.yield(b.context.decodeAudioData(f),6);case 6:return h.return(g(h.yieldResult));case 3:return k=h.enterCatchBlock(),h.return(d(k))}})};hamonengine.audio.audioext.prototype.play=function(a,b){var c=this,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==
e.nextAddress){if(c.isPlaying)return e.jumpTo(0);c._startTime=c.context.currentTime;return"suspended"!==c.context.state?e.jumpTo(3):e.yield(c.context.resume(),3)}if(c.isPaused)return c._playingState=4,e.return();c._playingState=4;if(c.audio)return c.audio.currentTime=a,e.return(c.audio.play());c._mediaSource=c.context.createBufferSource();c._mediaSource.connect(c._gainNode).connect(c._panNode);c._mediaSource.addEventListener("ended",function(f){return c.onAudioEnd(f)},!1);for(d=0;d<c._audioNodes.length;d++)c._mediaSource.connect(c._audioNodes[d]);
c._mediaSource.connect(c.context.destination);b=b||c.duration;c._mediaSource.buffer=c.buffer;(c._mediaSource.loop=c.loop)?(c._mediaSource.loopStart=a,c._mediaSource.loopEnd=b,c._mediaSource.start(0,a)):c._mediaSource.start(0,a,b-a);return e.return(Promise.resolve())})};hamonengine.audio.audioext.prototype.pause=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){if(a.isPlaying)return a._playingState=6,b.return(a.context.suspend());b.jumpToEnd()})};hamonengine.audio.audioext.prototype.stop=
function(a){a=void 0===a?{}:a;var b=void 0===a.suspend?!0:a.suspend,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress){c._playingState=5;if(!c.audio)return c._mediaSource&&(c._mediaSource.disconnect(),c._mediaSource.stop(0),c._mediaSource._userStopped=!0,c._mediaSource=null),d.jumpTo(2);c.audio.currentTime=0;return d.yield(c.audio.pause(),2)}return d.return(b?c.context.suspend():Promise.resolve())})};hamonengine.audio.audioext.prototype.connect=function(a){this._mediaSource&&
this._mediaSource instanceof HTMLAudioElement&&this._mediaSource.connect(a);this._audioNodes.push(a);return a};hamonengine.audio.audioext.prototype.disconnect=function(a){this._mediaSource&&this._mediaSource instanceof HTMLAudioElement&&this._mediaSource.disconnect(a);this._audioNodes=this._audioNodes.filter(function(b){return b!==a});return a};hamonengine.audio.audioext.prototype.release=function(){var a=this;this.stop({suspend:!0});this.audio&&(this.audio.removeEventListener("ended",function(){return a.onAudioEnd()},
!1),delete this._audio);this._mediaSource&&(this._mediaSource.removeEventListener("ended",function(b){return a.onAudioEnd(b)},!1),delete this._mediaSource)};hamonengine.audio.audioext.prototype.onAudioEnd=function(a){a=a&&a.currentTarget&&a.currentTarget._userStopped||!1;4!==this._playingState||a||this.loop||(this._playingState=5,this.audioListenerDelegate&&this.audioListenerDelegate.onAudioEnd&&this.audioListenerDelegate.onAudioEnd())};$jscomp.global.Object.defineProperties(hamonengine.audio.audioext.prototype,
{context:{configurable:!0,enumerable:!0,get:function(){return this._audioCtx}},buffer:{configurable:!0,enumerable:!0,get:function(){return this._buffer}},audio:{configurable:!0,enumerable:!0,get:function(){return this._audio}},src:{configurable:!0,enumerable:!0,get:function(){return this._src}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return 2===this._resourceState}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return 4===this._playingState}},isStopped:{configurable:!0,enumerable:!0,
get:function(){return 5===this._playingState}},isPaused:{configurable:!0,enumerable:!0,get:function(){return 6===this._playingState}},fallbackSourceURLs:{configurable:!0,enumerable:!0,get:function(){return this._fallbackSourceURLs}},duration:{configurable:!0,enumerable:!0,get:function(){return this.audio?this.audio.duration:this.buffer&&this.buffer.duration||0}},currentTime:{configurable:!0,enumerable:!0,get:function(){return this.audio?this.audio.currentTime:this.isPlaying?this.context.currentTime-
this._startTime:0}},loop:{configurable:!0,enumerable:!0,get:function(){return this._loop},set:function(a){this._loop=a;this.audio&&(this.audio.loop=a);this._mediaSource&&(this._mediaSource.loop=a)}},muted:{configurable:!0,enumerable:!0,get:function(){return 0===this._gainNode.gain.value},set:function(a){a?(this._preMutedVolume=this.volume,this.volume=0):void 0!==this._preMutedVolume&&(this.volume=this._preMutedVolume,delete this._preMutedVolume)}},volume:{configurable:!0,enumerable:!0,get:function(){return this._gainNode.gain.value},
set:function(a){this._gainNode.gain.value=1<a?1:a}},audioListenerDelegate:{configurable:!0,enumerable:!0,get:function(){return this._audioListenerDelegate},set:function(a){this._audioListenerDelegate=a}}})})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.playlist=function(a){var b=this;a=void 0===a?{}:a;a instanceof hamonengine.audio.playlist&&(a={tracks:a._tracks.map(function(c){return c.clone()}),index:a._index,loop:a._loop,autoplay:a._autoplay});this._name=a.name;this._tracks=[];this._index=a.index||0;this._loop=a.loop||0;this._autoplay=void 0!==a.autoplay?a.autoplay:!1;this._autoplayFilters=a.autoplayFilters||[];this._volume=1;this._listenerPool=new listenerPool;(a.tracks||[]).forEach(function(c){return b.addTrack(c)});
hamonengine.debug&&(console.debug("[hamonengine.audio.playlist.constructor] Name: "+this._name),console.debug("[hamonengine.audio.playlist.constructor] Track Index: "+this._index),console.debug("[hamonengine.audio.playlist.constructor] Loop: "+(this._loop?"true":"false")),console.debug("[hamonengine.audio.playlist.constructor] Autoplay: "+(this._autoplay?"true":"false")))};hamonengine.audio.playlist.prototype.clone=function(){return new hamonengine.audio.playlist(this)};hamonengine.audio.playlist.prototype.register=
function(a){this._listenerPool.register(a)};hamonengine.audio.playlist.prototype.load=function(){var a=this,b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){b=[];for(c=0;c<a._tracks.length;c++)a._tracks[c].isLoaded||b.push(a._tracks[c].load());return 0<b.length?d.return(Promise.all(b)):d.return(Promise.resolve())})};hamonengine.audio.playlist.prototype.play=function(a){a=void 0===a?"":a;if(!this.currentTrack.isPlaying){if(""!==a){var b=this._tracks.findIndex(function(c){return c.name===
a});-1<b&&(this.index=b)}this.currentTrack.volume=this.volume;this.currentTrack.play();this._listenerPool.invoke("onPlaylistPlay",{track:this.currentTrack})}};hamonengine.audio.playlist.prototype.pause=function(){this.currentTrack.pause();this._listenerPool.invoke("onPlaylistPause",{track:this.currentTrack})};hamonengine.audio.playlist.prototype.stop=function(a){a=void 0===a?{}:a;a=void 0===a.reason?"invoked":a.reason;this.currentTrack.stop();this.index=0;this._listenerPool.invoke("onPlaylistStop",
{track:this.currentTrack,reason:a})};hamonengine.audio.playlist.prototype.next=function(){this.currentTrack.isPlaying?(this.currentTrack.stop(),this.index++,this.currentTrack.play()):this.index++;this._listenerPool.invoke("onPlaylistNext",{track:this.currentTrack})};hamonengine.audio.playlist.prototype.prev=function(){this.currentTrack.isPlaying?(this.currentTrack.stop(),this.index--,this.currentTrack.play()):this.index--;this._listenerPool.invoke("onPlaylistPrevious",{track:this.currentTrack})};
hamonengine.audio.playlist.prototype.addTrack=function(a){a.register(this);this._tracks.push(a)};hamonengine.audio.playlist.prototype.release=function(){this._listenerPool.clear();this._tracks.forEach(function(a){return a&&a.release()});this._tracks=[]};hamonengine.audio.playlist.createAutoPlayFadeFilter=function(a){a=void 0===a?{}:a;var b=void 0===a.fadeOutStart?.01:a.fadeOutStart,c=void 0===a.rateOfFade?0:a.rateOfFade;return function(d){var e=d.remainingTime,f=d.currentTrack;d=d.playList;var g=
f.duration*b;e<g&&(e=0<c?f.volume-c:e/(f.volume*g),0<e?f.volume=e:(f.stop({suspend:!1}),d.next(),d.play()))}};hamonengine.audio.playlist.prototype.onTrackBegin=function(a){};hamonengine.audio.playlist.prototype.onTrackEnd=function(a){a=a.track;this.autoplay&&a===this.currentTrack&&(this.loop||this.index<this._tracks.length-1?(this.next(),this.play()):this.stop({reason:"playlistend"}))};hamonengine.audio.playlist.prototype.onTrackUpdate=function(a){var b=a.track,c=a.elapsedTime;a=a.remainingTime;if(0<
this._autoplayFilters.length)for(var d=this._tracks[this.index+1%this._tracks.length],e=0;e<this._autoplayFilters.length;e++)this._autoplayFilters[e]({elapsedTime:c,remainingTime:a,currentTrack:b,nextTrack:d,playList:this});this._listenerPool.invoke("onPlaylistUpdate",{track:b,elapsedTime:c,remainingTime:a,playlist:this})};$jscomp.global.Object.defineProperties(hamonengine.audio.playlist.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},
index:{configurable:!0,enumerable:!0,get:function(){return this._index},set:function(a){a%=this._tracks.length;this._index=0>a?this._tracks.length+a:a}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return this.currentTrack.isPlaying}},currentTrack:{configurable:!0,enumerable:!0,get:function(){return this._tracks[this.index]}},loop:{configurable:!0,enumerable:!0,get:function(){return this._loop},set:function(a){this._loop=a}},autoplay:{configurable:!0,enumerable:!0,get:function(){return this._autoplay},
set:function(a){this._autoplay=a}},volume:{configurable:!0,enumerable:!0,get:function(){return this._volume},set:function(a){this._volume=a}}})})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.track=function(a){a=void 0===a?{}:a;a instanceof hamonengine.audio.track&&(a={name:a._name,audioext:a._audioext.clone(),src:a._src,trackBegin:a._trackBegin,trackEnd:a._trackEnd});this._name=a.name;this._audioext=a.audioext||new hamonengine.audio.audioext({audio:a.audio,src:a.src,loop:void 0!==a.loop?a.loop:!1});this._trackBegin=a.trackBegin||0;this._trackEnd=a.trackEnd;this._listenerPool=new listenerPool;hamonengine.debug&&(console.debug("[hamonengine.audio.track.constructor] Name: "+this._name),
console.debug("[hamonengine.audio.track.constructor] Track Begin: "+this._trackBegin),console.debug("[hamonengine.audio.track.constructor] Track End: "+this._trackEnd))};hamonengine.audio.track.prototype.clone=function(){return new hamonengine.audio.track(this)};hamonengine.audio.track.prototype.register=function(a){this._listenerPool.register(a)};hamonengine.audio.track.prototype.load=function(a){a=void 0===a?"":a;var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){return c.return(b._audioext.load(a))})};
hamonengine.audio.track.prototype.play=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){a._audioext.audioListenerDelegate=a;return b.return(a._audioext.play(a._trackBegin,a._trackEnd))})};hamonengine.audio.track.prototype.pause=function(){return this._audioext.pause()};hamonengine.audio.track.prototype.stop=function(a){a=void 0===a?{}:a;var b=void 0===a.suspend?!0:a.suspend,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){return d.return(c._audioext.stop({suspend:b}))})};
hamonengine.audio.track.prototype.release=function(){this._listenerPool.clear();this._audioext.release();delete this._audioext};hamonengine.audio.track.prototype.onTrackBegin=function(){this._listenerPool.invoke("onTrackBegin",{track:this})};hamonengine.audio.track.prototype.onAudioEnd=function(){this.loop?this.play():this._listenerPool.invoke("onTrackEnd",{track:this})};$jscomp.global.Object.defineProperties(hamonengine.audio.track.prototype,{src:{configurable:!0,enumerable:!0,get:function(){return this._audioext.src}},
name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},context:{configurable:!0,enumerable:!0,get:function(){return this._audioext.context}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._audioext.isLoaded}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return this._audioext.isPlaying}},duration:{configurable:!0,enumerable:!0,get:function(){return(this._trackEnd||this._audioext.duration)-this._trackBegin}},fallbackSourceURLs:{configurable:!0,
enumerable:!0,get:function(){return this._audioext.fallbackSourceURLs}},autoplay:{configurable:!0,enumerable:!0,get:function(){return this._audioext.autoplay},set:function(a){this._audioext.autoplay=a}},loop:{configurable:!0,enumerable:!0,get:function(){return this._audioext.loop},set:function(a){this._audioext.loop=a}},muted:{configurable:!0,enumerable:!0,get:function(){return this._audioext.muted},set:function(a){this._audioext.muted=a}},volume:{configurable:!0,enumerable:!0,get:function(){return this._audioext.volume},
set:function(a){this._audioext.volume=a}}})})();hamonengine.graphics=hamonengine.graphics||{};var BLENDING_OPS={REPLACE:0,ADD:1,MULTIPLY:2,OR:3,AND:4,XOR:5,DIFFERENCE:6},TEXT_DRAW_TYPE={STROKE:0,FILL:1},DIRTY_FLAG={NORMAL:0,DIMS:1,EDGE:2,SHAPE:3,ALL:15};hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.imageext=function(a){a=void 0===a?{}:a;a instanceof hamonengine.graphics.imageext&&(a={image:a._image});this._image=a.image||new Image;this._state=0;this._backbufferCtx=this._backbufferResource=null;hamonengine.debug&&hamonengine.verbose&&console.debug("[hamonengine.graphics.imageext.constructor] Starting State: "+this._state)};hamonengine.graphics.imageext.prototype.clone=function(){return new hamonengine.graphics.imageext(this)};hamonengine.graphics.imageext.prototype.load=
function(a){a=void 0===a?"":a;var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){""!==a&&(b._image.src=a);b._state=1;return c.return(new Promise(function(d,e){if(b.complete)b._state=2,d();else{var f=function(){b._state=2;b.image.removeEventListener("load",f,!1);hamonengine.debug&&console.debug("[hamonengine.graphics.imageext.load] Image '"+a+"' has loaded successfully.");d()};b.image.addEventListener("load",f,!1);var g=function(k){b._state=3;k="The image '"+(k&&k.path&&0<k.path.length&&
k.path[0].src||"")+"' could not be loaded.";b.image.removeEventListener("error",function(h){return g(h)},!1);e(k)};b.image.addEventListener("error",function(k){return g(k)},!1)}}))})};hamonengine.graphics.imageext.prototype.getImageData=function(a){this._backbufferResource=this._backbufferResource||hamonengine.graphics.layer.createNewCanvas(this.rawImage.width,this.rawImage.height);this._backbufferCtx=this._backbufferCtx||this._backbufferResource.getContext("2d",{willReadFrequently:!0});this._backbufferCtx.drawImage(this.rawImage,
0,0);a=a||new hamonengine.geometry.rect;return this._backbufferCtx.getImageData(a.x,a.y,a.width||this.rawImage.width,a.height||this.rawImage.height)};hamonengine.graphics.imageext.prototype.blendColorRegion=function(a,b,c,d,e,f){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?null:e;f=void 0===f?BLENDING_OPS.REPLACE:f;if(this.complete){var g=this.getImageData(e),k=function(l,m){return 0<l?l:m};switch(f){case BLENDING_OPS.ADD:k=function(l,m){return 0<l?Math.min(l+m,
255):m};break;case BLENDING_OPS.MULTIPLY:k=function(l,m){return 0<l?Math.min(l*m,255):m};break;case BLENDING_OPS.AND:k=function(l,m){return 0<l?Math.min(l&m,255):m};break;case BLENDING_OPS.OR:k=function(l,m){return 0<l?Math.min(l|m,255):m};break;case BLENDING_OPS.XOR:k=function(l,m){return 0<l?Math.min(l^m,255):m};break;case BLENDING_OPS.DIFFERENCE:k=function(l,m){return 0<l?Math.min(l-m,255):m}}f=g.data;for(var h=0;h<f.length;h+=4)f[h]=k(a,f[h]),f[h+1]=k(b,f[h+1]),f[h+2]=k(c,f[h+2]),f[h+3]=k(d,f[h+
3]);this._backbufferCtx.putImageData(g,e.x,e.y)}};hamonengine.graphics.imageext.prototype.adjustColorChannel=function(a,b,c,d,e){a=void 0===a?1:a;b=void 0===b?1:b;c=void 0===c?1:c;d=void 0===d?1:d;e=void 0===e?null:e;if(this.complete){for(var f=this.getImageData(e),g=f.data,k=0;k<g.length;k+=4)g[k]=Math.bitRound(g[k]*a),g[k+1]=Math.bitRound(g[k+1]*b),g[k+2]=Math.bitRound(g[k+2]*c),g[k+3]=Math.bitRound(g[k+3]*d);this._backbufferCtx.putImageData(f,e.x,e.y,e.x,e.y,e.width,e.height)}};hamonengine.graphics.imageext.prototype.bitblit=
function(a,b,c,d){if(this.complete&&a.complete){a instanceof hamonengine.graphics.imageext&&(a=a.rawImage);d=Math.max(Math.min(void 0===d?1:d,1),0);var e=this.getImageData(c),f=hamonengine.graphics.layer.createNewCanvas(a.width,a.height).getContext("2d");f.drawImage(a,0,0);f=f.getImageData(b.x,b.y,b.width,b.height);a=e.data;f=f.data;for(var g=0;g<c.height&&!(g>=b.height);g++)for(var k=0;k<c.width&&!(k>=b.width);k++){var h=4*(g*c.width+k),l=4*(g*b.width+k),m=0<f[l+3]?1-d:1;a[h]=Math.bitRound(a[h]*
m+f[l]*d);a[h+1]=Math.bitRound(a[h+1]*m+f[l+1]*d);a[h+2]=Math.bitRound(a[h+2]*m+f[l+2]*d)}this._backbufferCtx.putImageData(e,c.x,c.y)}};hamonengine.graphics.imageext.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?this.width:e;f=void 0===f?this.height:f;a.drawImage(this,c,d,this.width,this.height,destinationX,destinationY,e,f)};hamonengine.graphics.imageext.prototype.release=function(){this._backbufferCtx&&delete this._backbufferCtx;this._backbufferResource&&(this._backbufferResource.release(),
delete this._backbufferResource);delete this._image};$jscomp.global.Object.defineProperties(hamonengine.graphics.imageext.prototype,{src:{configurable:!0,enumerable:!0,get:function(){return this._image.src}},complete:{configurable:!0,enumerable:!0,get:function(){return this._image.complete}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return 2===this._state}},image:{configurable:!0,enumerable:!0,get:function(){return this._backbufferResource?this._backbufferResource:this._image}},rawImage:{configurable:!0,
enumerable:!0,get:function(){return this._image}},width:{configurable:!0,enumerable:!0,get:function(){return this.image.width}},height:{configurable:!0,enumerable:!0,get:function(){return this.image.height}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.layer=function(a){a=void 0===a?{}:a;this._canvasId=a.canvasId||"";this._name=a.name||"";this._alpha=void 0!==a.alpha?a.alpha:!1;this._backgroundColor=a.backgroundColor||"black";this._allowEventBinding=void 0!==a.allowEventBinding?a.allowEventBinding:!1;this._wrapVertical=void 0!==a.wrapVertical?a.wrapVertical:!1;this._wrapHorizontal=void 0!==a.wrapHorizontal?a.wrapHorizontal:!1;this._clipToViewPort=void 0!==a.clipToViewPort?a.clipToViewPort:!0;this._enableImageSmoothing=
void 0!==a.enableImageSmoothing?a.enableImageSmoothing:!0;this._invertYAxis=void 0!==a.invertYAxis?a.invertYAxis:!1;this._invertXAxis=void 0!==a.invertXAxis?a.invertXAxis:!1;var b=a.canvas;if(!this._canvasId&&!b)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvasId '"+this._canvasId+"' or canvas. Unable to create the layer!"),"Cannot create the layer";b?(this._canvas=b,this._canvasId=b.id,this._name=a.name||b.getAttribute("name")):this._canvas=document.getElementById(this._canvasId);
if(!this._canvas)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvas: '"+this._canvasId+"' unable to create the layer!"),"Cannot create the layer";try{this._alpha?this._canvasContext=this._canvas.getContext("2d",{alpha:this._alpha}):(this._workAround=!0,this._canvasContext=this._canvas.getContext("2d"))}catch(c){}this.enableImageSmoothing(a.enableImageSmoothing);if(!this._canvasContext)throw console.error("[hamonengine.graphics.layer.constructor] Unable to get the 2d context: '"+
this._canvasId+"' unable to create the layer!"),"Cannot create the layer";this._viewPort=a.viewPort||new hamonengine.geometry.rect(0,0,this._canvas.width,this._canvas.height);this._wasReset=!1;this._allowSaveStateEnabled=!0;this._viewPortBorderColor="";hamonengine.debug&&(console.debug("[hamonengine.graphics.layer.constructor] Canvas Id: "+this._canvasId),console.debug("[hamonengine.graphics.layer.constructor] Name: "+this._name),console.debug("[hamonengine.graphics.layer.constructor] Alpha: "+this._alpha),
console.debug("[hamonengine.graphics.layer.constructor] AllowEventBinding: "+this._allowEventBinding),console.debug("[hamonengine.graphics.layer.constructor] WrapVertical: "+this._wrapVertical),console.debug("[hamonengine.graphics.layer.constructor] WrapHorizontal: "+this._wrapHorizontal),console.debug("[hamonengine.graphics.layer.constructor] ClipToViewPort: "+this._clipToViewPort))};hamonengine.graphics.layer.createNewCanvas=function(a,b,c,d){c=void 0===c?"":c;d=void 0===d?"":d;var e=document.createElement("canvas");
e.setAttribute("width",a);e.setAttribute("height",b);c&&e.setAttribute("id",c);d&&e.setAttribute("name",d);return e};hamonengine.graphics.layer.prototype.clone=function(a,b,c){c=void 0===c?null:c;var d=hamonengine.graphics.layer.createNewCanvas(this.width,this.height,a,b);c&&c.insertBefore(d,null);a=new hamonengine.graphics.layer({canvasId:a,name:b,canvas:d,alpha:this.alpha,allowEventBinding:this.allowEventBinding,wrapVertical:this.wrapVertical,wrapHorizontal:this.wrapHorizontal,clipToViewPort:this.clipToViewPort,
enableImageSmoothing:this._enableImageSmoothing,invertYAxis:this.invertYAxis,invertXAxis:this.invertXAxis,viewPort:this.viewPort});a._allowSaveStateEnabled=this._allowSaveStateEnabled;a._viewPortBorderColor=this._viewPortBorderColor;return a};hamonengine.graphics.layer.prototype.enableImageSmoothing=function(a){a=void 0===a?!0:a;hamonengine.debug&&console.debug("[hamonengine.graphics.layer.constructor] EnableImageSmoothing: "+a);this._enableImageSmoothing=a;try{this.context.webkitImageSmoothingEnabled=
a,this.context.mozImageSmoothingEnabled=a,this.context.imageSmoothingEnabled=a}catch(b){}};hamonengine.graphics.layer.prototype.clear=function(a,b,c,d){a=void 0===a?this.viewPort.x:a;b=void 0===b?this.viewPort.y:b;c=void 0===c?this.viewPort.width:c;d=void 0===d?this.viewPort.height:d;this._wasReset=!1;this.context.clearRect(a,b,c,d)};hamonengine.graphics.layer.prototype.reset=function(){this._wasReset||(this.context.resetTransform(),this._wasReset=!0)};hamonengine.graphics.layer.prototype.save=function(){this.allowSaveState&&
this.context.save()};hamonengine.graphics.layer.prototype.restore=function(){this.allowSaveState&&this.context.restore()};hamonengine.graphics.layer.prototype.fillLayerImage=function(a,b,c){b=void 0===b?this.viewPort.x:b;c=void 0===c?this.viewPort.y:c;this.context.drawImage(a,b,c,this.viewPort.width,this.viewPort.height)};hamonengine.graphics.layer.prototype.beginPainting=function(a){a=void 0===a?{}:a;var b=void 0===a.x?this.viewPort.x:a.x,c=void 0===a.y?this.viewPort.y:a.y,d=void 0===a.width?this.viewPort.width:
a.width,e=void 0===a.height?this.viewPort.height:a.height;this.context.fillStyle=void 0===a.backgroundColor?this.backgroundColor:a.backgroundColor;this.context.fillRect(b,c,d,e);this.borderColor&&(this.context.strokeStyle=this.borderColor,this.context.strokeRect(this.viewPort.x,this.viewPort.y,this.viewPort.width,this.viewPort.height));!this.clipToViewPort||0===this.viewPort.x&&0===this.viewPort.y&&this.viewPort.width===this.width&&this.viewPort.height===this.height||(this.context.beginPath(),this.context.rect(this.viewPort.x,
this.viewPort.y,this.viewPort.width,this.viewPort.height),this.context.clip())};hamonengine.graphics.layer.prototype.endPainting=function(){this.reset()};hamonengine.graphics.layer.prototype.drawLayer=function(a,b,c,d,e){d=void 0===d?this.width:d;e=void 0===e?this.height:e;if(!(a instanceof hamonengine.graphics.layer))throw"Parameter layer is not of type hamonengine.graphics.layer.";this.context.drawImage(a.canvas,void 0===b?0:b,void 0===c?0:c,d,e)};hamonengine.graphics.layer.prototype.drawText=function(a,
b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.color?"white":e.color;var f=void 0===e.textDrawType?TEXT_DRAW_TYPE.FILL:e.textDrawType,g=void 0===e.textOffset?"left":e.textOffset,k=void 0===e.shadow?!1:e.shadow,h=void 0===e.shadowXOffset?2:e.shadowXOffset,l=void 0===e.shadowYOffset?2:e.shadowYOffset,m=void 0===e.shadowColor?"black":e.shadowColor;this.context.font=void 0===e.font?"16px serif":e.font;this.context.textBaseline="top";switch(g){case "center":e=this.context.measureText(a);
b-=e.width/2;break;case "left":break;case "right":e=this.context.measureText(a);b-=e.width;break;default:b-=parseInt(g)}f===TEXT_DRAW_TYPE.STROKE?(k&&(this.context.strokeStyle=m,this.context.strokeText(a,b+h,c+l)),this.context.strokeStyle=d,this.context.strokeText(a,b,c)):(k&&(this.context.fillStyle=m,this.context.fillText(a,b+h,c+l)),this.context.fillStyle=d,this.context.fillText(a,b,c))};hamonengine.graphics.layer.prototype.drawImage=function(a,b,c,d,e,f,g,k,h){a.complete&&this.context.drawImage(a instanceof
hamonengine.graphics.imageext?a.image:a,b,c,d,e,f,g,k,h)};hamonengine.graphics.layer.prototype.drawVector=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;e=void 0===e.color?"white":e.color;if(!(a instanceof hamonengine.math.vector2||a instanceof hamonengine.math.vector3))throw"Parameter vector is not of type hamonengine.math.vector2 or of type hamonengine.math.vector3.";this.context.lineWidth=d;this.context.strokeStyle=e;this.context.beginPath();
this.context.moveTo(b,c);this.context.lineTo(b+a.x,c+a.y);this.context.stroke()};hamonengine.graphics.layer.prototype.drawLineSegment=function(a,b,c,d){var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.drawNormals?!0:e.drawNormals;e=void 0===e.color?"white":e.color;if(!(a instanceof hamonengine.geometry.lineSegment))throw"Parameter lineSegment is not of type hamonengine.geometry.lineSegment.";this.simpleDrawCoords(a._coords,4,a._offset,void 0===b?0:b,void 0===c?0:c,{lineWidth:d,
color:e,normals:f?a.normals:[]})};hamonengine.graphics.layer.prototype.drawPolyChain=function(a,b,c,d){var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.drawNormals?!0:e.drawNormals;e=void 0===e.color?"white":e.color;if(!(a instanceof hamonengine.geometry.polyChain))throw"Parameter polyChain is not of type hamonengine.geometry.polyChain.";this.simpleDrawCoords(a._coords,a._coords.length,0,void 0===b?0:b,void 0===c?0:c,{lineWidth:d,color:e,normals:f?a.normals:[]})};hamonengine.graphics.layer.prototype.simpleDrawCoords=
function(a,b,c,d,e,f){b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?0:e;var g=void 0===f?{}:f,k=void 0===g.color?"white":g.color;f=void 0===g.normals?[]:g.normals;if(!(0!=a.length%2||c+1>a.length)){this.context.lineWidth=void 0===g.lineWidth?1:g.lineWidth;this.context.strokeStyle=k;this.context.beginPath();b=c+b>a.length?a.length:c+b;g=[];for(k=c;k<b;k+=2){var h=Math.bitRound(d+a[k]),l=Math.bitRound(e+a[k+1]);this.invertYAxis&&(l=this.viewPort.height-l);this.invertXAxis&&(h=this.viewPort.width-
h);if(k===c){this.context.moveTo(h,l);var m=new hamonengine.math.vector2(h,l)}else this.context.lineTo(h,l),h=new hamonengine.math.vector2(h,l),g.push(h.subtract(m)),m=h}this.context.stroke();if(hamonengine.debug&&0<f.length)for(this.context.strokeStyle="white",m=0;c<b&&m<g.length&&m<f.length;c+=2,m++){k=Math.bitRound(d+a[c]+g[m].x/2);h=Math.bitRound(e+a[c+1]+g[m].y/2);this.invertYAxis&&(h=this.viewPort.height-h);this.invertXAxis&&(k=this.viewPort.width-k);this.context.beginPath();this.context.moveTo(k,
h);l=f[m];var n=Math.bitRound(g[m].length/2);this.invertYAxis&&(l.y=-l.y);this.invertXAxis&&(l.x=-l.x);this.context.lineTo(k+l.x*n,h+l.y*n);this.context.stroke()}}};hamonengine.graphics.layer.prototype.drawRect=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.color?"white":e.color,g=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;this.simpleDrawRect(a,b,c,{lineWidth:d,color:f,fill:g,fillColor:e});var k=
new hamonengine.math.vector2;if(this.wrapHorizontal){var h=b+a.x-this.viewPort.x;0>=h&&(this.simpleDrawRect(a,this.viewPort.width+h,c,{lineWidth:d,color:f,fill:g,fillColor:e}),k.x=this.viewPort.width+h);b+a.width>=this.viewPort.width&&(h=this.viewPort.width-(b+a.x),this.simpleDrawRect(a,this.viewPort.x-h,c,{lineWidth:d,color:f,fill:g,fillColor:e}),k.x=this.viewPort.x-h)}this.wrapVertical&&(h=c+a.y-this.viewPort.y,0>=h&&(this.simpleDrawRect(a,b,this.viewPort.height+h,{lineWidth:d,color:f,fill:g,fillColor:e}),
k.y=this.viewPort.height+h),c+a.height>=this.viewPort.height&&(c=this.viewPort.height-(c+a.y),this.simpleDrawRect(a,b,this.viewPort.y-c,{lineWidth:d,color:f,fill:g,fillColor:e}),k.y=this.viewPort.y-c));this.wrapVertical&&this.wrapHorizontal&&k.x&&k.y&&this.simpleDrawRect(a,k.x,k.y,{lineWidth:d,color:f,fill:g,fillColor:e})};hamonengine.graphics.layer.prototype.simpleDrawRect=function(a,b,c,d){var e=void 0===d?{}:d,f=void 0===e.lineWidth?1:e.lineWidth,g=void 0===e.color?"white":e.color;d=void 0===e.fill?
!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;if(!(a instanceof hamonengine.geometry.rect))throw"Parameter rect is not of type hamonengine.geometry.rect.";this.context.lineWidth=f;this.context.strokeStyle=g;this.context.fillStyle=e;b=a.x+(void 0===b?0:b);c=a.y+(void 0===c?0:c);this.invertYAxis&&(c=this.viewPort.height-c);this.invertXAxis&&(b=this.viewPort.width-b);this.context.beginPath();this.context.moveTo(b,c);this.context.strokeRect(b,c,a.width,a.height);this.context.closePath();d&&this.context.fillRect(b,
c,a.width,a.height);this.context.stroke()};hamonengine.graphics.layer.prototype.drawPolygon=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.color?"white":e.color,g=void 0===e.drawNormals?!1:e.drawNormals,k=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;this.simpleDrawPolygon(a,b,c,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e});var h=new hamonengine.math.vector2;if(this.wrapHorizontal){var l=
b+a.min.x-this.viewPort.x;0>=l&&(this.simpleDrawPolygon(a,this.viewPort.width+l,c,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e}),h.x=this.viewPort.width+l);b+a.width>=this.viewPort.width&&(l=this.viewPort.width-(b+a.min.x),this.simpleDrawPolygon(a,this.viewPort.x-l,c,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e}),h.x=this.viewPort.x-l)}this.wrapVertical&&(l=c+a.min.y-this.viewPort.y,0>=l&&(this.simpleDrawPolygon(a,b,this.viewPort.height+l,{lineWidth:d,color:f,drawNormals:g,fill:k,
fillColor:e}),h.y=this.viewPort.height+l),c+a.height>=this.viewPort.height&&(c=this.viewPort.height-(c+a.min.y),this.simpleDrawPolygon(a,b,this.viewPort.y-c,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e}),h.y=this.viewPort.y-c));this.wrapVertical&&this.wrapHorizontal&&h.x&&h.y&&this.simpleDrawPolygon(a,h.x,h.y,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e})};hamonengine.graphics.layer.prototype.simpleDrawPolygon=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?
{}:d,f=void 0===e.lineWidth?1:e.lineWidth,g=void 0===e.color?"white":e.color;d=void 0===e.drawNormals?!1:e.drawNormals;var k=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;if(!(a instanceof hamonengine.geometry.polygon))throw"Parameter polygon is not of type hamonengine.geometry.polygon.";this.context.lineWidth=f;this.context.strokeStyle=g;this.context.fillStyle=e;this.context.beginPath();for(f=0;f<a.vertices.length;f++)g=Math.bitRound(b+a.vertices[f].x),e=Math.bitRound(c+a.vertices[f].y),
this.invertYAxis&&(e=this.viewPort.height-e),this.invertXAxis&&(g=this.viewPort.width-g),0===f?this.context.moveTo(g,e):this.context.lineTo(g,e);this.context.closePath();k&&this.context.fill();this.context.stroke();if(hamonengine.debug&&d)for(this.context.strokeStyle="white",d=0;d<a.vertices.length;d++)g=a.vertices[d],f=a.edges[d],k=Math.bitRound(b+g.x+f.x/2),g=Math.bitRound(c+g.y+f.y/2),this.invertYAxis&&(g=this.viewPort.height-g),this.invertXAxis&&(k=this.viewPort.width-k),this.context.beginPath(),
this.context.moveTo(k,g),e=a.normals[d],f=Math.bitRound(f.length/2),this.invertYAxis&&(e.y=-e.y),this.invertXAxis&&(e.x=-e.x),this.context.lineTo(k+e.x*f,g+e.y*f),this.context.stroke()};hamonengine.graphics.layer.prototype.drawShape=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.color?"white":e.color,g=void 0===e.drawNormals?!1:e.drawNormals,k=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;a instanceof
hamonengine.geometry.rect&&this.drawRect(a,b,c,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e});a instanceof hamonengine.geometry.polygon&&this.drawPolygon(a,b,c,{lineWidth:d,color:f,drawNormals:g,fill:k,fillColor:e});a instanceof hamonengine.geometry.lineSegment&&this.drawLineSegment(a,b,c,{lineWidth:d,drawNormals:g,color:f});a instanceof hamonengine.geometry.polyChain&&this.drawPolyChain(a,b,c,{lineWidth:d,drawNormals:g,color:f})};hamonengine.graphics.layer.prototype.release=function(){delete this._canvasId;
delete this._canvas;delete this._canvasContext};$jscomp.global.Object.defineProperties(hamonengine.graphics.layer.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},allowEventBinding:{configurable:!0,enumerable:!0,get:function(){return this._allowEventBinding}},context:{configurable:!0,enumerable:!0,get:function(){return this._canvasContext}},canvas:{configurable:!0,enumerable:!0,get:function(){return this._canvas}},clipToViewPort:{configurable:!0,enumerable:!0,get:function(){return this._clipToViewPort}},
width:{configurable:!0,enumerable:!0,get:function(){return this._canvas.width}},height:{configurable:!0,enumerable:!0,get:function(){return this._canvas.height}},offsetX:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetLeft}},offsetY:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetTop}},position:{configurable:!0,enumerable:!0,get:function(){var a=this.canvas.getBoundingClientRect()||{left:0,top:0};return new hamonengine.math.vector2(a.left,a.top)}},viewPort:{configurable:!0,
enumerable:!0,get:function(){return this._viewPort}},wrapHorizontal:{configurable:!0,enumerable:!0,get:function(){return this._wrapHorizontal},set:function(a){this._wrapHorizontal=a}},wrapVertical:{configurable:!0,enumerable:!0,get:function(){return this._wrapVertical},set:function(a){this._wrapVertical=a}},allowSaveState:{configurable:!0,enumerable:!0,get:function(){return this._allowSaveStateEnabled},set:function(a){this._allowSaveStateEnabled=a}},borderColor:{configurable:!0,enumerable:!0,get:function(){return this._viewPortBorderColor},
set:function(a){this._viewPortBorderColor=a}},invertYAxis:{configurable:!0,enumerable:!0,get:function(){return this._invertYAxis},set:function(a){this._invertYAxis=a}},invertXAxis:{configurable:!0,enumerable:!0,get:function(){return this._invertXAxis},set:function(a){this._invertXAxis=a}},alpha:{configurable:!0,enumerable:!0,get:function(){return this.context.globalAlpha},set:function(a){this.context.globalAlpha=a}},tooltip:{configurable:!0,enumerable:!0,get:function(){return this.canvas.title},set:function(a){this.canvas.title=
a}},cursor:{configurable:!0,enumerable:!0,get:function(){return this.canvas.style.cursor},set:function(a){this.canvas.style.cursor=a}},backgroundColor:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a}},depthIndex:{configurable:!0,enumerable:!0,get:function(){return this.canvas.style.zIndex},set:function(a){this.canvas.style.zIndex=a}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.sprite=function(a){a=void 0===a?{}:a;a instanceof hamonengine.graphics.sprite&&(a={image:a._image&&a._image.clone(),dimensions:a._dimensions,theta:a.theta});this._name=a.name;this._image=a.image||new hamonengine.graphics.imageext;this._url=a.url||"";this._dimensions=a.dimensions?a.dimensions:this._image instanceof HTMLImageElement?new hamonengine.geometry.rect(0,0,this._image.width,this._image.height):new hamonengine.geometry.rect;this._theta=a.theta||0;this._scaleVector=
new hamonengine.math.vector2(1,1);this._spriteOrientation=0;this._showFullImage=this._showDiagnosisLines=!1;this._maxWrapping=0;hamonengine.debug&&hamonengine.verbose&&(console.debug("[hamonengine.graphics.sprite.constructor] Starting Dimensions: {"+this._dimensions.toString()+"}"),console.debug("[hamonengine.graphics.sprite.constructor] Name: '"+this._name+"'"),console.debug("[hamonengine.graphics.sprite.constructor] Theta: "+this._theta),console.debug("[hamonengine.graphics.sprite.constructor] ScaleVector: {"+
this._scaleVector.toString()+"}"))};hamonengine.graphics.sprite.prototype.copyProperties=function(a){this._theta=a.theta;this._scaleVector=a._scaleVector;this._spriteOrientation=a._spriteOrientation;this._showDiagnosisLines=a._showDiagnosisLines;this._showFullImage=a._showFullImage};hamonengine.graphics.sprite.prototype.clone=function(){return new hamonengine.graphics.sprite(this)};hamonengine.graphics.sprite.prototype.load=function(a){a=void 0===a?"":a;var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){a=
a||b._url;return c.return(new Promise(function(d,e){b._image instanceof hamonengine.graphics.imageext?b._image.load(a).then(function(){b._dimensions=new hamonengine.geometry.rect(0,0,b._image.width,b._image.height);d(b)}).catch(function(f){e(f)}):d(b)}))})};hamonengine.graphics.sprite.prototype.rotate=function(a){this._theta=a||0;return this};hamonengine.graphics.sprite.prototype.scale=function(a,b){this._scaleVector.x=a;this._scaleVector.y=b;return this};hamonengine.graphics.sprite.prototype.mirror=
function(a){this._spriteOrientation=bitflag.toggle(this._spriteOrientation,2,a);return this};hamonengine.graphics.sprite.prototype.flip=function(a){this._spriteOrientation=bitflag.toggle(this._spriteOrientation,1,a);return this};hamonengine.graphics.sprite.prototype.blendColor=function(a,b,c,d,e){e=void 0===e?BLENDING_OPS.REPLACE:e;this._image.blendColorRegion(void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d,this._dimensions,e);return this};hamonengine.graphics.sprite.prototype.adjustColorChannel=
function(a,b,c,d){this._image.adjustColorChannel(void 0===a?1:a,void 0===b?1:b,void 0===c?1:c,void 0===d?1:d,this._dimensions);return this};hamonengine.graphics.sprite.prototype.bitblit=function(a,b){this._image.bitblit(a._image,a._dimensions,this._dimensions,void 0===b?1:b);return this};hamonengine.graphics.sprite.prototype.drawRaw=function(a,b,c,d,e,f){e=void 0===e?this._dimensions.width:e;f=void 0===f?this._dimensions.height:f;this._image.complete&&(this.showFullImage?a.context.drawImage(this._image.image,
Math.bitRound(c),Math.bitRound(d),Math.bitRound(e),Math.bitRound(f)):a.drawImage(this._image,this._dimensions.x,this._dimensions.y,this._dimensions.width,this._dimensions.height,Math.bitRound(c),Math.bitRound(d),Math.bitRound(e),Math.bitRound(f)))};hamonengine.graphics.sprite.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?this._dimensions.width:e;f=void 0===f?this._dimensions.height:f;c=Math.bitRound(c);d=Math.bitRound(d);var g=Math.bitRound(e/2)+c,k=Math.bitRound(f/2)+d,h=bitflag.isSet(this._spriteOrientation,
1)?-1:1,l=bitflag.isSet(this._spriteOrientation,2)?-1:1;a.save();if(1!==this._scaleVector.x||1!==this._scaleVector.y)a.context.translate(c,d),a.context.scale(this._scaleVector.x,this._scaleVector.y),a.context.translate(-c,-d);0<this._spriteOrientation&&(a.context.translate(g,k),a.context.scale(l,h),a.context.translate(-g,-k));0!==this.theta&&(a.context.translate(g,k),a.context.rotate(this.theta),a.context.translate(-g,-k));(a.wrapHorizontal||a.wrapVertical)&&this.drawSpriteWrapping(a,b,c,d,e,f,l,
h);this.drawRaw(a,b,c,d,e,f);if(hamonengine.debug&&this.showDiagnosisLines){g=Math.bitRound(e/2)+c;k=Math.bitRound(f/2)+d;if(a.wrapHorizontal||a.wrapVertical)a.context.strokeStyle="red",a.context.lineWidth=2,a.context.beginPath(),a.context.moveTo(g,k),a.context.lineTo(g+a.viewPort.width,k),a.context.stroke(),a.context.beginPath(),a.context.moveTo(g,k),a.context.lineTo(g-a.viewPort.width,k),a.context.stroke(),a.context.beginPath(),a.context.moveTo(g,k),a.context.lineTo(g,k+a.viewPort.height),a.context.stroke(),
a.context.beginPath(),a.context.moveTo(g,k),a.context.lineTo(g,k-a.viewPort.height),a.context.stroke(),this.drawRaw(a,b,c+a.viewPort.width,d,e,f),this.drawRaw(a,b,c-a.viewPort.width,d,e,f),this.drawRaw(a,b,c,d+a.viewPort.height,e,f),this.drawRaw(a,b,c,d-a.viewPort.height,e,f),a.context.strokeStyle="white",a.context.strokeRect(g-a.viewPort.width/2,k-a.viewPort.height/2,a.viewPort.width,a.viewPort.height);a.context.strokeStyle="red";a.context.strokeRect(c,d,e,f);a.context.strokeStyle="cyan";a.context.strokeRect(a.viewPort.x,
a.viewPort.y,a.viewPort.width,a.viewPort.height)}a.restore()};hamonengine.graphics.sprite.prototype.drawSpriteWrapping=function(a,b,c,d,e,f,g,k){var h=Math.cos(-this.theta),l=Math.sin(-this.theta),m=e*this._scaleVector.x,n=f*this._scaleVector.y,t=new hamonengine.math.vector2;if(a.wrapHorizontal){var r=a.viewPort.width/this._scaleVector.x*g;var p=Math.bitRound(h*r);r=Math.bitRound(l*r);if(c-m<=a.viewPort.x){if(t.x=1,m=Math.abs(parseInt((c-m)/a.viewPort.width,10))+1,0===this._maxWrapping||m<this._maxWrapping)this.drawRaw(a,
b,c+p*m,d+r*m,e,f),0<--m&&this.drawRaw(a,b,c+p*m,d+r*m,e,f)}else c+m>=a.viewPort.width&&(t.x=-1,m=parseInt((c+m)/a.viewPort.width,10),0===this._maxWrapping||m<this._maxWrapping)&&(this.drawRaw(a,b,c-p*m,d-r*m,e,f),0<--m&&this.drawRaw(a,b,c-p*m,d-r*m,e,f))}if(a.wrapVertical){var q=a.viewPort.height/this._scaleVector.y*k;var u=Math.bitRound(l*q);q=Math.bitRound(h*q);if(d-n<=a.viewPort.y){if(t.y=1,h=Math.abs(parseInt((d-n)/a.viewPort.height,10))+1,0===this._maxWrapping||h<this._maxWrapping)this.drawRaw(a,
b,c-u*h,d+q*h,e,f),0<--h&&this.drawRaw(a,b,c-u*h,d+q*h,e,f)}else d+n>=a.viewPort.height&&(t.y=-1,h=parseInt((d+n)/a.viewPort.height,10),0===this._maxWrapping||h<this._maxWrapping)&&(this.drawRaw(a,b,c+u*h,d-q*h,e,f),0<--h&&this.drawRaw(a,b,c+u*h,d-q*h,e,f))}a.wrapVertical&&a.wrapHorizontal&&(c=c-t.y*u+t.x*p,d=d+t.y*q+t.x*r,c&&d&&this.drawRaw(a,b,c,d,e,f))};hamonengine.graphics.sprite.prototype.release=function(){this.image&&(this.image instanceof hamonengine.graphics.imageext&&this.image.release(),
delete this._image)};$jscomp.global.Object.defineProperties(hamonengine.graphics.sprite.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},height:{configurable:!0,enumerable:!0,get:function(){return this._dimensions.height}},width:{configurable:!0,enumerable:!0,get:function(){return this._dimensions.width}},theta:{configurable:!0,enumerable:!0,get:function(){return this._theta}},showDiagnosisLines:{configurable:!0,enumerable:!0,get:function(){return this._showDiagnosisLines},
set:function(a){this._showDiagnosisLines=a}},showFullImage:{configurable:!0,enumerable:!0,get:function(){return this._showFullImage},set:function(a){this._showFullImage=a}},maxWrapping:{configurable:!0,enumerable:!0,set:function(a){this._maxWrapping=a}},image:{configurable:!0,enumerable:!0,get:function(){return this._image}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.animsprite=function(a){a=void 0===a?{}:a;hamonengine.graphics.sprite.call(this,a);a instanceof hamonengine.graphics.animsprite&&(a={frames:a._frames.map(function(b){return b.clone()}),animationRate:a._animationRate,animationCycles:a._animationCycles});this._frames=a.frames||[];this._animationRate=a.animationRate||0;this._animationCycles=a.animationCycles||-1;this._numberOfAnimationCycles=this._timeSinceLastFrame=this._index=0;this._enableAnimation=!0;hamonengine.debug&&
(console.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Rate: "+this._animationRate),console.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Cycle: "+this._animationCycles),console.debug("[hamonengine.graphics.animsprite.constructor] Starting Index: "+this._index),console.debug("[hamonengine.graphics.animsprite.constructor] Starting Enable Animation: "+this._enableAnimation))};$jscomp.inherits(hamonengine.graphics.animsprite,hamonengine.graphics.sprite);
hamonengine.graphics.animsprite.prototype.clone=function(){return new hamonengine.graphics.animsprite(this)};hamonengine.graphics.animsprite.prototype.start=function(){this._enableAnimation=!0;this._numberOfAnimationCycles=0};hamonengine.graphics.animsprite.prototype.stop=function(){this._enableAnimation=!1};hamonengine.graphics.animsprite.prototype.pause=function(){this._enableAnimation=!this._enableAnimation};hamonengine.graphics.animsprite.prototype.next=function(){this.index++};hamonengine.graphics.animsprite.prototype.prev=
function(){var a=this.index-1;this.index=0>a?this._frames.length+a:a};hamonengine.graphics.animsprite.prototype.addFrame=function(a){hamonengine.debug&&console.debug("[hamonengine.graphics.animsprite.animsprite.addFrame]");this._frames.push(a)};hamonengine.graphics.animsprite.prototype.blendColor=function(a,b,c,d,e){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?BLENDING_OPS.REPLACE:e;for(var f=0;f<this._frames.length;f++)this._frames[f].blendColor(a,b,c,d,e)};hamonengine.graphics.animsprite.prototype.adjustColorChannel=
function(a,b,c,d){a=void 0===a?1:a;b=void 0===b?1:b;c=void 0===c?1:c;d=void 0===d?1:d;for(var e=0;e<this._frames.length;e++)this._frames[e].adjustColorChannel(a,b,c,d)};hamonengine.graphics.animsprite.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?null:e;f=void 0===f?null:f;var g=this._timeSinceLastFrame+b;if(this._enableAnimation){var k=parseInt(g/this.animationRate,10);k=this.index+k;-1<this.animationCycles&&(this._numberOfAnimationCycles+=parseInt(k/this._frames.length,10),this._enableAnimation=
this._numberOfAnimationCycles<=this.animationCycles);this.index=k}0<this._frames.length&&(k=this._frames[this.index],k.copyProperties(this),k.draw(a,b,c,d,e||k.width,f||k.height));this._timeSinceLastFrame=g%this.animationRate};$jscomp.global.Object.defineProperties(hamonengine.graphics.animsprite.prototype,{index:{configurable:!0,enumerable:!0,get:function(){return this._index},set:function(a){this._index=a%this._frames.length||0}},animationRate:{configurable:!0,enumerable:!0,get:function(){return this._animationRate},
set:function(a){this._animationRate=0<a?a:1}},animationCycles:{configurable:!0,enumerable:!0,get:function(){return this._animationCycles},set:function(a){this._animationCycles=a;this._enableAnimation=!0}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.spritesheet=function(a){a=void 0===a?{}:a;this._imageResource=new hamonengine.graphics.imageext;this._sprites={};this._spriteIndex=[];this._url=a.url||"";this._name=a.name||"";hamonengine.debug&&(console.debug("[hamonengine.audio.album.constructor] Name: '"+this._name+"'"),console.debug("[hamonengine.graphics.spritesheet.constructor] Url: '"+this._url+"''"))};hamonengine.graphics.spritesheet.prototype.load=function(a){a=void 0===a?"":a;var b=this,c,d,e,f,g,k,h,l,m,
n,t;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return a=a||b._url,"string"!==typeof a?r.jumpTo(2):r.yield(connect.get(a),3);2!=r.nextAddress&&(c=r.yieldResult,a=JSON.parse(c.data));b._name=b._name||a.name;d=b._imageResource.load(a.spritesheetUrl);if(a.sprites)for(e=0;e<a.sprites.length;e++)f=a.sprites[e],g=f.name.toLowerCase(),b._spriteIndex.push(g),b._sprites[g]=new hamonengine.graphics.sprite({image:b._imageResource,name:f.name,dimensions:new hamonengine.geometry.rect(f.x,
f.y,f.width,f.height)});if(a.animSprites)for(k=0;k<a.animSprites.length;k++){h=a.animSprites[k];l=new hamonengine.graphics.animsprite({animationRate:h.animationRate});for(m=0;m<h.frames.length;m++)n=h.frames[m],l.addFrame(new hamonengine.graphics.sprite({image:b._imageResource,name:n.name,dimensions:new hamonengine.geometry.rect(n.x,n.y,n.width,n.height)}));t=h.name.toLowerCase();b._spriteIndex.push(t);b._sprites[t]=l}return r.return(d)})};hamonengine.graphics.spritesheet.prototype.getSprite=function(a){return this._sprites[a.toLowerCase()].clone()};
hamonengine.graphics.spritesheet.prototype.getSpriteByOrdinal=function(a){return this._sprites[this._spriteIndex[a]].clone()};hamonengine.graphics.spritesheet.prototype.release=function(){this._imageResource&&this._imageResource.release();Object.values(this._sprites).forEach(function(a){return a&&a.release()});this._sprites=[];delete this._imageResource};$jscomp.global.Object.defineProperties(hamonengine.graphics.spritesheet.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},
length:{configurable:!0,enumerable:!0,get:function(){return this._spriteIndex.length}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._imageResource.isLoaded()}}})})();hamonengine.entities=hamonengine.entities||{};var OBJECT_STATE_FLAG={NONE:0,SOLID:1,MOVEABLE:2,VISIBLE:4},OBJECT_FACE_DIRECTION={NONE:0,XAXIS:1,YAXIS:2};hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.object2d=function(a){a=void 0===a?{}:a;a instanceof hamonengine.entities.object2d&&(a={name:a._name,boundingShape:a._boundingShape,width:a._width,height:a._height,zinddex:a._zindex,movementRate:a._movementRate,position:a._position,direction:a._direction,theta:a._theta,scale:a._scale,state:a._state,adjustBoundingShape:a._adjustBoundingShape});this._name=a.name||"";this._boundingShape=a.boundingShape;this._width=a.width||0;this._height=a.height||0;this._zindex=a.zindex||
0;this._adjustBoundingShape=!a.boundingShape&&(void 0!==a.adjustBoundingShape?a.adjustBoundingShape:!0);this._movementRate=a.movementRate||0;this._position=a.position||new hamonengine.math.vector2;this._direction=a.direction||new hamonengine.math.vector2;this._transformDirection=a.transformDirection||new hamonengine.math.vector2;this._theta=a.theta||0;this._scale=a.scale||1;void 0!==a.state?this._state=a.state:(this._state=0,this._state|=a.isSolid?OBJECT_STATE_FLAG.SOLID:OBJECT_STATE_FLAG.NONE,this._state|=
a.isMovable?OBJECT_STATE_FLAG.MOVEABLE:OBJECT_STATE_FLAG.NONE,this._state|=a.isVisible?OBJECT_STATE_FLAG.VISIBLE:OBJECT_STATE_FLAG.NONE);hamonengine.debug&&(console.debug("[hamonengine.entities.object2d.constructor] Name: "+this.name),console.debug("[hamonengine.entities.object2d.constructor] Starting Dimensions {Width: "+this.width+", Height: "+this.height+"}"),console.debug("[hamonengine.entities.object2d.constructor] Starting Direction: {x: "+this.direction.x+", y: "+this.direction.y+"}"),console.debug("[hamonengine.entities.object2d.constructor] Starting Position: {x: "+
this.position.x+", y: "+this.position.y+"}"),console.debug("[hamonengine.entities.object2d.constructor] Starting Theta: "+this.theta),console.debug("[hamonengine.entities.object2d.constructor] Movement Rate: "+this._movementRate),console.debug("[hamonengine.entities.object2d.constructor] isSolid: "+this.isSolid),console.debug("[hamonengine.entities.object2d.constructor] isMovable: "+this.isMovable),console.debug("[hamonengine.entities.object2d.constructor] isVisible: "+this.isVisible),console.debug("[hamonengine.entities.object2d.constructor] adjustBoundingShape: "+
this._adjustBoundingShape))};hamonengine.entities.object2d.prototype.move=function(a,b){this.isMovable&&(b=(void 0===b?null:b)||this.calcMove(a),this.position.x+=b.x,this.position.y+=b.y);return this};hamonengine.entities.object2d.prototype.calcMove=function(a){return new hamonengine.math.vector2(this._movementRate*this.direction.x*a,this._movementRate*this.direction.y*a)};hamonengine.entities.object2d.prototype.isCollision=function(a,b){b=void 0===b?new hamonengine.math.vector2:b;var c=this.boundingShape.translate(this.position);
c=c.rotateAtCenter?c.rotateAtCenter(this.theta):c;return(c.scaleAtCenter?c.scaleAtCenter(new hamonengine.math.vector2(this.scale,this.scale)):c).isCollision(a,b)};hamonengine.entities.object2d.prototype.isContained=function(a){return this.boundingShape.isContained(a.position,a.boundingShape)};hamonengine.entities.object2d.prototype.holdLeft=function(){this.direction.x=-1;return this};hamonengine.entities.object2d.prototype.holdRight=function(){this.direction.x=1;return this};hamonengine.entities.object2d.prototype.holdUp=
function(){this.direction.y=-1;return this};hamonengine.entities.object2d.prototype.holdDown=function(){this.direction.y=1;return this};hamonengine.entities.object2d.prototype.releaseHorizontal=function(){this.direction.x=0;return this};hamonengine.entities.object2d.prototype.releaseVertical=function(){this.direction.y=0;return this};hamonengine.entities.object2d.prototype.holdRotate=function(a,b){this._transformDirection.x=a?void 0===b?1:b:0;return this};hamonengine.entities.object2d.prototype.resetRotate=
function(){this.theta=this._transformDirection.x=0;return this};hamonengine.entities.object2d.prototype.holdScale=function(a,b){this._transformDirection.y=a?void 0===b?1:b:0;return this};hamonengine.entities.object2d.prototype.resetScale=function(){this._transformDirection.y=0;this.scale=1;return this};hamonengine.entities.object2d.prototype.reset=function(){return this.resetRotate().resetScale().releaseHorizontal().releaseVertical()};hamonengine.entities.object2d.prototype.toString=function(){return"{name: '"+
this.name+"', position: '"+this.position+"'}"};hamonengine.entities.object2d.prototype.onEnvironmentCollision=function(a,b){this._position=a;return!0};hamonengine.entities.object2d.prototype.onObjectCollision=function(a,b,c){};$jscomp.global.Object.defineProperties(hamonengine.entities.object2d.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){this._position=a}},direction:{configurable:!0,
enumerable:!0,get:function(){return this._direction}},theta:{configurable:!0,enumerable:!0,get:function(){return this._theta||0},set:function(a){this._theta=a}},scale:{configurable:!0,enumerable:!0,get:function(){return this._scale||1},set:function(a){this._scale=a}},width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._adjustBoundingShape&&(this._boundingShape=null);this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this._adjustBoundingShape&&
(this._boundingShape=null);this._height=a}},zIndex:{configurable:!0,enumerable:!0,get:function(){return this._zindex},set:function(a){this._zindex=a}},boundingShape:{configurable:!0,enumerable:!0,get:function(){return this._boundingShape=this._boundingShape||new hamonengine.geometry.rect(0,0,this.width,this.height)}},isMovable:{configurable:!0,enumerable:!0,get:function(){return(this._state&OBJECT_STATE_FLAG.MOVEABLE)===OBJECT_STATE_FLAG.MOVEABLE}},isSolid:{configurable:!0,enumerable:!0,get:function(){return(this._state&
OBJECT_STATE_FLAG.SOLID)===OBJECT_STATE_FLAG.SOLID}},isVisible:{configurable:!0,enumerable:!0,get:function(){return(this._state&OBJECT_STATE_FLAG.VISIBLE)===OBJECT_STATE_FLAG.VISIBLE},set:function(a){this._state=a?this._state|OBJECT_STATE_FLAG.VISIBLE:this._state^OBJECT_STATE_FLAG.VISIBLE}},isHoldRotate:{configurable:!0,enumerable:!0,get:function(){return this._transformDirection.x}},isHoldScale:{configurable:!0,enumerable:!0,get:function(){return this._transformDirection.y}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.spriteObject=function(a){a=void 0===a?{}:a;hamonengine.entities.object2d.call(this,a);a instanceof hamonengine.entities.spriteObject&&(a={sprite:a._sprite,directionBasis:a._directionBasis});this._sprite=a.sprite||new hamonengine.graphics.sprite;this._faceAxisOnMove=void 0!==a.faceAxisOnMove?a.faceAxisOnMove:OBJECT_FACE_DIRECTION.XAXIS|OBJECT_FACE_DIRECTION.YAXIS;this._directionBasis=a.directionBasis||new hamonengine.math.vector2(-1,-1)};$jscomp.inherits(hamonengine.entities.spriteObject,
hamonengine.entities.object2d);hamonengine.entities.spriteObject.prototype.move=function(a,b){hamonengine.entities.object2d.prototype.move.call(this,a,void 0===b?null:b);(this.faceAxisOnMove&OBJECT_FACE_DIRECTION.XAXIS)===OBJECT_FACE_DIRECTION.XAXIS&&0!==this.direction.x&&this.sprite.mirror(this.direction.x===this._directionBasis.x).rotate();(this.faceAxisOnMove&OBJECT_FACE_DIRECTION.YAXIS)===OBJECT_FACE_DIRECTION.YAXIS&&0!==this.direction.y&&this.sprite.rotate(this.direction.y===this._directionBasis.y?
Math.PI_2:-Math.PI_2);return this};hamonengine.entities.spriteObject.prototype.reset=function(){return this.sprite.rotate().mirror(!1)};hamonengine.entities.spriteObject.prototype.isCollision=function(a){if(this.isSolid){var b=new hamonengine.math.vector2;a instanceof hamonengine.entities.shapeObject&&a.isSolid&&(b=a.position.subtract(this.position),a=a.shape.translate(a.position));return hamonengine.entities.object2d.prototype.isCollision.call(this,a,b)}return new hamonengine.math.vector2};hamonengine.entities.spriteObject.prototype.render=
function(a,b){this.sprite&&this.sprite.draw(a,b,this.position.x,this.position.y,this.width,this.height)};hamonengine.entities.spriteObject.prototype.release=function(){this.sprite&&(this.sprite.release(),delete this._sprite)};$jscomp.global.Object.defineProperties(hamonengine.entities.spriteObject.prototype,{sprite:{configurable:!0,enumerable:!0,get:function(){return this._sprite},set:function(a){this._sprite=a}},faceAxisOnMove:{configurable:!0,enumerable:!0,get:function(){return this._faceAxisOnMove},
set:function(a){this._faceAxisOnMove=a}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.shapeObject=function(a){a=void 0===a?{}:a;hamonengine.entities.object2d.call(this,a);a instanceof hamonengine.entities.shapeObject&&(a={shape:a._shape});this._shape=a.shape||new hamonengine.geometry.rect;this._faceAxisOnMove=void 0!==a.faceAxisOnMove?a.faceAxisOnMove:OBJECT_FACE_DIRECTION.XAXIS|OBJECT_FACE_DIRECTION.YAXIS;this._boundingShape=(this._hasBoundingShape=a.boundingShape)||this._shape;this._directionBasis=a.directionBasis||new hamonengine.math.vector2(-1,
-1);this._mirroredState=!1;hamonengine.debug&&!this._hasBoundingShape&&console.debug("[hamonengine.entities.shapeObject.constructor] BoundingShape not found, using shape dimensions.")};$jscomp.inherits(hamonengine.entities.shapeObject,hamonengine.entities.object2d);hamonengine.entities.shapeObject.prototype.reset=function(){this._mirroredState=!1;return hamonengine.entities.object2d.prototype.reset.call(this)};hamonengine.entities.shapeObject.prototype.addVertex=function(a,b){(this.isPolygon?this._shape:
this._shape=this._shape.toPolygon()).addVertex(a,b);return this};hamonengine.entities.shapeObject.prototype.move=function(a,b){hamonengine.entities.object2d.prototype.move.call(this,a,void 0===b?null:b);this.isPolygon&&((this.faceAxisOnMove&OBJECT_FACE_DIRECTION.XAXIS)===OBJECT_FACE_DIRECTION.XAXIS&&0!==this.direction.x&&(this._mirroredState=this.direction.x===this._directionBasis.x,this.theta=0),(this.faceAxisOnMove&OBJECT_FACE_DIRECTION.YAXIS)===OBJECT_FACE_DIRECTION.YAXIS&&0!==this.direction.y&&
(this.theta=this.direction.y===this._directionBasis.y?Math.PI_2:-Math.PI_2));return this};hamonengine.entities.shapeObject.prototype.transformShape=function(a){this.theta=(this.theta+this.isHoldRotate*a/1E3*Math.PI/4)%Math.PI2;this.scale+=this.isHoldScale*a/1E3*.1;a=this.shape.translate(this.position);return this.isPolygon?(a=a.mirror?a.mirror(this._mirroredState):a,a=a.rotateAtCenter?a.rotateAtCenter(this.theta):a,a.scaleAtCenter?a.scaleAtCenter(new hamonengine.math.vector2(this.scale,this.scale)):
a):a};hamonengine.entities.shapeObject.prototype.isCollision=function(a){if(this.isSolid){var b=new hamonengine.math.vector2;a instanceof hamonengine.entities.shapeObject&&a.isSolid&&(b=a.position.subtract(this.position),a=a.shape.translate(a.position));return hamonengine.entities.object2d.prototype.isCollision.call(this,a,b)}return new hamonengine.math.vector2};hamonengine.entities.shapeObject.prototype.render=function(a,b,c){var d=void 0===c?{}:c;c=void 0===d.lineWidth?2:d.lineWidth;var e=void 0===
d.color?"blue":d.color;d=void 0===d.drawNormals?!1:d.drawNormals;this.shape&&a.drawShape(this.transformShape(b),0,0,{lineWidth:c,color:e,drawNormals:d})};$jscomp.global.Object.defineProperties(hamonengine.entities.shapeObject.prototype,{shape:{configurable:!0,enumerable:!0,get:function(){return this._shape},set:function(a){this._shape=a;this._hasBoundingShape||(this._boundingShape=this.shape)}},faceAxisOnMove:{configurable:!0,enumerable:!0,get:function(){return this._faceAxisOnMove},set:function(a){this._faceAxisOnMove=
a}},isPolygon:{configurable:!0,enumerable:!0,get:function(){return this.shape instanceof hamonengine.geometry.polygon}},isRect:{configurable:!0,enumerable:!0,get:function(){return this.shape instanceof hamonengine.geometry.rect}},isLine:{configurable:!0,enumerable:!0,get:function(){return this.shape instanceof hamonengine.geometry.lineSegment}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.cell=function(a){a=void 0===a?{}:a;hamonengine.entities.object2d.call(this,a);this._movementRate=0;this._direction=new hamonengine.math.vector2;this._theta=0;this._children=[];this._objects=[];this._zIndexSorter=new hamonengine.util.sort({compareFunc:function(b,c){return b===c?0:b.zIndex<c.zIndex?-1:1}})};$jscomp.inherits(hamonengine.entities.cell,hamonengine.entities.object2d);hamonengine.entities.cell.prototype.addChild=function(a){this._children.push(a)};hamonengine.entities.cell.prototype.addObject=
function(a){this._objects.push(a)};hamonengine.entities.cell.prototype.addObjects=function(a){for(var b=0;b<a.length;b++)this._objects.push(a[b])};hamonengine.entities.cell.prototype.process=function(a){if(this.objects)for(var b=new Set,c=0;c<this.objects.length;c++){var d=this.objects[c];if(d.isMovable&&(d.move(a),this.isSolid)){var e=hamonengine.math.vector2.clone(d.position),f=this.isContained(d);0>f.x?e.x=this.boundingShape.x-d.boundingShape.x:0<f.x&&(e.x=this.boundingShape.width-d.boundingShape.right);
0>f.y?e.y=this.boundingShape.y-d.boundingShape.y:0<f.y&&(e.y=this.boundingShape.height-d.boundingShape.bottom);if(!d.onEnvironmentCollision(e,this))break}for(e=0;e<this.objects.length;e++)if(f=this.objects[e],d!==f){var g=d.name+"->"+f.name;b.has(g)||(b.add(g),b.add(f.name+"->"+d.name))}}};hamonengine.entities.cell.prototype.render=function(a,b){if(this.objects&&(this._zIndexSorter.quickSort(this._objects),this.objects))for(var c=0;c<this.objects.length;c++)this.objects[c].render(a,b)};$jscomp.global.Object.defineProperties(hamonengine.entities.cell.prototype,
{children:{configurable:!0,enumerable:!0,get:function(){return this._children}},objects:{configurable:!0,enumerable:!0,get:function(){return this._objects}}})})();hamonengine.events=hamonengine.events||{};
(function(){hamonengine.events.frame=function(a){a=void 0===a?{}:a;hamonengine.math.datastructures.tree.call(this,a);this._name=a.name||"";this._loadingState=this._frameState=FRAME_STATE.STOPPED;this._startFrameTime=0;hamonengine.debug&&console.debug("[hamonengine.events.frame.constructor] Name: "+this._name)};$jscomp.inherits(hamonengine.events.frame,hamonengine.math.datastructures.tree);hamonengine.events.frame.prototype.clone=function(){return new hamonengine.events.frame(this)};hamonengine.events.frame.prototype.start=
function(){this.frameState===FRAME_STATE.STOPPED&&(this.frameState=FRAME_STATE.STARTING)};hamonengine.events.frame.prototype.stop=function(a){this.frameState!==FRAME_STATE.STOPPED&&(this.frameState=(void 0===a?0:a)?FRAME_STATE.STOPPED:FRAME_STATE.STOPPING)};hamonengine.events.frame.prototype.pause=function(){this.frameState===FRAME_STATE.RUNNING&&(this.frameState=FRAME_STATE.PAUSED)};hamonengine.events.frame.prototype.load=function(a,b){var c=this,d,e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==
k.nextAddress){c._loadingState=FRAME_STATE.LOADING;d=[];e=c.onloadResources(b);if(!(e instanceof Promise))return k.jumpTo(0);d.push(e);if(a)for(f=c.first;null!==f;)g=f.load(a,b),g instanceof Promise&&d.push(g),f=f.next;return k.yield(Promise.all(d),3)}c._loadingState=FRAME_STATE.LOADED;k.jumpToEnd()})};hamonengine.events.frame.prototype.__internalClear=function(a){hamonengine.math.datastructures.tree.prototype.__internalClear.call(this,a);a&&this.onRelease()};hamonengine.events.frame.prototype.findAncestorByName=
function(a){return hamonengine.events.frame.searchAncestorByPredicate(this.parent,function(b){return null!==b&&b.name.toLowerCase()!==a.toLowerCase()})};hamonengine.events.frame.prototype.findChildByName=function(a){return hamonengine.events.frame.searchByPredicate(this.first,function(b){return null!==b&&b.name.toLowerCase()!==a.toLowerCase()})};hamonengine.events.frame.prototype.render=function(a,b,c){switch(this.frameState){case FRAME_STATE.STARTING:0===this._startFrameTime&&(this._startFrameTime=
c);this.onFrameStarting(a,b,c);break;case FRAME_STATE.RUNNING:this.onFrame(a,b,c);break;case FRAME_STATE.STOPPING:this.onFrameStopping(a,b,c)}};hamonengine.events.frame.prototype.onloadResources=function(a){return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){b.jumpToEnd()})};hamonengine.events.frame.prototype.onFrameStarting=function(a,b,c){this.frameState=FRAME_STATE.RUNNING};hamonengine.events.frame.prototype.onFrame=function(a,b,c){};hamonengine.events.frame.prototype.onFrameStopping=
function(a,b,c){this.frameState=FRAME_STATE.STOPPED};hamonengine.events.frame.prototype.onProcessingFrame=function(a,b,c){};hamonengine.events.frame.prototype.onRelease=function(){};hamonengine.events.frame.prototype.onKeyEvent=function(a,b,c,d,e){};hamonengine.events.frame.prototype.onMouseEvent=function(a,b,c,d,e){};hamonengine.events.frame.prototype.onTouchEvent=function(a,b,c,d,e){};$jscomp.global.Object.defineProperties(hamonengine.events.frame.prototype,{name:{configurable:!0,enumerable:!0,
get:function(){return this._name},set:function(a){this._name=a}},frameState:{configurable:!0,enumerable:!0,get:function(){return this._frameState},set:function(a){this._frameState=a}},startFrameTime:{configurable:!0,enumerable:!0,get:function(){return this._startFrameTime}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._loadingState===FRAME_STATE.LOADED}}})})();hamonengine.events=hamonengine.events||{};
(function(){hamonengine.events.storyboard=function(a){a=void 0===a?{}:a;hamonengine.events.frame.call(this,a);a instanceof hamonengine.events.storyboard&&(a={engine:a._engine,currentFrames:a._currentFrames,loop:a._loop,preloadAllFrames:a._preloadAllFrames,allowFramesToComplete:a._allowFramesToComplete});this._engine=a.engine;this._loop=void 0!==a.loop?a.loop:!1;this._preloadAllFrames=void 0!==a.preloadAllFrames?a.preloadAllFrames:!1;this._allowFramesToComplete=void 0!==a.allowFramesToComplete?a.allowFramesToComplete:
!0;this._currentFrames=a._currentFrames||[]};$jscomp.inherits(hamonengine.events.storyboard,hamonengine.events.frame);hamonengine.events.storyboard.prototype.clone=function(){return new hamonengine.events.storyboard(this)};hamonengine.events.storyboard.prototype.start=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){if(1==b.nextAddress)return hamonengine.events.frame.prototype.start.call(a),!a.currentFrame&&a.goTop(),b.yield(a.load(a._preloadAllFrames,a),2);a.currentFrame.start();
b.jumpToEnd()})};hamonengine.events.storyboard.prototype.stop=function(){hamonengine.events.frame.prototype.stop.call(this);this.clear()};hamonengine.events.storyboard.prototype.goTop=function(){return this.setFrame(this.first)};hamonengine.events.storyboard.prototype.goUp=function(){return this.currentFrame&&this.currentFrame.parent?this.setFrame(this.currentFrame.parent):null};hamonengine.events.storyboard.prototype.goDown=function(){return this.currentFrame&&this.currentFrame.first?this.setFrame(this.currentFrame.first):
null};hamonengine.events.storyboard.prototype.goFirst=function(){var a=this.currentFrame?this.currentFrame.parent:null;return a&&a.first?this.setFrame(a.first):null};hamonengine.events.storyboard.prototype.goNext=function(){if(this.currentFrame){var a=this.currentFrame.next||!this.loop?this.currentFrame.next:this.currentFrame.parent.first;if(a)return this.setFrame(a)}return null};hamonengine.events.storyboard.prototype.goPrev=function(){if(this.currentFrame){var a=this.currentFrame.prev||!this.loop?
this.currentFrame.prev:this.currentFrame.parent.last;if(a)return this.setFrame(a)}return null};hamonengine.events.storyboard.prototype.jump=function(a){var b=storyboard;for(a=a.split(".");0<a.length&&(b=b.findChildByName(a.shift())););return this.setFrame(b)};hamonengine.events.storyboard.prototype.setFrame=function(a){var b=!this.allowFramesToComplete||this.currentFrame&&this.currentFrame.frameState===FRAME_STATE.STOPPED||1<this._currentFrames.length?this._currentFrames.shift():this.currentFrame;
b&&b.stop(!this.allowFramesToComplete);this._currentFrames.push(a);a instanceof hamonengine.events.storyboard||a.start();return a};hamonengine.events.storyboard.prototype.onloadResources=function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){hamonengine.debug&&console.debug("[hamonengine.events.storyboard.onloadResources]");a.jumpToEnd()})};hamonengine.events.storyboard.prototype.onFrame=function(a,b){var c=this.currentFrame;c&&c.frameState===FRAME_STATE.STOPPED&&1<this._currentFrames.length&&
this._currentFrames.shift();this.currentFrame&&this.currentFrame.render(a,this,b)};hamonengine.events.storyboard.prototype.onProcessingFrame=function(a,b){this.currentFrame&&this.currentFrame.onProcessingFrame(a,this,b)};hamonengine.events.storyboard.prototype.onKeyEvent=function(a,b,c,d){this.currentFrame&&this.currentFrame.onKeyEvent(this,a,b,c,d)};hamonengine.events.storyboard.prototype.onMouseEvent=function(a,b,c,d){this.currentFrame&&this.currentFrame.onMouseEvent(this,a,b,c,d)};hamonengine.events.storyboard.prototype.onTouchEvent=
function(a,b,c,d){this.currentFrame&&this.currentFrame.onTouchEvent(this,a,b,c,d)};$jscomp.global.Object.defineProperties(hamonengine.events.storyboard.prototype,{currentFrame:{configurable:!0,enumerable:!0,get:function(){return this._currentFrames.first()}},engine:{configurable:!0,enumerable:!0,get:function(){return this._engine},set:function(a){if(this._engine)throw"The engine has already been assigned for the storyboard: "+this.name;this._engine=a}},loop:{configurable:!0,enumerable:!0,get:function(){return this._loop},
set:function(a){this._loop=a}},allowFramesToComplete:{configurable:!0,enumerable:!0,get:function(){return this._allowFramesToComplete},set:function(a){this._allowFramesToComplete=a}}})})();hamonengine.events=hamonengine.events||{};var FRAME_STATE={STOPPED:0,STARTING:1,LOADING:2,LOADED:3,RUNNING:4,PAUSED:5,STOPPING:6};hamonengine.core=hamonengine.core||{};
(function(){var a=["STOPPED","STARTED","LOADING","RUNNING"];hamonengine.core.engine=function(b){var c=this;b=void 0===b?{}:b;console.log("HamonEngine -- Using version: 1.0.0");this._syncFrames=void 0!==b.syncFrames?b.syncFrames:!1;this._showEngineSplashScreen=void 0!==b.showEngineSplashScreen?b.showEngineSplashScreen:!0;this._splashScreenWait=void 0!==b.splashScreenWait?b.splashScreenWait:500;this._allowDocumentEventBinding=void 0!==b.allowDocumentEventBinding?b.allowDocumentEventBinding:!1;this._captureTouchAsMouseEvents=
void 0!==b.captureTouchAsMouseEvents?b.captureTouchAsMouseEvents:!0;(this._storyboard=b.storyboard)&&!this._storyboard.engine&&(this._storyboard.engine=this);var d=void 0!==b.blockArrowKeys?b.blockArrowKeys:!0;this._preventDefaultState=0;this._preventDefaultState|=b.blockAllKeys?1:0;this._preventDefaultState|=d?2:0;this._externalElements=b.externalElements||[];this._processingId=this._animationId=this._lastFrameTimeStamp=this._startTimeStamp=this._state=0;this._fpsCounter=new fpscounter;this._layers=
{};this._registeredEvents=[];d=b.canvas||[];if((void 0!==b.detectCanvas?b.detectCanvas:1)&&0===d.length)hamonengine.debug&&console.debug("[hamonengine.core.engine.constructor] DetectCanvas: true.  Attempting to detect all canvas."),Object.entries(document.getElementsByTagName("canvas")).forEach(function(h){var l=$jscomp.makeIterator(h);h=l.next().value;l=l.next().value;var m=l.getAttribute("name")||"canvas"+h;h=l.getAttribute("id")||"canvas"+h;c._layers[m]=new hamonengine.graphics.layer({name:m,canvas:l,
canvasId:h,allowEventBinding:l.dataset.alloweventbinding,enableImageSmoothing:l.dataset.enableimagesmoothing,clipToViewPort:l.dataset.cliptoviewport})});else{hamonengine.debug&&console.debug("[hamonengine.core.engine.constructor] DetectCanvas: false.  Using collection of options.canvas.");for(var e=0,f=0;f<d.length;f++){var g=d[f],k=g.name||"canvas"+e++;this._layers[k]=new hamonengine.graphics.layer({name:k,canvasId:g.id,viewPort:g.viewPort,allowEventBinding:g.allowEventBinding,enableImageSmoothing:b.enableImageSmoothing,
clipToViewPort:g.clipToViewPort})}}this._resourcesLoaded=!1;hamonengine.debug&&(console.debug("[hamonengine.core.engine.constructor] MovementRate: "+this._movementRate),console.debug("[hamonengine.core.engine.constructor] State: "+a[this._state]),console.debug("[hamonengine.core.engine.constructor] SyncFrames: "+(this.syncFrames?"Enabled":"Disabled")),console.debug("[hamonengine.core.engine.constructor] SplashScreen Wait Time: "+this._splashScreenWait+" milliseconds."),console.debug("[hamonengine.core.engine.constructor] Engine SplashScreen: "+
(this._showEngineSplashScreen?"Enabled":"Disabled")),this._storyboard&&console.debug("[hamonengine.core.engine.constructor] Storyboard Added: "+this._storyboard.name),console.debug("[hamonengine.core.engine.constructor] Global States"),console.debug("[hamonengine.core.engine.constructor] hamonengine.geometry.settings.collisionDetection.floor: "+hamonengine.geometry.settings.collisionDetection.floor),console.debug("[hamonengine.core.engine.constructor] hamonengine.geometry.settings.collisionDetection.limit: "+
hamonengine.geometry.settings.collisionDetection.limit),console.debug("[hamonengine.core.engine.constructor] hamonengine.geometry.settings.coordinateSystem: "+hamonengine.geometry.settings.coordinateSystem))};hamonengine.core.engine.prototype.getLayer=function(b){return this._layers[b]};hamonengine.core.engine.prototype.load=function(){var b=this,c,d,e,f,g,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:hamonengine.debug&&console.debug("[hamonengine.core.engine.load]");
c=new Promise(function(l){b.onPreload()?setTimeout(function(){return l()},b._splashScreenWait):l()});b._state=2;console.log("[hamonengine.core.engine.load] State: "+a[b._state]);h.setCatchFinallyBlocks(2);d=b.onEventBinding();if(!(d instanceof Promise))throw"onEventBinding is not returning a promise!  This event must return an unhandled promise.";console.log("%c[hamonengine.core.engine.load] Engine is paused, waiting for event binding to resolve...","color: yellow");return h.yield(d,4);case 4:console.log("%c[hamonengine.core.engine.load] Engine has resumed loading, event binding has completed.",
"color: green");e=[];f=b.onloadResources();if(!(f instanceof Promise))throw"onloadResources is not returning a promise!  This event must return an unhandled promise.";e.push(f);if(b.primaryStoryboard){g=b.primaryStoryboard.start();if(!(g instanceof Promise))throw"onloadResources is not returning a promise!  This event must return an unhandled promise.";e.push(g)}console.log("%c[hamonengine.core.engine.load] Engine is paused, waiting for resources to resolve...","color: yellow");return h.yield(Promise.all(e),
5);case 5:return b._resourcesLoaded=!0,console.log("%c[hamonengine.core.engine.load] Engine has resumed loading, resource loading completed.","color: green"),console.log("%c[hamonengine.core.engine.load] Engine is paused, waiting for preload event to resolve...","color: yellow"),h.yield(c,6);case 6:console.log("%c[hamonengine.core.engine.load] Preload completed.","color: green");h.leaveTryBlock(3);break;case 2:k=h.enterCatchBlock(),console.error("[hamonengine.core.engine.load] Resources could not be loaded due to a failure! Stopping the engine."),
console.error(k),b.stop({reasons:"A critical error occured during resource loading."});case 3:return h.return(b)}})};hamonengine.core.engine.prototype.start=function(){hamonengine.debug&&console.debug("[hamonengine.core.engine.start]");2===this._state&&(this._state=1,console.log("[hamonengine.core.engine.start] State: "+a[this._state]),this.fpsCounter.start(),this.onDraw(0));return this};hamonengine.core.engine.prototype.stop=function(b){b=(void 0===b?{reasons:"Stopped By User"}:b).reasons;hamonengine.debug&&
console.debug("[hamonengine.core.engine.stop]");window.cancelAnimationFrame(this._animationId);clearTimeout(this._processingId);this._processingId=this._animationId=this._startTimeStamp=this._lastFrameTimeStamp=0;this.onStop(b);this._registeredEvents.forEach(function(c){return c.element.removeEventListener(c.name,c.functionSignature)});this._registeredEvents=[];this.primaryStoryboard&&this.primaryStoryboard.stop();Object.values(this._layers).forEach(function(c){return c&&c.release()});this._externalElements=
this._layers=[];this._state=0;console.log("[hamonengine.core.engine.stop] State: "+a[this._state]);return this};hamonengine.core.engine.prototype.onPreload=function(){hamonengine.debug&&console.debug("[hamonengine.core.engine.onPreload]");return!1};hamonengine.core.engine.prototype.onloadResources=function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){hamonengine.debug&&console.debug("[hamonengine.core.engine.onloadResources]");return b.return(Promise.resolve())})};hamonengine.core.engine.prototype.onEventBinding=
function(){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){return c.return(new Promise(function(d,e){var f=function(){var g=new Map,k=function(h,l){var m=function(p,q){b.onKeyEvent(p,q.code,q,l);q&&(b.blockByDefaultAllKeys?q.preventDefault():b.blockByDefaultArrowKeys&&("ArrowLeft"===q.code||"ArrowRight"===q.code||"ArrowUp"===q.code||"ArrowDown"===q.code)&&q.preventDefault())},n=function(p,q){b.onMouseEvent(p,new hamonengine.math.vector2(q.offsetX,q.offsetY),q,l)},t=function(p,
q){var u=g.has(l.name)?g.get(l.name):"";g.set(l.name,p);var v=l.position;if(v){for(var x=[],w=0;w<q.touches.length;w++)x.push(new hamonengine.math.vector2(q.touches[w].clientX-v.x,q.touches[w].clientY-v.y));u="end"===p&&"start"===u;b.onTouchEvent(p,x,q,l);u&&b.onTouchEvent("click",x,q,l);b.captureTouchAsMouseEvents&&(p="start"===p?"down":p,p="end"===p?"up":p,v=new hamonengine.math.vector2(q.changedTouches[0].clientX-v.x,q.changedTouches[0].clientY-v.y),b.onMouseEvent(p,v,q,l),u&&b.onMouseEvent("click",
v,q,l))}},r=function(p,q,u){q.addEventListener(p,u);b._registeredEvents.push({name:p,element:q,functionSignature:u})};r("keyup",h,function(p){return m("up",p)});r("keydown",h,function(p){return m("down",p)});r("click",h,function(p){return n("click",p)});r("mouseup",h,function(p){return n("up",p)});r("mousedown",h,function(p){return n("down",p)});r("mousemove",h,function(p){return n("move",p)});r("mouseenter",h,function(p){return n("enter",p)});r("mouseleave",h,function(p){return n("leave",p)});r("touchstart",
h,function(p){return t("start",p)},{passive:!1});r("touchmove",h,function(p){return t("move",p)},{passive:!1});r("touchend",h,function(p){return t("end",p)},{passive:!1});r("touchcancel",h,function(p){return t("cancel",p)},{passive:!1});window.removeEventListener("DOMContentLoaded",f)};b.allowDocumentEventBinding&&k(document,b);b.externalElements.forEach(function(h){return k(h,h)});b.layers.forEach(function(h){return h.allowEventBinding&&k(h.canvas,h)})};"complete"!==window.document.readyState?window.document.addEventListener("DOMContentLoaded",
f):f();d()}))})};hamonengine.core.engine.prototype.onKeyEvent=function(b,c,d,e){this.primaryStoryboard&&this.primaryStoryboard.onKeyEvent(b,c,d,e);hamonengine.debug&&hamonengine.verbose&&console.debug("[hamonengine.core.engine.onKeyEvent] Type: '"+b+"' '"+c+"'");return this};hamonengine.core.engine.prototype.onMouseEvent=function(b,c,d,e){this.primaryStoryboard&&this.primaryStoryboard.onMouseEvent(b,c,d,e);hamonengine.debug&&hamonengine.verbose&&console.debug("[hamonengine.core.engine.onMouseEvent] Type: '"+
b+"' '"+c.toString()+"'");return this};hamonengine.core.engine.prototype.onTouchEvent=function(b,c,d,e){d&&d.preventDefault();this.primaryStoryboard&&this.primaryStoryboard.onTouchEvent(b,c,d,e);hamonengine.debug&&hamonengine.verbose&&console.debug("[hamonengine.core.engine.onTouchEvent] Type: '"+b+"' '"+d+"'");return this};hamonengine.core.engine.prototype.onDraw=function(b){var c=this;b=b||0;this._startTimeStamp||(this._startTimeStamp=b);var d=b-this._lastFrameTimeStamp;try{var e=!1;this._processingId=
setTimeout(function(){c.onProcessingFrame(d,b);e=!0},1);this._animationId=window.requestAnimationFrame(function(f){c._state=3;c.syncFrames&&!e||c.onFrame(d,b);c.onDraw(f)})}catch(f){this.stop(),hamonengine.debug&&console.debug(f)}this._lastFrameTimeStamp=b;return this};hamonengine.core.engine.prototype.onFrame=function(b,c){this.primaryStoryboard&&this.primaryStoryboard.onFrame(b,c);return this};hamonengine.core.engine.prototype.onProcessingFrame=function(b,c){this.primaryStoryboard&&this.primaryStoryboard.onProcessingFrame(b,
c);return this};hamonengine.core.engine.prototype.onStop=function(b){"Stopped By User"===b&&this.primaryLayer&&(this.primaryLayer.clear(),this.primaryLayer.drawText("お やすみ",this.primaryLayer.viewPort.width/2,this.primaryLayer.viewPort.height/2,{font:"bold 48px serif",textOffset:"center",shadow:!0,color:"gold"}),console.log("%c[hamonengine.core.engine.onStop] お やすみ GoodBye","color: red"));return this};$jscomp.global.Object.defineProperties(hamonengine.core.engine.prototype,{primaryLayer:{configurable:!0,
enumerable:!0,get:function(){return this._layers.canvas0}},primaryStoryboard:{configurable:!0,enumerable:!0,get:function(){return this._storyboard}},resourcesLoaded:{configurable:!0,enumerable:!0,get:function(){return this._resourcesLoaded}},fpsCounter:{configurable:!0,enumerable:!0,get:function(){return this._fpsCounter}},layers:{configurable:!0,enumerable:!0,get:function(){return Object.values(this._layers)}},externalElements:{configurable:!0,enumerable:!0,get:function(){return this._externalElements}},
syncFrames:{configurable:!0,enumerable:!0,get:function(){return this._syncFrames},set:function(b){this._syncFrames=b}},allowDocumentEventBinding:{configurable:!0,enumerable:!0,get:function(){return this._allowDocumentEventBinding}},captureTouchAsMouseEvents:{configurable:!0,enumerable:!0,get:function(){return this._captureTouchAsMouseEvents},set:function(b){this._captureTouchAsMouseEvents=b}},blockByDefaultAllKeys:{configurable:!0,enumerable:!0,get:function(){return 1===(this._preventDefaultState&
1)},set:function(b){this._preventDefaultState=b?this._preventDefaultState|1:this._preventDefaultState^1}},blockByDefaultArrowKeys:{configurable:!0,enumerable:!0,get:function(){return 2===(this._preventDefaultState&2)},set:function(b){this._preventDefaultState=b?this._preventDefaultState|2:this._preventDefaultState^2}}})})();
