/*
 Hamonengine 波紋
 Copyright \(c\) 2020-2022, CaffeinatedRat.
 All rights reserved.
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

     * Redistributions of source code must retain the above copyright
       notice, this list of conditions and the following disclaimer.
     * Redistributions in binary form must reproduce the above copyright
       notice, this list of conditions and the following disclaimer in the
       documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY
 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE AUTHOR AND CONTRIBUTORS BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(p){f(p)}}:b}var d,f,g=new e(function(a,
b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,
d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");
$jscomp.executeAsyncGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,e){function f(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(f,e)}f(a.next())})};
$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if("prototype"!=d)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function c(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(l){return!1}}())return a;var d="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var e=0,f=function(a){this.id_=(e+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};f.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};f.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};f.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};f.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return f},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(t){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,b){var c=d(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};c.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};c.prototype.has=function(a){return!!d(this,a).entry};c.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};c.prototype.entries=function(){return e(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return e(this,function(a){return a.key})};c.prototype.values=function(){return e(this,function(a){return a.value})};c.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(a,c){var d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++h,b.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=
e[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},e=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=a.next=a.head=a},h=0;return c},"es6","es3");
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),d=new a($jscomp.makeIterator([b]));if(!d.has(b)||1!=d.size||d.add(b)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=b||f.value[1]!=b)return!1;f=e.next();return f.done||f.value[0]==b||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:e.next().done}catch(h){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return b},"es6","es3");$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");
$jscomp.polyfill("Object.values",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push(a[d]);return b}},"es8","es3");var hamonengine={debug:!1};var bitflag=function(){};bitflag.toggle=function(a,b,c){return void 0!==c?c?a|1<<b:a&~(1<<b):a^1<<b};bitflag.isSet=function(a,b){b=1<<b;return(a&b)===b};var connect=function(a){a=void 0===a?{}:a;this._timeout=a.timeout};
connect.get=function(a,b){b=(void 0===b?{}:b).timeout;if(!a)throw"Invalid url '"+a+"'";var c=new XMLHttpRequest;if(!c)throw"Unable to create XMLHttpRequest";void 0!==b&&(c.timeout=b);return new Promise(function(b,e){c.addEventListener("load",function(a){var d=c.status;0===d||200<=d&&400>d?b({data:c.responseText,status:c.status,statusText:c.statusText,event:a}):e({status:c.status,statusText:c.statusText,event:a})});c.addEventListener("error",function(a){return e({status:c.status,statusText:c.statusText,
event:a})});c.open("GET",a);c.send()})};
connect.post=function(a,b,c){c=void 0===c?{}:c;var d=c.timeout,e=c.contentType,f=c.accept;if(!a)throw"Invalid url '"+a+"'";var h=new XMLHttpRequest;if(!h)throw"Unable to create XMLHttpRequest";void 0!==d&&(h.timeout=d);return new Promise(function(c,d){h.addEventListener("load",function(a){0===status||200<=status&&400>status?c({data:h.responseText,status:h.status,statusText:h.statusText,event:a}):d({status:h.status,statusText:h.statusText,event:a})});h.addEventListener("error",function(a){return d({status:h.status,
statusText:h.statusText,event:a})});h.open("POST",a);void 0!==e?h.setRequestHeader("Content-Type",e):h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");void 0!==f?h.setRequestHeader("Accept",f):h.setRequestHeader("Accept","application/x-www-form-urlencoded");h.send(b)})};$jscomp.global.Object.defineProperties(connect.prototype,{timeout:{configurable:!0,enumerable:!0,get:function(){return this._timeout}}});var MILLISECONDS=1E3,fpscounter=function(a){this._spf=this._fps=this._frameCounter=this._globalStartTime=0;this._minFPS=MILLISECONDS;this._maxFPS=0};fpscounter.prototype.start=function(){this._globalStartTime=Date.now();this._spf=this._fps=this._frameCounter=0;this._minFPS=MILLISECONDS;this._maxFPS=0};fpscounter.prototype.begin=function(){this._frameStartTime=Date.now()};
fpscounter.prototype.end=function(){if(0===this._startTime)throw"[fpscounter.end] Begin was not called before end.";var a=Date.now();this._frameCounter++;this._spf=(a-this._frameStartTime)*MILLISECONDS;a>this._globalStartTime+MILLISECONDS&&(this._fps=Math.round(MILLISECONDS*this._frameCounter/(a-this._globalStartTime)),this._minFPS=Math.min(this._minFPS,this._fps),this._maxFPS=Math.max(this._maxFPS,this._fps),this._globalStartTime=a,this._frameCounter=0)};
$jscomp.global.Object.defineProperties(fpscounter.prototype,{SPF:{configurable:!0,enumerable:!0,get:function(){return this._spf}},FPS:{configurable:!0,enumerable:!0,get:function(){return this._fps}},minFPS:{configurable:!0,enumerable:!0,get:function(){return this._minFPS}},maxFPS:{configurable:!0,enumerable:!0,get:function(){return this._maxFPS}}});var listenerPool=function(a){this._listeners=[]};listenerPool.prototype.register=function(a){this._listeners.push(a)};listenerPool.prototype.invoke=function(a,b){this._listeners.forEach(function(c){return c[a]&&c[a](b)})};$jscomp.global.Object.defineProperties(listenerPool.prototype,{listeners:{configurable:!0,enumerable:!0,get:function(){return this._listeners}}});var worker=function(a){a=void 0===a?{}:a;a instanceof worker&&(a={blob:a.blob,method:a.method});if(!a.method)throw console.error("[worker.constructor] Unable to create a workert: options.method is undefined!"),"Cannot create the worker";this._method=a.method;this._blob=a.blob||new Blob(["onmessage = "+a.method.toString()+";"],{type:"text/javascript"});this._url=URL.createObjectURL(this._blob);this._worker=new Worker(this._url)};worker.create=function(a){return new worker({method:a})};
worker.prototype.run=function(a){var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,e){for(;;)switch(d){case 0:return d=-1,{value:new Promise(function(c,d){b.worker.onmessage=function(a){c(a.data);URL.revokeObjectURL(b.url)};b.worker.onerror=function(a){d(a);URL.revokeObjectURL(b.url)};b.worker.postMessage(a)}),done:!0};default:return{value:void 0,done:!0}}}var d=0,e={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())};$jscomp.global.Object.defineProperties(worker.prototype,{blob:{configurable:!0,enumerable:!0,get:function(){return this._blob}},method:{configurable:!0,enumerable:!0,get:function(){return this._method}},url:{configurable:!0,enumerable:!0,get:function(){return this._url}},worker:{configurable:!0,enumerable:!0,get:function(){return this._worker}}});hamonengine.math=hamonengine.math||{};(function(){Math.PI2=6.283185307179586;Math.PI3_2=3*Math.PI/2;Math.PI_2=Math.PI/2;Math.HalfPI=1.5707963267948966;Math.QuarterPI=4.71238898038469;Math.maxInt32=2147483647;Math.maxUInt32=4294967296;Math.bitRound=function(a){return.5+a<<0};Math.truncate=function(a){return a>=Math.maxInt32?Math.maxInt32:~~a};Math.sqr=function(a){return a*a};Math.toDegrees=function(a){return a*Math.PI/180};Math.toRadians=function(a){return 180*a/Math.PI}})();hamonengine.math=hamonengine.math||{};
(function(){hamonengine.math.sort=function(a){a=void 0===a?{}:a;this._compareFunc=a.compareFunc?a.compareFunc:hamonengine.math.sort.sort.ascending};hamonengine.math.sort.prototype.quickSort=function(a){hamonengine.math.sort.iquicksort(this._compareFunc,a,0,a.length-1)};hamonengine.math.sort.ascending=function(a,b){return a===b?0:a<b?-1:1};hamonengine.math.sort.descending=function(a,b){return a===b?0:a<b?1:-1};hamonengine.math.sort.iquicksort=function(a,b,c,d){for(var e=c,f=d,h=b[Math.truncate((c+
d)/2)];e<=f;){for(;0>a(b[e],h);)e++;for(;0<a(b[f],h);)f--;if(e<=f){var g=b[e];b[e]=b[f];b[f]=g;e++;f--}}c<f&&hamonengine.math.sort.iquicksort(a,b,c,f);e<d&&hamonengine.math.sort.iquicksort(a,b,e,d)}})();hamonengine.math=hamonengine.math||{};(function(){var a=Math.maxUInt32;hamonengine.math.LCGRandom=function(a){this._seed=a};hamonengine.math.LCGRandom.prototype.random=function(){return this._seed=(214013*this._seed+2531011)%a}})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.album=function(a){a=void 0===a?{}:a;a instanceof hamonengine.audio.album&&(a={audioResource:a._audioResource,tracks:a._tracks,trackIndex:a._trackIndex,url:a._url,name:a._name});this._audioResource=a.audioResource||new hamonengine.audio.audioext;this._tracks=a.tracks||{};this._trackIndex=a.trackIndex||[];this._url=a.url||"";this._name=a.name||"";console.debug("[hamonengine.audio.album.constructor] Name: '"+this._name+"'");console.debug("[hamonengine.audio.album.constructor] Url: '"+this._url+
"'")};hamonengine.audio.album.prototype.clone=function(){return new hamonengine.audio.album(this)};hamonengine.audio.album.prototype.load=function(a){var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,g){for(;;)switch(d){case 0:a=a||b._url;if("string"!==typeof a){d=1;break}d=2;return{value:connect.get(a),done:!1};case 2:if(void 0===g){d=3;break}d=-1;throw g;case 3:f=h=c,a=JSON.parse(f.data);case 1:b._name=b._name||a.name;e=b._audioResource.load(a.albumUrl);for(c=0;c<a.tracks.length;c++)g=
a.tracks[c],b._trackIndex.push(g.name),b._tracks[g.name]=new hamonengine.audio.track({audioext:b._audioResource,name:g.name,trackBegin:g.begin,trackEnd:g.end});d=-1;return{value:e,done:!0};default:return{value:void 0,done:!0}}}var d=0,e,f,h,g={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())};hamonengine.audio.album.prototype.getTrack=
function(a){return this._tracks[a].clone()};hamonengine.audio.album.prototype.getTrackByOrdinal=function(a){return this._tracks[this._trackIndex[a]].clone()};$jscomp.global.Object.defineProperties(hamonengine.audio.album.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},length:{configurable:!0,enumerable:!0,get:function(){return this._trackIndex.length}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._audioResource.isLoaded()}}})})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.audioext=function(a){a=void 0===a?{}:a;a instanceof hamonengine.audio.audioext&&(a={audio:a._audio,url:a._url,eventBound:a._eventsBound,resourceState:a._resourceState,audioCtx:a._audioCtx,gainNode:a._gainNode,panNode:a._panNode,mediaSource:a._mediaSource});this._audio=a.audio||new Audio;this._url=a.url||"";this._fallbackSourceURLs=[];var b=this._audio.children;if(0<b.length)for(var c=0;c<b.length;c++)this._fallbackSourceURLs.push(b[c].src);this._resourceState=a.resourceState||
0;this._playingState=5;this._mediaSource=a.mediaSource||null;this._audioCtx=a.audioCtx||new AudioContext;this._gainNode=a.gainNode||this._audioCtx.createGain();this._panNode=a.panNode||new StereoPannerNode(this._audioCtx,{pan:0});this._audioListenerDelegate=null;this._eventsBound=void 0!==a.eventBound?a.eventBound:!1;console.debug("[hamonengine.audio.audioext.constructor] ResourceState: {"+this._resourceState+"}");console.debug("[hamonengine.audio.audioext.constructor] PlayingState: {"+this._playingState+
"}")};hamonengine.audio.audioext.prototype.clone=function(){return new hamonengine.audio.audioext(this)};hamonengine.audio.audioext.prototype.load=function(a){a=void 0===a?"":a;var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,h){for(;;)switch(d){case 0:a=a||b._url;if(!b.isLoaded||a!==b.audio.src){d=1;break}d=-1;return{value:Promise.resolve(b),done:!0};case 1:""!==a&&(b.audio.src=a,b.audio.load()),b._resourceState=1,f=function(){b._resourceState=2;b._mediaSource||(b._mediaSource=
b.context.createMediaElementSource(b._audio),b._mediaSource.connect(b._gainNode).connect(b._panNode).connect(b.context.destination));console.debug("[hamonengine.audio.audioext.load] Audio '"+b.src+"' has loaded successfully.");return Promise.resolve(b)},e=function(a){b._resourceState=3;return Promise.reject("The audio '"+(a&&a.path&&0<a.path.length&&a.path[0].src||"")+"' could not be loaded.")},b._eventsBound||(b._eventsBound=!0,b.audio.addEventListener("error",function(a){return e(a)},!1),b.audio.addEventListener("stalled",
function(a){return e(a)},!1),b.audio.addEventListener("ended",function(){return b.onAudioEnd()},!1),b.audio.addEventListener("timeupdate",function(a){return b.onAudioTimeUpdate(a)},!1),0===b.audio.readyState?b.audio.addEventListener("loadeddata",function(){return f()},!1):f()),d=-1;default:return{value:void 0,done:!0}}}var d=0,e,f,h={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();h[Symbol.iterator]=
function(){return this};return h}())};hamonengine.audio.audioext.prototype.play=function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function b(b,d){for(;;)switch(c){case 0:if(a.isPlaying){c=1;break}if("suspended"!==a.context.state){c=2;break}c=3;return{value:a.context.resume(),done:!1};case 3:if(void 0===d){c=4;break}c=-1;throw d;case 4:case 2:return a._playingState=4,c=-1,{value:a.audio.play(),done:!0};case 1:c=-1;default:return{value:void 0,done:!0}}}var c=0,d={next:function(a){return b(a,
void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())};hamonengine.audio.audioext.prototype.pause=function(){this.audio.pause();this._playingState=6};hamonengine.audio.audioext.prototype.stop=function(a){a=void 0===a?{}:a;var b=void 0===a.suspend?!0:a.suspend,c=this;return $jscomp.executeAsyncGenerator(function(){function a(a,d){for(;;)switch(e){case 0:c.audio.pause();
c._playingState=5;if(!b){e=1;break}e=-1;return{value:c.context.suspend(),done:!0};case 1:e=-1;default:return{value:void 0,done:!0}}}var e=0,f={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();f[Symbol.iterator]=function(){return this};return f}())};hamonengine.audio.audioext.prototype.onAudioEnd=function(){this._playingState=5;this.audioListenerDelegate&&this.audioListenerDelegate.onAudioEnd&&
this.audioListenerDelegate.onAudioEnd()};hamonengine.audio.audioext.prototype.onAudioTimeUpdate=function(a){this.audioListenerDelegate&&(this.audioListenerDelegate.onAudioTimeUpdate&&this.audioListenerDelegate.onAudioTimeUpdate(a),a.preventDefault())};$jscomp.global.Object.defineProperties(hamonengine.audio.audioext.prototype,{audio:{configurable:!0,enumerable:!0,get:function(){return this._audio}},context:{configurable:!0,enumerable:!0,get:function(){return this._audioCtx}},src:{configurable:!0,
enumerable:!0,get:function(){return this.audio.currentSrc}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return 2===this._resourceState}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return 4===this._playingState}},isStopped:{configurable:!0,enumerable:!0,get:function(){return 5===this._playingState}},fallbackSourceURLs:{configurable:!0,enumerable:!0,get:function(){return this._fallbackSourceURLs}},autoplay:{configurable:!0,enumerable:!0,get:function(){return this.audio.autoplay},
set:function(a){this.audio.autoplay=a}},loop:{configurable:!0,enumerable:!0,get:function(){return this.audio.loop},set:function(a){this.audio.loop=a}},muted:{configurable:!0,enumerable:!0,get:function(){return this.audio.muted},set:function(a){this.audio.muted=a}},volume:{configurable:!0,enumerable:!0,get:function(){return this._gainNode.gain.value},set:function(a){this._gainNode.gain.value=1<a?1:a}},audioListenerDelegate:{configurable:!0,enumerable:!0,get:function(){return this._audioListenerDelegate},
set:function(a){this._audioListenerDelegate=a}}})})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.playlist=function(a){var b=this;a=void 0===a?{}:a;a instanceof hamonengine.audio.playlist&&(a={tracks:a._tracks.map(function(a){return a.clone()}),index:a._index,loop:a._loop,autoplay:a._autoplay});this._name=a.name;this._tracks=[];this._index=a.index||0;this._loop=a.loop||0;this._autoplay=void 0!==a.autoplay?a.autoplay:!1;this._autoplayFilters=a.autoplayFilters||[];this._volume=1;this._listenerPool=new listenerPool;(a.tracks||[]).forEach(function(a){return b.addTrack(a)});
console.debug("[hamonengine.audio.playlist.constructor] Name: "+this._name);console.debug("[hamonengine.audio.playlist.constructor] Track Index: "+this._index);console.debug("[hamonengine.audio.playlist.constructor] Loop: "+(this._loop?"true":"false"));console.debug("[hamonengine.audio.playlist.constructor] Autoplay: "+(this._autoplay?"true":"false"))};hamonengine.audio.playlist.prototype.clone=function(){return new hamonengine.audio.playlist(this)};hamonengine.audio.playlist.prototype.register=function(a){this._listenerPool.register(a)};
hamonengine.audio.playlist.prototype.load=function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function b(b,e){for(;;)switch(c){case 0:d=[];for(b=0;b<a._tracks.length;b++)a._tracks[b].isLoaded||d.push(a._tracks[b].load());if(!(0<d.length)){c=1;break}c=-1;return{value:Promise.all(d),done:!0};case 1:return c=-1,{value:Promise.resolve(),done:!0};default:return{value:void 0,done:!0}}}var c=0,d,e={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())};hamonengine.audio.playlist.prototype.play=function(a){a=void 0===a?"":a;if(!this.currentTrack.isPlaying){if(""!==a){var b=this._tracks.findIndex(function(b){return b.name===a});-1<b&&(this.index=b)}this.currentTrack.volume=this.volume;this.currentTrack.play();this._listenerPool.invoke("onPlaylistPlay",{track:this.currentTrack})}};hamonengine.audio.playlist.prototype.pause=function(){this.currentTrack.pause();
this._listenerPool.invoke("onPlaylistPause",{track:this.currentTrack})};hamonengine.audio.playlist.prototype.stop=function(a){a=void 0===a?{}:a;a=void 0===a.reason?"invoked":a.reason;this.currentTrack.stop();this.index=0;this._listenerPool.invoke("onPlaylistStop",{track:this.currentTrack,reason:a})};hamonengine.audio.playlist.prototype.next=function(){this.currentTrack.isPlaying?(this.currentTrack.stop(),this.index++,this.currentTrack.play()):this.index++;this._listenerPool.invoke("onPlaylistNext",
{track:this.currentTrack})};hamonengine.audio.playlist.prototype.prev=function(){this.currentTrack.isPlaying?(this.currentTrack.stop(),this.index--,this.currentTrack.play()):this.index--;this._listenerPool.invoke("onPlaylistPrevious",{track:this.currentTrack})};hamonengine.audio.playlist.prototype.addTrack=function(a){a.register(this);this._tracks.push(a)};hamonengine.audio.playlist.createAutoPlayFadeFilter=function(a){var b=void 0===a?{}:a;a=void 0===b.fadeOutStart?.01:b.fadeOutStart;var c=void 0===
b.rateOfFade?0:b.rateOfFade;return function(b){var d=b.remainingTime,f=b.currentTrack;b=b.playList;var h=f.duration*a;d<h&&(d=0<c?f.volume-c:d/(f.volume*h),0<d?f.volume=d:(f.stop({suspend:!1}),b.next(),b.play()))}};hamonengine.audio.playlist.prototype.onTrackBegin=function(a){};hamonengine.audio.playlist.prototype.onTrackEnd=function(a){a=a.track;this.autoplay&&a===this.currentTrack&&(this.loop||this.index<this._tracks.length-1?(this.next(),this.play()):this.stop({reason:"playlistend"}))};hamonengine.audio.playlist.prototype.onTrackUpdate=
function(a){var b=a.track,c=a.elapsedTime;a=a.remainingTime;if(0<this._autoplayFilters.length)for(var d=this._tracks[this.index+1%this._tracks.length],e=0;e<this._autoplayFilters.length;e++)this._autoplayFilters[e]({elapsedTime:c,remainingTime:a,currentTrack:b,nextTrack:d,playList:this});this._listenerPool.invoke("onPlaylistUpdate",{track:b,elapsedTime:c,remainingTime:a,playlist:this})};$jscomp.global.Object.defineProperties(hamonengine.audio.playlist.prototype,{name:{configurable:!0,enumerable:!0,
get:function(){return this._name},set:function(a){this._name=a}},index:{configurable:!0,enumerable:!0,get:function(){return this._index},set:function(a){a%=this._tracks.length;this._index=0>a?this._tracks.length+a:a}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return this.currentTrack.isPlaying}},currentTrack:{configurable:!0,enumerable:!0,get:function(){return this._tracks[this.index]}},loop:{configurable:!0,enumerable:!0,get:function(){return this._loop},set:function(a){this._loop=
a}},autoplay:{configurable:!0,enumerable:!0,get:function(){return this._autoplay},set:function(a){this._autoplay=a}},volume:{configurable:!0,enumerable:!0,get:function(){return this._volume},set:function(a){this._volume=a}}})})();hamonengine.audio=hamonengine.audio||{};
(function(){hamonengine.audio.track=function(a){a=void 0===a?{}:a;a instanceof hamonengine.audio.track&&(a={name:a._name,audioext:a._audioext,audio:a._audio,url:a._url,trackBegin:a._trackBegin,trackEnd:a._trackEnd});this._name=a.name;this._audioext=a.audioext||new hamonengine.audio.audioext({audio:a.audio,url:a.url});this._trackBegin=a.trackBegin||0;this._trackEnd=a.trackEnd;this._listenerPool=new listenerPool;console.debug("[hamonengine.audio.track.constructor] Name: "+this._name);console.debug("[hamonengine.audio.track.constructor] Track Begin: "+
this._trackBegin);console.debug("[hamonengine.audio.track.constructor] Track End: {"+this._trackEnd+"}")};hamonengine.audio.track.prototype.clone=function(){return new hamonengine.audio.track(this)};hamonengine.audio.track.prototype.register=function(a){this._listenerPool.register(a)};hamonengine.audio.track.prototype.load=function(a){a=void 0===a?"":a;var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,e){for(;;)switch(d){case 0:return d=-1,{value:b._audioext.load(a),done:!0};
default:return{value:void 0,done:!0}}}var d=0,e={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())};hamonengine.audio.track.prototype.play=function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function b(b,d){for(;;)switch(c){case 0:if(a._audioext.isPlaying){c=1;break}a._audioext.audioListenerDelegate=a;a._audioext.isStopped&&
(a.audio.currentTime=a._trackBegin,a.onTrackBegin());c=-1;return{value:a._audioext.play(),done:!0};case 1:c=-1;default:return{value:void 0,done:!0}}}var c=0,d={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())};hamonengine.audio.track.prototype.pause=function(){this._audioext.pause()};hamonengine.audio.track.prototype.stop=function(a){a=
void 0===a?{}:a;var b=void 0===a.suspend?!0:a.suspend,c=this;return $jscomp.executeAsyncGenerator(function(){function a(a,d){for(;;)switch(e){case 0:return e=-1,{value:c._audioext.stop({suspend:b}),done:!0};default:return{value:void 0,done:!0}}}var e=0,f={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();f[Symbol.iterator]=function(){return this};return f}())};hamonengine.audio.track.prototype.onTrackBegin=
function(){this._listenerPool.invoke("onTrackBegin",{track:this})};hamonengine.audio.track.prototype.onAudioEnd=function(){this.loop?this.play():this._listenerPool.invoke("onTrackEnd",{track:this})};hamonengine.audio.track.prototype.onAudioTimeUpdate=function(a){var b=(this._trackEnd||this.audio.duration)-this.audio.currentTime;0>b?(this.stop({suspend:!1}),a.preventDefault()):this._listenerPool.invoke("onTrackUpdate",{track:this,elapsedTime:this.audio.currentTime-this._trackBegin,remainingTime:b})};
$jscomp.global.Object.defineProperties(hamonengine.audio.track.prototype,{src:{configurable:!0,enumerable:!0,get:function(){return this._audioext.src}},name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},context:{configurable:!0,enumerable:!0,get:function(){return this._audioext.context}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._audioext.isLoaded}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return this._audioext.isPlaying}},
audio:{configurable:!0,enumerable:!0,get:function(){return this._audioext.audio}},duration:{configurable:!0,enumerable:!0,get:function(){return(this._trackEnd||this.audio.duration)-this._trackBegin}},fallbackSourceURLs:{configurable:!0,enumerable:!0,get:function(){return this._audioext.fallbackSourceURLs}},autoplay:{configurable:!0,enumerable:!0,get:function(){return this._audioext.autoplay},set:function(a){this._audioext.autoplay=a}},loop:{configurable:!0,enumerable:!0,get:function(){return this._audioext.loop},
set:function(a){this._audioext.loop=a}},muted:{configurable:!0,enumerable:!0,get:function(){return this._audioext.muted},set:function(a){this._audioext.muted=a}},volume:{configurable:!0,enumerable:!0,get:function(){return this._audioext.volume},set:function(a){this._audioext.volume=a}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.line=function(a,b){this.min=void 0===a?0:a;this.max=void 0===b?0:b};hamonengine.geometry.line.clone=function(a){return new hamonengine.geometry.line(a.min,a.max)};hamonengine.geometry.line.prototype.clone=function(){return hamonengine.geometry.line.clone(this)};hamonengine.geometry.line.prototype.toString=function(){return"{min: '"+this.min+"', max: '"+this.max+"'}"};hamonengine.geometry.line.prototype.mirror=function(){return new hamonengine.geometry.line(this.max,this.min)};
hamonengine.geometry.line.prototype.add=function(a){return new hamonengine.geometry.line(this.min+a.min,this.max+a.max)};hamonengine.geometry.line.prototype.subtract=function(a){return new hamonengine.geometry.line(this.min-a.min,this.max-a.max)};hamonengine.geometry.line.prototype.multiplyScalar=function(a){return new hamonengine.geometry.line(this.min*a,this.max*a)};hamonengine.geometry.line.prototype.overlap=function(a){var b=function(a,b){return a>=b.min&&a<=b.max},c=NaN;b(this.min,a)?c=this.min:
b(a.min,this)&&(c=a.min);var d=NaN;b(this.max,a)?d=this.max:b(a.max,this)&&(d=a.max);return new hamonengine.geometry.line(c,d)};hamonengine.geometry.line.prototype.contains=function(a){return a.min>=this.min&&a.max<=this.max};hamonengine.geometry.line.prototype.getOrientation=function(a){var b=this.midPoint;a=a.midPoint;return a===b?0:a<b?-1:1};hamonengine.geometry.line.prototype.getDistance=function(a){return Math.abs(this.midPoint-a.midPoint)};$jscomp.global.Object.defineProperties(hamonengine.geometry.line.prototype,
{length:{configurable:!0,enumerable:!0,get:function(){return Math.abs(this.max-this.min)}},isLine:{configurable:!0,enumerable:!0,get:function(){return!isNaN(this.min)&&!isNaN(this.max)}},midPoint:{configurable:!0,enumerable:!0,get:function(){return(this.max-this.min)/2}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.polygon=function(a){a=void 0===a?{}:a;a instanceof hamonengine.geometry.polygon&&(a={vertices:a.vertices});this._vertices=a.vertices||[];this._edges=[];this._normals=[];this._dimensions={center:null,max:null,min:null,minVertex:null,maxVertex:null};this._dirty=15;this._shapeType=SHAPE_TYPE.UNKNOWN};hamonengine.geometry.polygon.prototype.clone=function(){return new hamonengine.geometry.polygon(this)};hamonengine.geometry.polygon.prototype.toString=function(){for(var a=
"",b=0;b<this._vertices.length;b++)a+=""+(""!==a?",":"")+this._vertices[b].toString();return"["+a+"]"};hamonengine.geometry.polygon.prototype.toRect=function(){return new hamonengine.geometry.rect(this.min.x,this.min.y,this.max.x-this.min.x,this.max.y-this.min.y)};hamonengine.geometry.polygon.prototype.addVertex=function(a,b){this._vertices.push(new hamonengine.geometry.vector2(a,b));this._dirty=15};hamonengine.geometry.polygon.prototype.translate=function(a){a=a||new hamonengine.geometry.vector2(0,
0);for(var b=[],c=0;c<this.vertices.length;c++)b.push(this.vertices[c].add(a));return new hamonengine.geometry.polygon({vertices:b})};hamonengine.geometry.polygon.prototype.rotate=function(a,b){var c=Math.sin(a);a=Math.cos(a);b=b||new hamonengine.geometry.vector2(0,0);for(var d=[],e=0;e<this.vertices.length;e++){var f=this.vertices[e].x-b.x,h=this.vertices[e].y-b.y;if(hamonengine.geometry.settings.coordinateSystem===COORDINATE_SYSTEM.RHS){var g=f*a-h*c;f=f*c+h*a}else g=f*a+h*c,f=-(f*c)+h*a;d.push(new hamonengine.geometry.vector2(g+
b.x,f+b.y))}return new hamonengine.geometry.polygon({vertices:d})};hamonengine.geometry.polygon.prototype.rotateAtCenter=function(a){return this.rotate(a,this.center)};hamonengine.geometry.polygon.prototype.scale=function(a){a=a||new hamonengine.geometry.vector2(0,0);for(var b=[],c=0;c<this.vertices.length;c++)b.push(this.vertices[c].multiplyVector(a));return new hamonengine.geometry.polygon({vertices:b})};hamonengine.geometry.polygon.prototype.isCollision=function(a){return a instanceof hamonengine.geometry.rect?
this.isCollisionRect(a):a instanceof hamonengine.geometry.polygon?this.isCollisionPolygon(a):new hamonengine.geometry.vector2(0,0)};hamonengine.geometry.polygon.prototype.isCollisionPolygon=function(a){if(!(a instanceof hamonengine.geometry.polygon))throw"Parameter polygon is not of type hamonengine.geometry.polygon.";for(var b=NaN,c,d=a.normals,e=0;e<d.length;e++){var f=this.project(d[e]),h=a.project(d[e]),g=f.overlap(h);if(!g.isLine)return new hamonengine.geometry.vector2;g=g.length;if(f.contains(h)||
h.contains(f)){var k=Math.abs(f.min-h.min),l=Math.abs(f.max-h.max);g+=k<l?k:l}if(isNaN(b)||g<b)b=g,c=d[e],h.getOrientation(f)}d=this.normals;for(e=0;e<d.length;e++){f=this.project(d[e]);h=a.project(d[e]);g=f.overlap(h);if(!g.isLine)return new hamonengine.geometry.vector2;g=g.length;if(f.contains(h)||h.contains(f))k=Math.abs(f.min-h.min),l=Math.abs(f.max-h.max),g+=k<l?k:l;if(isNaN(b)||g<b)b=g,c=d[e],h.getOrientation(f)}b=b<hamonengine.geometry.settings.collisionDetection.floor?0:b;return c.multiply(b)};
hamonengine.geometry.polygon.prototype.isCollisionRect=function(a){return a.toPolygon().isCollisionPolygon(this)};hamonengine.geometry.polygon.prototype.isContained=function(a){return new hamonengine.geometry.vector2};hamonengine.geometry.polygon.prototype.project=function(a){var b=0,c=0;if(0<this.vertices.length){c=b=a.dot(this.vertices[0]);for(var d=1;d<this.vertices.length;d++){var e=a.dot(this.vertices[d]);e<b?b=e:e>c&&(c=e)}}return new hamonengine.geometry.line(b,c)};hamonengine.geometry.polygon.calcEdges=
function(a){a=void 0===a?[]:a;for(var b=[],c=0;c<a.length;c++)b.push(a[(c+1)%a.length].subtract(a[c]));return b};hamonengine.geometry.polygon.calcNormals=function(a){a=void 0===a?[]:a;return a.map(function(a){return a.normal(ROTATION_TYPE.CW)})};hamonengine.geometry.polygon.calcDimensions=function(a){a=void 0===a?[]:a;for(var b=null,c=null,d=NaN,e=NaN,f=NaN,h=NaN,g=0;g<a.length;g++){d=d>a[g].x?d:a[g].x;e=e<a[g].x?e:a[g].x;f=f>a[g].y?f:a[g].y;h=h<a[g].y?h:a[g].y;if(null===b||b.x>a[g].x&&b.y>a[g].y)b=
a[g];if(null===c||c.x<a[g].x&&c.y<a[g].y)c=a[g]}return{max:new hamonengine.geometry.vector2(d,f),min:new hamonengine.geometry.vector2(e,h),center:new hamonengine.geometry.vector2(e+(d-e)/2,h+(f-h)/2),minVertex:b,maxVertex:c}};hamonengine.geometry.polygon.calcShapeType=function(a){a=void 0===a?[]:a;for(var b=0,c=0;c<a.length;c++){var d=a[(c+1)%a.length],e=a[(c+2)%a.length],f=d.subtract(a[c]);d=e.subtract(d);b+=0<d.cross(f).z?1:-1}return a.length===b?SHAPE_TYPE.CONVEX:SHAPE_TYPE.CONCAVE};$jscomp.global.Object.defineProperties(hamonengine.geometry.polygon.prototype,
{vertices:{configurable:!0,enumerable:!0,get:function(){return this._vertices}},edges:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,2)&&(this._edges=hamonengine.geometry.polygon.calcEdges(this.vertices),bitflag.toggle(this._dirty,2,!1));return this._edges}},normals:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,0)&&(this._normals=hamonengine.geometry.polygon.calcNormals(this.edges),bitflag.toggle(this._dirty,0,!1));return this._normals}},center:{configurable:!0,
enumerable:!0,get:function(){bitflag.isSet(this._dirty,1)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),bitflag.toggle(this._dirty,1,!1));return this._dimensions.center}},max:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,1)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),bitflag.toggle(this._dirty,1,!1));return this._dimensions.max}},min:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,1)&&
(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),bitflag.toggle(this._dirty,1,!1));return this._dimensions.min}},minVertex:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,1)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),bitflag.toggle(this._dirty,1,!1));return this._dimensions.minVertex}},maxVertex:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,1)&&(this._dimensions=hamonengine.geometry.polygon.calcDimensions(this.vertices),
bitflag.toggle(this._dirty,1,!1));return this._dimensions.maxVertex}},width:{configurable:!0,enumerable:!0,get:function(){return this.max.x-this.min.x}},height:{configurable:!0,enumerable:!0,get:function(){return this.max.y-this.min.y}},shapeType:{configurable:!0,enumerable:!0,get:function(){bitflag.isSet(this._dirty,3)&&(this._shapeType=hamonengine.geometry.polygon.calcShapeType(this.vertices),bitflag.toggle(this._dirty,3,!1));return this._shapeType}}})})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.rect=function(a,b,c,d){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.width=void 0===c?0:c;this.height=void 0===d?0:d};hamonengine.geometry.rect.prototype.clone=function(){return new hamonengine.geometry.rect(this.x,this.y,this.width,this.height)};hamonengine.geometry.rect.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"};hamonengine.geometry.rect.prototype.toPolygon=function(){return new hamonengine.geometry.polygon({vertices:[new hamonengine.geometry.vector2(this.x,
this.y),new hamonengine.geometry.vector2(this.x+this.width,this.y),new hamonengine.geometry.vector2(this.x+this.width,this.y+this.height),new hamonengine.geometry.vector2(this.x,this.y+this.height)]})};hamonengine.geometry.rect.prototype.translate=function(a){a=a||new hamonengine.geometry.vector2(0,0);return new hamonengine.geometry.rect(this.x+a.x,this.y+a.y,this.width,this.height)};hamonengine.geometry.rect.prototype.isCollision=function(a){return a instanceof hamonengine.geometry.rect?this.isCollisionRect(a):
a instanceof hamonengine.geometry.polygon?this.isCollisionPolygon(a):a instanceof hamonengine.geometry.vector2?this.isCollisionPoint(a):new hamonengine.geometry.vector2(0,0)};hamonengine.geometry.rect.prototype.isCollisionRect=function(a){a instanceof hamonengine.geometry.rect||console.warn("[hamonengine.geometry.rect.isCollision] The otherRect parameter is not of type hamonengine.geometry.rect!");var b=NaN,c=new hamonengine.geometry.line(this.y,this.y+this.height),d=new hamonengine.geometry.line(a.y,
a.y+a.height),e=c.overlap(d);if(!e.isLine)return new hamonengine.geometry.vector2;e=e.length;if(c.contains(d)||d.contains(c)){var f=Math.abs(c.min-d.min);c=Math.abs(c.max-d.max);e+=f<c?f:c}if(isNaN(b)||e<b){b=e;var h=hamonengine.geometry.vector2.Y_AXIS_NORMAL}c=new hamonengine.geometry.line(this.x,this.x+this.width);a=new hamonengine.geometry.line(a.x,a.x+a.width);d=c.overlap(a);if(!d.isLine)return new hamonengine.geometry.vector2;d=d.length;if(c.contains(a)||a.contains(c))e=Math.abs(c.min-a.min),
a=Math.abs(c.max-a.max),d+=e<a?e:a;if(isNaN(b)||d<b)b=d,h=hamonengine.geometry.vector2.X_AXIS_NORMAL;b=b<hamonengine.geometry.settings.collisionDetection.floor?0:b;return h.multiply(b)};hamonengine.geometry.rect.prototype.isCollisionPolygon=function(a){return a.isCollision(this.toPolygon())};hamonengine.geometry.rect.prototype.isCollisionPoint=function(a){var b=new hamonengine.geometry.vector2;if(a.x>=this.x&&a.x<=this.right&&a.y>=this.y&&a.y<=this.bottom){var c=a.x-this.x,d=this.right-a.x;b.x=c<
d?c:d;c=a.y-this.y;a=this.bottom-a.y;b.y=c<a?c:a}return b};hamonengine.geometry.rect.prototype.isContained=function(a,b){b instanceof hamonengine.geometry.rect||console.warn("[hamonengine.geometry.rect.isContained] The rect parameter is not of type hamonengine.geometry.rect!");var c=new hamonengine.geometry.vector2,d=a.x+b.x,e=a.y+b.y;d<this.x?(console.debug("[hamonengine.geometry.rect.isContained] Outside -x: ("+d+", "+e+")"),c.x=-1):a.x+b.right>this.right&&(console.debug("[hamonengine.geometry.rect.isContained] Outside +x: ("+
d+", "+e+")"),c.x=1);e<this.y?(console.debug("[hamonengine.geometry.rect.isContained] Outside -y: ("+d+", "+e+")"),c.y=-1):a.y+b.bottom>this.bottom&&(console.debug("[hamonengine.geometry.rect.isContained] Outside +y: ("+d+", "+e+")"),c.y=1);return c};$jscomp.global.Object.defineProperties(hamonengine.geometry.rect.prototype,{right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height}}})})();var COORDINATE_SYSTEM={LHS:0,RHS:1},COLLISION_TYPES={NONE:0,EDGE:1,INSIDE:2},SHAPE_TYPE={UNKNOWN:0,CONVEX:1,CONCAVE:2},ROTATION_TYPE={CW:0,CCW:1};hamonengine.geometry=hamonengine.geometry||{};hamonengine.geometry.settings=hamonengine.geometry.settings||{collisionDetection:{floor:.01,limit:15},coordinateSystem:COORDINATE_SYSTEM.RHS};hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.vector2=function(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b};hamonengine.geometry.vector2.clone=function(a){return new hamonengine.geometry.vector2(a.x,a.y)};hamonengine.geometry.vector2.prototype.clone=function(){return hamonengine.geometry.vector2.clone(this)};hamonengine.geometry.vector2.prototype.toString=function(){return"{x: '"+this.x+"', y: '"+this.y+"'}"};hamonengine.geometry.vector2.prototype.normalize=function(){var a=this.length;return 0<a?new hamonengine.geometry.vector2(this.x/
a,this.y/a):new hamonengine.geometry.vector2};hamonengine.geometry.vector2.prototype.normal=function(a){a=void 0===a?ROTATION_TYPE.CCW:a;var b=this.length;return 0<b?a===ROTATION_TYPE.CCW?new hamonengine.geometry.vector2(-this.y/b,this.x/b):new hamonengine.geometry.vector2(this.y/b,-this.x/b):new hamonengine.geometry.vector2};hamonengine.geometry.vector2.prototype.mirror=function(){return new hamonengine.geometry.vector2(-this.x,this.y)};hamonengine.geometry.vector2.prototype.flip=function(){return new hamonengine.geometry.vector2(this.x,
-this.y)};hamonengine.geometry.vector2.prototype.invert=function(){return new hamonengine.geometry.vector2(-this.x,-this.y)};hamonengine.geometry.vector2.prototype.add=function(a){return new hamonengine.geometry.vector2(this.x+a.x,this.y+a.y)};hamonengine.geometry.vector2.prototype.subtract=function(a){return new hamonengine.geometry.vector2(this.x-a.x,this.y-a.y)};hamonengine.geometry.vector2.prototype.multiply=function(a){return a instanceof hamonengine.geometry.vector2?this.multiplyVector(a):this.multiplyScalar(a)};
hamonengine.geometry.vector2.prototype.multiplyScalar=function(a){return new hamonengine.geometry.vector2(this.x*a,this.y*a)};hamonengine.geometry.vector2.prototype.multiplyVector=function(a){return new hamonengine.geometry.vector2(this.x*a.x,this.y*a.y)};hamonengine.geometry.vector2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};hamonengine.geometry.vector2.prototype.cross=function(a){return new hamonengine.geometry.vector3(0,0,this.x*a.y-this.y*a.x)};hamonengine.geometry.vector2.prototype.equals=
function(a){return this.x===a.x&&this.y===a.y};$jscomp.global.Object.defineProperties(hamonengine.geometry.vector2.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},theta:{configurable:!0,enumerable:!0,get:function(){return(Math.atan2(this.y,this.x)+Math.PI2)%Math.PI2}}});hamonengine.geometry.vector2.X_AXIS_NORMAL=new hamonengine.geometry.vector2(1,0);hamonengine.geometry.vector2.Y_AXIS_NORMAL=new hamonengine.geometry.vector2(0,1)})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.vector3=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};hamonengine.geometry.vector3.clone=function(a){return new hamonengine.geometry.vector3(a.x,a.y,a.z)};hamonengine.geometry.vector3.prototype.clone=function(){return hamonengine.geometry.vector3.clone(this)};hamonengine.geometry.vector3.prototype.toString=function(){return"{x: '"+this.x+"', y: '"+this.y+"', z: '"+this.z+"'}"};hamonengine.geometry.vector3.prototype.normalize=function(){var a=
this.length;return 0<a?new hamonengine.geometry.vector3(this.x/a,this.y/a,this.z/a):new hamonengine.geometry.vector3};hamonengine.geometry.vector3.prototype.invert=function(){return new hamonengine.geometry.vector2(-this.x,-this.y,-this.z)};hamonengine.geometry.vector3.prototype.add=function(a){return new hamonengine.geometry.vector3(this.x+a.x,this.y+a.y,this.z+a.z)};hamonengine.geometry.vector3.prototype.subtract=function(a){return new hamonengine.geometry.vector3(this.x-a.x,this.y-a.y,this.z-a.z)};
hamonengine.geometry.vector3.prototype.multiplyScalar=function(a){return new hamonengine.geometry.vector3(this.x*a,this.y*a,this.z*a)};hamonengine.geometry.vector3.prototype.multiplyVector=function(a){return new hamonengine.geometry.vector3(this.x*a.x,this.y*a.y,this.z*a.z)};hamonengine.geometry.vector3.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};hamonengine.geometry.vector3.prototype.cross=function(a){return new hamonengine.geometry.vector3(this.y*a.z-this.z*a.y,a.x*this.z-
this.x*a.z,this.x*a.y-this.y*a.x)};hamonengine.geometry.vector3.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};$jscomp.global.Object.defineProperties(hamonengine.geometry.vector3.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}});hamonengine.geometry.vector3.X_AXIS_NORMAL=new hamonengine.geometry.vector3(1,0,0);hamonengine.geometry.vector3.Y_AXIS_NORMAL=new hamonengine.geometry.vector3(0,1,
0);hamonengine.geometry.vector3.Z_AXIS_NORMAL=new hamonengine.geometry.vector3(0,0,1)})();hamonengine.graphics=hamonengine.graphics||{};var BLENDING_OPS={REPLACE:0,ADD:1,MULTIPLY:2,OR:3,AND:4,XOR:5,DIFFERENCE:6},TEXT_DRAW_TYPE={STROKE:0,FILL:1};hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.imageext=function(a){a=void 0===a?{}:a;a instanceof hamonengine.graphics.imageext&&(a={image:a._image});this._image=a.image||new Image;this._state=0;this._backbufferCtx=this._backbufferResource=null;console.debug("[hamonengine.graphics.imageext.constructor] Starting State: {"+this._state+"}")};hamonengine.graphics.imageext.prototype.clone=function(){return new hamonengine.graphics.imageext(this)};hamonengine.graphics.imageext.prototype.load=function(a){a=void 0===
a?"":a;var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,e){for(;;)switch(d){case 0:return""!==a&&(b._image.src=a),b._state=1,d=-1,{value:new Promise(function(c,d){b.complete?(b._state=2,c()):(b.image.addEventListener("load",function(){b._state=2;console.debug("[hamonengine.graphics.imageext.load] Image '"+a+"' has loaded successfully.");c()},!1),b.image.addEventListener("error",function(a){b._state=3;d("The image '"+(a&&a.path&&0<a.path.length&&a.path[0].src||"")+"' could not be loaded.")},
!1))}),done:!0};default:return{value:void 0,done:!0}}}var d=0,e={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())};hamonengine.graphics.imageext.prototype.getImageData=function(a){this._backbufferResource=this._backbufferResource||hamonengine.graphics.layer.createNewCanvas(this.rawImage.width,this.rawImage.height);this._backbufferCtx=
this._backbufferCtx||this._backbufferResource.getContext("2d");this._backbufferCtx.drawImage(this.rawImage,0,0);a=a||new hamonengine.geometry.rect;return this._backbufferCtx.getImageData(a.x,a.y,a.width||this.rawImage.width,a.height||this.rawImage.height)};hamonengine.graphics.imageext.prototype.blendColorRegion=function(a,b,c,d,e,f){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?null:e;f=void 0===f?BLENDING_OPS.REPLACE:f;if(this.complete){var h=this.getImageData(e),
g=function(a,b){return 0<a?a:b};switch(f){case BLENDING_OPS.ADD:g=function(a,b){return 0<a?Math.min(a+b,255):b};break;case BLENDING_OPS.MULTIPLY:g=function(a,b){return 0<a?Math.min(a*b,255):b};break;case BLENDING_OPS.AND:g=function(a,b){return 0<a?Math.min(a&b,255):b};break;case BLENDING_OPS.OR:g=function(a,b){return 0<a?Math.min(a|b,255):b};break;case BLENDING_OPS.XOR:g=function(a,b){return 0<a?Math.min(a^b,255):b};break;case BLENDING_OPS.DIFFERENCE:g=function(a,b){return 0<a?Math.min(a-b,255):b}}f=
h.data;for(var k=0;k<f.length;k+=4)f[k]=g(a,f[k]),f[k+1]=g(b,f[k+1]),f[k+2]=g(c,f[k+2]),f[k+3]=g(d,f[k+3]);this._backbufferCtx.putImageData(h,e.x,e.y)}};hamonengine.graphics.imageext.prototype.adjustColorChannel=function(a,b,c,d,e){a=void 0===a?1:a;b=void 0===b?1:b;c=void 0===c?1:c;d=void 0===d?1:d;e=void 0===e?null:e;if(this.complete){for(var f=this.getImageData(e),h=f.data,g=0;g<h.length;g+=4)h[g]=Math.bitRound(h[g]*a),h[g+1]=Math.bitRound(h[g+1]*b),h[g+2]=Math.bitRound(h[g+2]*c),h[g+3]=Math.bitRound(h[g+
3]*d);this._backbufferCtx.putImageData(f,e.x,e.y,e.x,e.y,e.width,e.height)}};hamonengine.graphics.imageext.prototype.bitblit=function(a,b,c,d){if(this.complete&&a.complete){a instanceof hamonengine.graphics.imageext&&(a=a.rawImage);d=Math.max(Math.min(void 0===d?1:d,1),0);var e=this.getImageData(c),f=hamonengine.graphics.layer.createNewCanvas(a.width,a.height).getContext("2d");f.drawImage(a,0,0);f=f.getImageData(b.x,b.y,b.width,b.height);a=e.data;f=f.data;for(var h=0;h<c.height&&!(h>=b.height);h++)for(var g=
0;g<c.width&&!(g>=b.width);g++){var k=4*(h*c.width+g),l=4*(h*b.width+g),n=0<f[l+3]?1-d:1;a[k]=Math.bitRound(a[k]*n+f[l]*d);a[k+1]=Math.bitRound(a[k+1]*n+f[l+1]*d);a[k+2]=Math.bitRound(a[k+2]*n+f[l+2]*d)}this._backbufferCtx.putImageData(e,c.x,c.y)}};hamonengine.graphics.imageext.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?this.width:e;f=void 0===f?this.height:f;a.drawImage(this,c,d,this.width,this.height,destinationX,destinationY,e,f)};$jscomp.global.Object.defineProperties(hamonengine.graphics.imageext.prototype,
{src:{configurable:!0,enumerable:!0,get:function(){return this._image.src}},complete:{configurable:!0,enumerable:!0,get:function(){return this._image.complete}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return 2===this._state}},image:{configurable:!0,enumerable:!0,get:function(){return this._backbufferResource?this._backbufferResource:this._image}},rawImage:{configurable:!0,enumerable:!0,get:function(){return this._image}},width:{configurable:!0,enumerable:!0,get:function(){return this.image.width}},
height:{configurable:!0,enumerable:!0,get:function(){return this.image.height}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.layer=function(a){a=void 0===a?{}:a;this._canvasId=a.canvasId||"";this._name=a.name||"";this._alpha=void 0!==a.alpha?a.alpha:!1;this._backgroundColor=a.backgroundColor||"black";this._allowEventBinding=void 0!==a.allowEventBinding?a.allowEventBinding:!1;this._wrapVertical=void 0!==a.wrapVertical?a.wrapVertical:!1;this._wrapHorizontal=void 0!==a.wrapHorizontal?a.wrapHorizontal:!1;this._clipToViewPort=void 0!==a.clipToViewPort?a.clipToViewPort:!0;this._enableImageSmoothing=
void 0!==a.enableImageSmoothing?a.enableImageSmoothing:!0;this._invertYAxis=void 0!==a.invertYAxis?a.invertYAxis:!1;this._invertXAxis=void 0!==a.invertXAxis?a.invertXAxis:!1;var b=a.canvas;if(!this._canvasId&&!b)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvasId '"+this._canvasId+"' or canvas. Unable to create the layer!"),"Cannot create the layer";b?(this._canvas=b,this._canvasId=b.id,this._name=a.name||b.getAttribute("name")):this._canvas=document.getElementById(this._canvasId);
if(!this._canvas)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvas: '"+this._canvasId+"' unable to create the layer!"),"Cannot create the layer";try{this._alpha?this._canvasContext=this._canvas.getContext("2d",{alpha:this._alpha}):(this._workAround=!0,this._canvasContext=this._canvas.getContext("2d"))}catch(c){}this.enableImageSmoothing(a.enableImageSmoothing);if(!this._canvasContext)throw console.error("[hamonengine.graphics.layer.constructor] Unable to get the 2d context: '"+
this._canvasId+"' unable to create the layer!"),"Cannot create the layer";this._viewPort=a.viewPort||new hamonengine.geometry.rect(0,0,this._canvas.width,this._canvas.height);this._wasReset=!1;this._allowSaveStateEnabled=!0;this._viewPortBorderColor="";console.debug("[hamonengine.graphics.layer.constructor] Canvas Id: "+this._canvasId);console.debug("[hamonengine.graphics.layer.constructor] Name: "+this._name);console.debug("[hamonengine.graphics.layer.constructor] Alpha: "+this._alpha);console.debug("[hamonengine.graphics.layer.constructor] AllowEventBinding: "+
this._allowEventBinding);console.debug("[hamonengine.graphics.layer.constructor] WrapVertical: "+this._wrapVertical);console.debug("[hamonengine.graphics.layer.constructor] WrapHorizontal: "+this._wrapHorizontal);console.debug("[hamonengine.graphics.layer.constructor] ClipToViewPort: "+this._clipToViewPort)};hamonengine.graphics.layer.createNewCanvas=function(a,b,c,d){c=void 0===c?"":c;d=void 0===d?"":d;var e=document.createElement("canvas");e.setAttribute("width",a);e.setAttribute("height",b);c&&
e.setAttribute("id",c);d&&e.setAttribute("name",d);return e};hamonengine.graphics.layer.prototype.clone=function(a,b,c){c=void 0===c?null:c;var d=hamonengine.graphics.layer.createNewCanvas(this.width,this.height,a,b);c&&c.insertBefore(d,null);a=new hamonengine.graphics.layer({canvasId:a,name:b,canvas:d,alpha:this.alpha,allowEventBinding:this.allowEventBinding,wrapVertical:this.wrapVertical,wrapHorizontal:this.wrapHorizontal,clipToViewPort:this.clipToViewPort,enableImageSmoothing:this._enableImageSmoothing,
invertYAxis:this.invertYAxis,invertXAxis:this.invertXAxis,viewPort:this.viewPort});a._allowSaveStateEnabled=this._allowSaveStateEnabled;a._viewPortBorderColor=this._viewPortBorderColor;return a};hamonengine.graphics.layer.prototype.enableImageSmoothing=function(a){a=void 0===a?!0:a;console.debug("[hamonengine.graphics.layer.constructor] EnableImageSmoothing: "+a);this._enableImageSmoothing=a;try{this.context.webkitImageSmoothingEnabled=a,this.context.mozImageSmoothingEnabled=a,this.context.imageSmoothingEnabled=
a}catch(b){}};hamonengine.graphics.layer.prototype.clear=function(a,b,c,d){a=void 0===a?this.viewPort.x:a;b=void 0===b?this.viewPort.y:b;c=void 0===c?this.viewPort.width:c;d=void 0===d?this.viewPort.height:d;this._wasReset=!1;this.context.clearRect(a,b,c,d);if(this._workAround){var e=this.context.fillStyle;this.context.fillStyle=this._backgroundColor;this.context.fillRect(a,b,c,d);this.context.fillStyle=e}};hamonengine.graphics.layer.prototype.reset=function(){this._wasReset||(this.context.resetTransform(),
this._wasReset=!0)};hamonengine.graphics.layer.prototype.save=function(){this.allowSaveState&&this.context.save()};hamonengine.graphics.layer.prototype.restore=function(){this.allowSaveState&&this.context.restore()};hamonengine.graphics.layer.prototype.fillLayerImage=function(a,b,c){b=void 0===b?this.viewPort.x:b;c=void 0===c?this.viewPort.y:c;this.context.drawImage(a,b,c,this.viewPort.width,this.viewPort.height)};hamonengine.graphics.layer.prototype.beginPainting=function(){this.clear();this.borderColor&&
(this.context.strokeStyle=this.borderColor,this.context.strokeRect(this.viewPort.x,this.viewPort.y,this.viewPort.width,this.viewPort.height));!this.clipToViewPort||0===this.viewPort.x&&0===this.viewPort.y&&this.viewPort.width===this.width&&this.viewPort.height===this.height||(this.context.beginPath(),this.context.rect(this.viewPort.x,this.viewPort.y,this.viewPort.width,this.viewPort.height),this.context.clip())};hamonengine.graphics.layer.prototype.endPainting=function(){this.reset()};hamonengine.graphics.layer.prototype.drawLayer=
function(a,b,c,d,e){d=void 0===d?this.width:d;e=void 0===e?this.height:e;if(!(a instanceof hamonengine.graphics.layer))throw"Parameter layer is not of type hamonengine.graphics.layer.";this.context.drawImage(a.canvas,void 0===b?0:b,void 0===c?0:c,d,e)};hamonengine.graphics.layer.prototype.drawText=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.color?"white":e.color;var f=void 0===e.textDrawType?TEXT_DRAW_TYPE.FILL:e.textDrawType,h=void 0===e.textOffset?"left":
e.textOffset;this.context.font=void 0===e.font?"16px serif":e.font;this.context.textBaseline="top";switch(h){case "center":e=this.context.measureText(a);b-=e.width/2;break;case "left":break;case "right":e=this.context.measureText(a);b-=e.width;break;default:b-=parseInt(h)}f===TEXT_DRAW_TYPE.STROKE?(this.context.strokeStyle=d,this.context.strokeText(a,b,c)):(this.context.fillStyle=d,this.context.fillText(a,b,c))};hamonengine.graphics.layer.prototype.drawImage=function(a,b,c,d,e,f,h,g,k){a.complete&&
this.context.drawImage(a instanceof hamonengine.graphics.imageext?a.image:a,b,c,d,e,f,h,g,k)};hamonengine.graphics.layer.prototype.drawVector=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;e=void 0===e.color?"white":e.color;if(!(a instanceof hamonengine.geometry.vector2||a instanceof hamonengine.geometry.vector3))throw"Parameter polygon is not of type hamonengine.geometry.vector2 or of type hamonengine.geometry.vector3.";this.context.lineWidth=
d;this.context.strokeStyle=e;this.context.beginPath();this.context.moveTo(b,c);this.context.lineTo(b+a.x,c+a.y);this.context.stroke()};hamonengine.graphics.layer.prototype.drawRect=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.color?"white":e.color,h=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;this.simpleDrawRect(a,b,c,{lineWidth:d,color:f,fill:h,fillColor:e});if(this.wrapHorizontal){var g=b+
a.x-this.viewPort.x;0>=g&&this.simpleDrawRect(a,this.viewPort.width+g,c,{lineWidth:d,color:f,fill:h,fillColor:e});b+a.width>=this.viewPort.width&&this.simpleDrawRect(a,this.viewPort.x-(this.viewPort.width-(b+a.x)),c,{lineWidth:d,color:f,fill:h,fillColor:e})}this.wrapVertical&&(g=c+a.y-this.viewPort.y,0>=g&&this.simpleDrawRect(a,b,this.viewPort.height+g,{lineWidth:d,color:f,fill:h,fillColor:e}),c+a.height>=this.viewPort.height&&this.simpleDrawRect(a,b,this.viewPort.y-(this.viewPort.height-(c+a.y)),
{lineWidth:d,color:f,fill:h,fillColor:e}))};hamonengine.graphics.layer.prototype.simpleDrawRect=function(a,b,c,d){var e=void 0===d?{}:d,f=void 0===e.lineWidth?1:e.lineWidth,h=void 0===e.color?"white":e.color;d=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;if(!(a instanceof hamonengine.geometry.rect))throw"Parameter rect is not of type hamonengine.geometry.rect.";this.context.lineWidth=f;this.context.strokeStyle=h;this.context.fillStyle=e;b=a.x+(void 0===b?0:b);c=a.y+(void 0===
c?0:c);this.invertYAxis&&(c=this.viewPort.height-c);this.invertXAxis&&(b=this.viewPort.width-b);this.context.beginPath();this.context.moveTo(b,c);this.context.strokeRect(b,c,a.width,a.height);this.context.closePath();d&&this.context.fillRect(b,c,a.width,a.height);this.context.stroke()};hamonengine.graphics.layer.prototype.drawPolygon=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d;d=void 0===e.lineWidth?1:e.lineWidth;var f=void 0===e.color?"white":e.color,h=void 0===e.drawNormals?
!1:e.drawNormals,g=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;this.simpleDrawPolygon(a,b,c,{lineWidth:d,color:f,drawNormals:h,fill:g,fillColor:e});if(this.wrapHorizontal){var k=b+a.min.x-this.viewPort.x;0>=k&&this.simpleDrawPolygon(a,this.viewPort.width+k,c,{lineWidth:d,color:f,drawNormals:h,fill:g,fillColor:e});b+a.width>=this.viewPort.width&&this.simpleDrawPolygon(a,this.viewPort.x-(this.viewPort.width-(b+a.min.x)),c,{lineWidth:d,color:f,drawNormals:h,fill:g,fillColor:e})}this.wrapVertical&&
(k=c+a.min.y-this.viewPort.y,0>=k&&this.simpleDrawPolygon(a,b,this.viewPort.height+k,{lineWidth:d,color:f,drawNormals:h,fill:g,fillColor:e}),c+a.height>=this.viewPort.height&&this.simpleDrawPolygon(a,b,this.viewPort.y-(this.viewPort.height-(c+a.min.y)),{lineWidth:d,color:f,drawNormals:h,fill:g,fillColor:e}))};hamonengine.graphics.layer.prototype.simpleDrawPolygon=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;var e=void 0===d?{}:d,f=void 0===e.lineWidth?1:e.lineWidth,h=void 0===e.color?"white":
e.color;d=void 0===e.drawNormals?!1:e.drawNormals;var g=void 0===e.fill?!1:e.fill;e=void 0===e.fillColor?"white":e.fillColor;if(!(a instanceof hamonengine.geometry.polygon))throw"Parameter polygon is not of type hamonengine.geometry.polygon.";this.context.lineWidth=f;this.context.strokeStyle=h;this.context.fillStyle=e;this.context.beginPath();for(f=0;f<a.vertices.length;f++)h=Math.bitRound(b+a.vertices[f].x),e=Math.bitRound(c+a.vertices[f].y),this.invertYAxis&&(e=this.viewPort.height-e),this.invertXAxis&&
(h=this.viewPort.width-h),0===f?this.context.moveTo(h,e):this.context.lineTo(h,e);this.context.closePath();g&&this.context.fill();this.context.stroke();if(hamonengine.debug&&d)for(this.context.strokeStyle="white",d=0;d<a.vertices.length;d++)h=a.vertices[d],f=a.edges[d],g=Math.bitRound(b+h.x+f.x/2),h=Math.bitRound(c+h.y+f.y/2),this.invertYAxis&&(h=this.viewPort.height-h),this.invertXAxis&&(g=this.viewPort.width-g),this.context.beginPath(),this.context.moveTo(g,h),e=a.normals[d],f=Math.bitRound(f.length/
2),this.invertYAxis&&(e.y=-e.y),this.invertXAxis&&(e.x=-e.x),this.context.lineTo(g+e.x*f,h+e.y*f),this.context.stroke()};$jscomp.global.Object.defineProperties(hamonengine.graphics.layer.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},allowEventBinding:{configurable:!0,enumerable:!0,get:function(){return this._allowEventBinding}},context:{configurable:!0,enumerable:!0,get:function(){return this._canvasContext}},canvas:{configurable:!0,enumerable:!0,get:function(){return this._canvas}},
clipToViewPort:{configurable:!0,enumerable:!0,get:function(){return this._clipToViewPort}},width:{configurable:!0,enumerable:!0,get:function(){return this._canvas.width}},height:{configurable:!0,enumerable:!0,get:function(){return this._canvas.height}},offsetX:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetLeft}},offsetY:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetTop}},position:{configurable:!0,enumerable:!0,get:function(){var a=this.canvas.getBoundingClientRect()||
{left:0,top:0};return new hamonengine.geometry.vector2(a.left,a.top)}},viewPort:{configurable:!0,enumerable:!0,get:function(){return this._viewPort}},wrapHorizontal:{configurable:!0,enumerable:!0,get:function(){return this._wrapHorizontal},set:function(a){this._wrapHorizontal=a}},wrapVertical:{configurable:!0,enumerable:!0,get:function(){return this._wrapVertical},set:function(a){this._wrapVertical=a}},allowSaveState:{configurable:!0,enumerable:!0,get:function(){return this._allowSaveStateEnabled},
set:function(a){this._allowSaveStateEnabled=a}},borderColor:{configurable:!0,enumerable:!0,get:function(){return this._viewPortBorderColor},set:function(a){this._viewPortBorderColor=a}},invertYAxis:{configurable:!0,enumerable:!0,get:function(){return this._invertYAxis},set:function(a){this._invertYAxis=a}},invertXAxis:{configurable:!0,enumerable:!0,get:function(){return this._invertXAxis},set:function(a){this._invertXAxis=a}},alpha:{configurable:!0,enumerable:!0,get:function(){return this.context.globalAlpha},
set:function(a){this.context.globalAlpha=a}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.sprite=function(a){a=void 0===a?{}:a;a instanceof hamonengine.graphics.sprite&&(a={image:a._image&&a._image.clone(),dimensions:a._dimensions,theta:a.theta});this._name=a.name;this._image=a.image||new hamonengine.graphics.imageext;this._url=a.url||"";this._dimensions=a.dimensions?a.dimensions:this._image instanceof HTMLImageElement?new hamonengine.geometry.rect(0,0,this._image.width,this._image.height):new hamonengine.geometry.rect;this._theta=a.theta||0;this._scaleVector=
new hamonengine.geometry.vector2(1,1);this._spriteOrientation=0;this._showFullImage=this._showDiagnosisLines=!1;this._maxWrapping=0;console.debug("[hamonengine.graphics.sprite.constructor] Starting Dimensions: {"+this._dimensions.toString()+"}");console.debug("[hamonengine.graphics.sprite.constructor] Name: "+this._name);console.debug("[hamonengine.graphics.sprite.constructor] Theta: "+this._theta);console.debug("[hamonengine.graphics.sprite.constructor] ScaleVector: {"+this._scaleVector.toString()+
"}")};hamonengine.graphics.sprite.prototype.copyProperties=function(a){this._theta=a.theta;this._scaleVector=a._scaleVector;this._spriteOrientation=a._spriteOrientation;this._showDiagnosisLines=a._showDiagnosisLines;this._showFullImage=a._showFullImage};hamonengine.graphics.sprite.prototype.clone=function(){return new hamonengine.graphics.sprite(this)};hamonengine.graphics.sprite.prototype.load=function(a){a=void 0===a?"":a;var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,e){for(;;)switch(d){case 0:return a=
a||b._url,d=-1,{value:new Promise(function(c,d){b._image instanceof hamonengine.graphics.imageext?b._image.load(a).then(function(){b._dimensions=new hamonengine.geometry.rect(0,0,b._image.width,b._image.height);c(b)}).catch(function(a){d(a)}):c(b)}),done:!0};default:return{value:void 0,done:!0}}}var d=0,e={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};
return e}())};hamonengine.graphics.sprite.prototype.rotate=function(a){this._theta=a||0;return this};hamonengine.graphics.sprite.prototype.scale=function(a,b){this._scaleVector.x=a;this._scaleVector.y=b;return this};hamonengine.graphics.sprite.prototype.mirror=function(a){this._spriteOrientation=bitflag.toggle(this._spriteOrientation,2,a);return this};hamonengine.graphics.sprite.prototype.flip=function(a){this._spriteOrientation=bitflag.toggle(this._spriteOrientation,1,a);return this};hamonengine.graphics.sprite.prototype.blendColor=
function(a,b,c,d,e){e=void 0===e?BLENDING_OPS.REPLACE:e;this._image.blendColorRegion(void 0===a?0:a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d,this._dimensions,e);return this};hamonengine.graphics.sprite.prototype.adjustColorChannel=function(a,b,c,d){this._image.adjustColorChannel(void 0===a?1:a,void 0===b?1:b,void 0===c?1:c,void 0===d?1:d,this._dimensions);return this};hamonengine.graphics.sprite.prototype.bitblit=function(a,b){this._image.bitblit(a._image,a._dimensions,this._dimensions,void 0===
b?1:b);return this};hamonengine.graphics.sprite.prototype.drawRaw=function(a,b,c,d,e,f){e=void 0===e?this._dimensions.width:e;f=void 0===f?this._dimensions.height:f;this._image.complete&&(this.showFullImage?a.context.drawImage(this._image.image,Math.bitRound(c),Math.bitRound(d),Math.bitRound(e),Math.bitRound(f)):a.drawImage(this._image,this._dimensions.x,this._dimensions.y,this._dimensions.width,this._dimensions.height,Math.bitRound(c),Math.bitRound(d),Math.bitRound(e),Math.bitRound(f)))};hamonengine.graphics.sprite.prototype.draw=
function(a,b,c,d,e,f){e=void 0===e?this._dimensions.width:e;f=void 0===f?this._dimensions.height:f;c=Math.bitRound(c);d=Math.bitRound(d);var h=Math.bitRound(e/2)+c,g=Math.bitRound(f/2)+d,k=bitflag.isSet(this._spriteOrientation,1)?-1:1,l=bitflag.isSet(this._spriteOrientation,2)?-1:1;a.save();if(1!==this._scaleVector.x||1!==this._scaleVector.y)a.context.translate(c,d),a.context.scale(this._scaleVector.x,this._scaleVector.y),a.context.translate(-c,-d);0<this._spriteOrientation&&(a.context.translate(h,
g),a.context.scale(l,k),a.context.translate(-h,-g));0!==this.theta&&(a.context.translate(h,g),a.context.rotate(this.theta),a.context.translate(-h,-g));(a.wrapHorizontal||a.wrapVertical)&&this.drawSpriteWrapping(a,b,c,d,e,f,l,k);this.drawRaw(a,b,c,d,e,f);if(hamonengine.debug&&this.showDiagnosisLines){h=Math.bitRound(e/2)+c;g=Math.bitRound(f/2)+d;if(a.wrapHorizontal||a.wrapVertical)a.context.strokeStyle="red",a.context.lineWidth=2,a.context.beginPath(),a.context.moveTo(h,g),a.context.lineTo(h+a.viewPort.width,
g),a.context.stroke(),a.context.beginPath(),a.context.moveTo(h,g),a.context.lineTo(h-a.viewPort.width,g),a.context.stroke(),a.context.beginPath(),a.context.moveTo(h,g),a.context.lineTo(h,g+a.viewPort.height),a.context.stroke(),a.context.beginPath(),a.context.moveTo(h,g),a.context.lineTo(h,g-a.viewPort.height),a.context.stroke(),this.drawRaw(a,b,c+a.viewPort.width,d,e,f),this.drawRaw(a,b,c-a.viewPort.width,d,e,f),this.drawRaw(a,b,c,d+a.viewPort.height,e,f),this.drawRaw(a,b,c,d-a.viewPort.height,e,
f),a.context.strokeStyle="white",a.context.strokeRect(h-a.viewPort.width/2,g-a.viewPort.height/2,a.viewPort.width,a.viewPort.height);a.context.strokeStyle="red";a.context.strokeRect(c,d,e,f);a.context.strokeStyle="cyan";a.context.strokeRect(a.viewPort.x,a.viewPort.y,a.viewPort.width,a.viewPort.height)}a.restore()};hamonengine.graphics.sprite.prototype.drawSpriteWrapping=function(a,b,c,d,e,f,h,g){var k=Math.cos(-this.theta),l=Math.sin(-this.theta),n=e*this._scaleVector.x,t=f*this._scaleVector.y,m=
new hamonengine.geometry.vector2;if(a.wrapHorizontal){var q=a.viewPort.width/this._scaleVector.x*h;var r=Math.bitRound(k*q);q=Math.bitRound(l*q);if(c-n<=a.viewPort.x){if(m.x=1,n=Math.abs(parseInt((c-n)/a.viewPort.width,10))+1,0===this._maxWrapping||n<this._maxWrapping)this.drawRaw(a,b,c+r*n,d+q*n,e,f),0<--n&&this.drawRaw(a,b,c+r*n,d+q*n,e,f)}else c+n>=a.viewPort.width&&(m.x=-1,n=parseInt((c+n)/a.viewPort.width,10),0===this._maxWrapping||n<this._maxWrapping)&&(this.drawRaw(a,b,c-r*n,d-q*n,e,f),0<--n&&
this.drawRaw(a,b,c-r*n,d-q*n,e,f))}if(a.wrapVertical){var p=a.viewPort.height/this._scaleVector.y*g;var u=Math.bitRound(l*p);p=Math.bitRound(k*p);if(d-t<=a.viewPort.y){if(m.y=1,k=Math.abs(parseInt((d-t)/a.viewPort.height,10))+1,0===this._maxWrapping||k<this._maxWrapping)this.drawRaw(a,b,c-u*k,d+p*k,e,f),0<--k&&this.drawRaw(a,b,c-u*k,d+p*k,e,f)}else d+t>=a.viewPort.height&&(m.y=-1,k=parseInt((d+t)/a.viewPort.height,10),0===this._maxWrapping||k<this._maxWrapping)&&(this.drawRaw(a,b,c+u*k,d-p*k,e,f),
0<--k&&this.drawRaw(a,b,c+u*k,d-p*k,e,f))}a.wrapVertical&&a.wrapHorizontal&&(c=c-m.y*u+m.x*r,d=d+m.y*p+m.x*q,c&&d&&this.drawRaw(a,b,c,d,e,f))};$jscomp.global.Object.defineProperties(hamonengine.graphics.sprite.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},height:{configurable:!0,enumerable:!0,get:function(){return this._dimensions.height}},width:{configurable:!0,enumerable:!0,get:function(){return this._dimensions.width}},theta:{configurable:!0,
enumerable:!0,get:function(){return this._theta}},showDiagnosisLines:{configurable:!0,enumerable:!0,get:function(){return this._showDiagnosisLines},set:function(a){this._showDiagnosisLines=a}},showFullImage:{configurable:!0,enumerable:!0,get:function(){return this._showFullImage},set:function(a){this._showFullImage=a}},maxWrapping:{configurable:!0,enumerable:!0,set:function(a){this._maxWrapping=a}},image:{configurable:!0,enumerable:!0,get:function(){return this._image}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.animsprite=function(a){a=void 0===a?{}:a;hamonengine.graphics.sprite.call(this,a);a instanceof hamonengine.graphics.animsprite&&(a={frames:a._frames.map(function(a){return a.clone()}),animationRate:a._animationRate,animationCycles:a._animationCycles});this._frames=a.frames||[];this._animationRate=a.animationRate||0;this._animationCycles=a.animationCycles||-1;this._numberOfAnimationCycles=this._timeSinceLastFrame=this._index=0;this._enableAnimation=!0;console.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Rate: "+
this._animationRate);console.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Cycle: "+this._animationCycles);console.debug("[hamonengine.graphics.animsprite.constructor] Starting Index: "+this._index);console.debug("[hamonengine.graphics.animsprite.constructor] Starting Enable Animation: "+this._enableAnimation)};$jscomp.inherits(hamonengine.graphics.animsprite,hamonengine.graphics.sprite);hamonengine.graphics.animsprite.prototype.clone=function(){return new hamonengine.graphics.animsprite(this)};
hamonengine.graphics.animsprite.prototype.start=function(){this._enableAnimation=!0;this._numberOfAnimationCycles=0};hamonengine.graphics.animsprite.prototype.stop=function(){this._enableAnimation=!1};hamonengine.graphics.animsprite.prototype.pause=function(){this._enableAnimation=!this._enableAnimation};hamonengine.graphics.animsprite.prototype.next=function(){this.index++};hamonengine.graphics.animsprite.prototype.prev=function(){var a=this.index-1;this.index=0>a?this._frames.length+a:a};hamonengine.graphics.animsprite.prototype.addFrame=
function(a){console.debug("[hamonengine.graphics.animsprite.animsprite.addFrame]");this._frames.push(a)};hamonengine.graphics.animsprite.prototype.blendColor=function(a,b,c,d,e){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;e=void 0===e?BLENDING_OPS.REPLACE:e;for(var f=0;f<this._frames.length;f++)this._frames[f].blendColor(a,b,c,d,e)};hamonengine.graphics.animsprite.prototype.adjustColorChannel=function(a,b,c,d){a=void 0===a?1:a;b=void 0===b?1:b;c=void 0===c?1:c;d=void 0===d?
1:d;for(var e=0;e<this._frames.length;e++)this._frames[e].adjustColorChannel(a,b,c,d)};hamonengine.graphics.animsprite.prototype.draw=function(a,b,c,d,e,f){e=void 0===e?null:e;f=void 0===f?null:f;var h=this._timeSinceLastFrame+b;if(this._enableAnimation){var g=parseInt(h/this.animationRate,10);g=this.index+g;-1<this.animationCycles&&(this._numberOfAnimationCycles+=parseInt(g/this._frames.length,10),this._enableAnimation=this._numberOfAnimationCycles<=this.animationCycles);this.index=g}0<this._frames.length&&
(g=this._frames[this.index],g.copyProperties(this),g.draw(a,b,c,d,e||g.width,f||g.height));this._timeSinceLastFrame=h%this.animationRate};$jscomp.global.Object.defineProperties(hamonengine.graphics.animsprite.prototype,{index:{configurable:!0,enumerable:!0,get:function(){return this._index},set:function(a){this._index=a%this._frames.length||0}},animationRate:{configurable:!0,enumerable:!0,get:function(){return this._animationRate},set:function(a){this._animationRate=0<a?a:1}},animationCycles:{configurable:!0,
enumerable:!0,get:function(){return this._animationCycles},set:function(a){this._animationCycles=a;this._enableAnimation=!0}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.spritesheet=function(a){a=void 0===a?{}:a;this._imageResource=new hamonengine.graphics.imageext;this._sprites={};this._spriteIndex=[];this._url=a.url||"";this._name=a.name||"";console.debug("[hamonengine.audio.album.constructor] Name: '"+this._name+"'");console.debug("[hamonengine.graphics.spritesheet.constructor] Url: '"+this._url+"''")};hamonengine.graphics.spritesheet.prototype.load=function(a){a=void 0===a?"":a;var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,
g){for(;;)switch(d){case 0:a=a||b._url;if("string"!==typeof a){d=1;break}d=2;return{value:connect.get(a),done:!1};case 2:if(void 0===g){d=3;break}d=-1;throw g;case 3:f=h=c,a=JSON.parse(f.data);case 1:b._name=b._name||a.name;e=b._imageResource.load(a.spritesheetUrl);if(a.sprites)for(c=0;c<a.sprites.length;c++){g=a.sprites[c];var k=g.name.toLowerCase();b._spriteIndex.push(k);b._sprites[k]=new hamonengine.graphics.sprite({image:b._imageResource,name:g.name,dimensions:new hamonengine.geometry.rect(g.x,
g.y,g.width,g.height)})}if(a.animSprites)for(c=0;c<a.animSprites.length;c++){k=a.animSprites[c];g=new hamonengine.graphics.animsprite({animationRate:k.animationRate});for(var l=0;l<k.frames.length;l++){var m=k.frames[l];g.addFrame(new hamonengine.graphics.sprite({image:b._imageResource,name:m.name,dimensions:new hamonengine.geometry.rect(m.x,m.y,m.width,m.height)}))}k=k.name.toLowerCase();b._spriteIndex.push(k);b._sprites[k]=g}d=-1;return{value:e,done:!0};default:return{value:void 0,done:!0}}}var d=
0,e,f,h,g={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())};hamonengine.graphics.spritesheet.prototype.getSprite=function(a){return this._sprites[a.toLowerCase()].clone()};hamonengine.graphics.spritesheet.prototype.getSpriteByOrdinal=function(a){return this._sprites[this._spriteIndex[a]].clone()};$jscomp.global.Object.defineProperties(hamonengine.graphics.spritesheet.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},length:{configurable:!0,enumerable:!0,get:function(){return this._spriteIndex.length}},isLoaded:{configurable:!0,enumerable:!0,get:function(){return this._imageResource.isLoaded()}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.object2d=function(a){a=void 0===a?{}:a;this._name=a.name||"";this._boundingShape=a.boundingShape;this._width=a.width||0;this._height=a.height||0;this._zindex=a.zindex||0;this._movementRate=a.movementRate||0;this._position=a.position||new hamonengine.geometry.vector2;this._direction=a.direction||new hamonengine.geometry.vector2;this._theta=a.theta||0;this._isSolid=void 0===a.isSolid?!0:!1;this._isMoveable=void 0===a.isMoveable?!1:!0;this._isVisible=void 0===a.isVisible?
!0:!1;console.debug("[hamonengine.entities.object2d.constructor] Name: "+this.name);console.debug("[hamonengine.entities.object2d.constructor] Starting Dimensions {Width: "+this.width+", Height: "+this.height+"}");console.debug("[hamonengine.entities.object2d.constructor] Starting Direction: {x: "+this.direction.x+", y: "+this.direction.y+"}");console.debug("[hamonengine.entities.object2d.constructor] Starting Position: {x: "+this.position.x+", y: "+this.position.y+"}");console.debug("[hamonengine.entities.object2d.constructor] Starting Theta: "+
this.theta);console.debug("[hamonengine.entities.object2d.constructor] Movement Rate: "+this._movementRate);console.debug("[hamonengine.entities.object2d.constructor] isSolid: "+this.isSolid);console.debug("[hamonengine.entities.object2d.constructor] isMoveable: "+this.isMoveable);console.debug("[hamonengine.entities.object2d.constructor] isVisible: "+this.isVisible)};hamonengine.entities.object2d.prototype.move=function(a,b){this.isMoveable&&(b=(void 0===b?null:b)||this.calcMove(a),this.position.x+=
b.x,this.position.y+=b.y)};hamonengine.entities.object2d.prototype.calcMove=function(a){return new hamonengine.geometry.vector2(this._movementRate*this.direction.x*a,this._movementRate*this.direction.y*a)};hamonengine.entities.object2d.prototype.isCollision=function(a){return this.boundingShape.translate(this.position).isCollision(a)};hamonengine.entities.object2d.prototype.isContained=function(a){return this.boundingShape.isContained(a.position,a.boundingShape)};hamonengine.entities.object2d.prototype.render=
function(a,b){};hamonengine.entities.object2d.prototype.toString=function(){return"{name: '"+this.name+"', position: '"+this.position+"'}"};hamonengine.entities.object2d.prototype.onEnvironmentCollision=function(a,b){this._position=a;return!0};hamonengine.entities.object2d.prototype.onObjectCollision=function(a,b,c){};$jscomp.global.Object.defineProperties(hamonengine.entities.object2d.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},position:{configurable:!0,enumerable:!0,
get:function(){return this._position},set:function(a){this._position=a}},direction:{configurable:!0,enumerable:!0,get:function(){return this._direction}},theta:{configurable:!0,enumerable:!0,get:function(){return this._theta||0}},width:{configurable:!0,enumerable:!0,get:function(){return this._width}},height:{configurable:!0,enumerable:!0,get:function(){return this._height}},zIndex:{configurable:!0,enumerable:!0,get:function(){return this._zindex},set:function(a){this._zindex=a}},boundingShape:{configurable:!0,
enumerable:!0,get:function(){return this._boundingShape=this._boundingShape||new hamonengine.geometry.rect(0,0,this.width,this.height)}},isMoveable:{configurable:!0,enumerable:!0,get:function(){return this._isMoveable}},isSolid:{configurable:!0,enumerable:!0,get:function(){return this._isSolid}},isVisible:{configurable:!0,enumerable:!0,get:function(){return this._isVisible},set:function(a){this._isVisible=a}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.cell=function(a){a=void 0===a?{}:a;hamonengine.entities.object2d.call(this,a);this._movementRate=0;this._direction=new hamonengine.geometry.vector2;this._theta=0;this._children=[];this._objects=[];this._zIndexSorter=new hamonengine.math.sort({compareFunc:function(a,c){return a===c?0:a.zIndex<c.zIndex?-1:1}})};$jscomp.inherits(hamonengine.entities.cell,hamonengine.entities.object2d);hamonengine.entities.cell.prototype.addChild=function(a){this._children.push(a)};hamonengine.entities.cell.prototype.addObject=
function(a){this._objects.push(a)};hamonengine.entities.cell.prototype.addObjects=function(a){for(var b=0;b<a.length;b++)this._objects.push(a[b])};hamonengine.entities.cell.prototype.process=function(a){if(this.objects)for(var b=new Set,c=0;c<this.objects.length;c++){var d=this.objects[c];if(d.isMoveable&&(d.move(a),this.isSolid)){var e=hamonengine.geometry.vector2.clone(d.position),f=this.isContained(d);0>f.x?e.x=this.boundingShape.x-d.boundingShape.x:0<f.x&&(e.x=this.boundingShape.width-d.boundingShape.right);
0>f.y?e.y=this.boundingShape.y-d.boundingShape.y:0<f.y&&(e.y=this.boundingShape.height-d.boundingShape.bottom);if(!d.onEnvironmentCollision(e,this))break}for(e=0;e<this.objects.length;e++)if(f=this.objects[e],d!==f){var h=d.name+"->"+f.name;b.has(h)||(b.add(h),b.add(f.name+"->"+d.name))}}};hamonengine.entities.cell.prototype.render=function(a,b){if(this.objects&&(this._zIndexSorter.quickSort(this._objects),this.objects))for(var c=0;c<this.objects.length;c++)this.objects[c].render(a,b)};$jscomp.global.Object.defineProperties(hamonengine.entities.cell.prototype,
{children:{configurable:!0,enumerable:!0,get:function(){return this._children}},objects:{configurable:!0,enumerable:!0,get:function(){return this._objects}}})})();hamonengine.core=hamonengine.core||{};
(function(){var a=["STOPPED","STARTED","LOADING","RUNNING"];hamonengine.core.engine=function(b){var c=this;b=void 0===b?{}:b;console.log("HamonEngine -- Using version: 0.1.2");this._movementRate=b.movementRate||.25;this._size=b.size||64;this._showFPS=void 0!==b.showFPS?b.showFPS:!1;this._syncFrames=void 0!==b.syncFrames?b.syncFrames:!1;this._splashScreenWait=void 0!==b.splashScreenWait?b.splashScreenWait:500;this._detectCanvas=void 0!==b.detectCanvas?b.detectCanvas:!1;this._allowDocumentEventBinding=
void 0!==b.allowDocumentEventBinding?b.allowDocumentEventBinding:!1;this._captureTouchAsMouseEvents=void 0!==b.captureTouchAsMouseEvents?b.captureTouchAsMouseEvents:!0;this._externalElements=b.externalElements||[];this._animationId=this._lastFrameTimeStamp=this._startTimeStamp=this._state=0;this._fpsCounter=new fpscounter;this._layers={};var d=b.canvas||[];if(this._detectCanvas&&0===d.length)console.debug("[hamonengine.core.engine.constructor] DetectCanvas: true.  Attempting to detect all canvas."),
Object.entries(document.getElementsByTagName("canvas")).forEach(function(a){var b=$jscomp.makeIterator(a);a=b.next().value;b=b.next().value;a=b.getAttribute("name")||"canvas"+a;c._layers[a]=new hamonengine.graphics.layer({name:a,canvas:b,allowEventBinding:b.dataset.alloweventbinding,enableImageSmoothing:b.dataset.enableimagesmoothing,clipToViewPort:b.dataset.alloweventbinding})});else{console.debug("[hamonengine.core.engine.constructor] DetectCanvas: false.  Using collection of options.canvas.");
for(var e=0,f=0;f<d.length;f++){var h=d[f],g=h.name||"canvas"+e++;this._layers[g]=new hamonengine.graphics.layer({name:g,canvasId:h.id,viewPort:h.viewPort,allowEventBinding:h.allowEventBinding,enableImageSmoothing:b.enableImageSmoothing,clipToViewPort:h.clipToViewPort})}}this._resourcesLoaded=!1;console.debug("[hamonengine.core.engine.constructor] MovementRate: "+this._movementRate);console.debug("[hamonengine.core.engine.constructor] State: "+a[this._state]);console.debug("[hamonengine.core.engine.constructor] SyncFrames: "+
(this.syncFrames?"Enabled":"Disabled"));console.debug("[hamonengine.core.engine.constructor] SplashScreen Wait Time: "+this._splashScreenWait+" milliseconds.");console.debug("[hamonengine.core.engine.constructor] Global States");console.debug("[hamonengine.core.engine.constructor] hamonengine.geometry.settings.collisionDetection.floor: "+hamonengine.geometry.settings.collisionDetection.floor);console.debug("[hamonengine.core.engine.constructor] hamonengine.geometry.settings.collisionDetection.limit: "+
hamonengine.geometry.settings.collisionDetection.limit);console.debug("[hamonengine.core.engine.constructor] hamonengine.geometry.settings.coordinateSystem: "+hamonengine.geometry.settings.coordinateSystem)};hamonengine.core.engine.prototype.getLayer=function(a){return this._layers[a]};hamonengine.core.engine.prototype.load=function(){var b=this;return $jscomp.executeAsyncGenerator(function(){function c(c,l){for(;;)switch(d){case 0:console.debug("[hamonengine.core.engine.load]");k=new Promise(function(a){b.onPreload()?
setTimeout(function(){return a()},b._splashScreenWait):a()});b._state=2;console.log("[hamonengine.core.engine.load] State: "+a[b._state]);try{h=b.onEventBinding();if(h instanceof Promise){d=3;break}d=-1;throw"onEventBinding is not returning a promise!  This event must return an unhandled promise.";}catch(m){g=m;d=1;break}case 3:try{return console.log("%c[hamonengine.core.engine.load] Engine is paused, waiting for event binding to resolve...","color: yellow"),d=4,{value:h,done:!1}}catch(m){g=m;d=1;
break}case 4:try{if(void 0===l){d=5;break}d=-1;throw l;}catch(m){g=m;d=1;break}case 5:try{console.log("%c[hamonengine.core.engine.load] Engine has resumed loading, event binding has completed.","color: green");f=b.onloadResources();if(f instanceof Promise){d=6;break}d=-1;throw"onloadResources is not returning a promise!  This event must return an unhandled promise.";}catch(m){g=m;d=1;break}case 6:try{return console.log("%c[hamonengine.core.engine.load] Engine is paused, waiting for resources to resolve...",
"color: yellow"),d=7,{value:f,done:!1}}catch(m){g=m;d=1;break}case 7:try{if(void 0===l){d=8;break}d=-1;throw l;}catch(m){g=m;d=1;break}case 8:try{return b._resourcesLoaded=!0,console.log("%c[hamonengine.core.engine.load] Engine has resumed loading, resource loading completed.","color: green"),console.log("%c[hamonengine.core.engine.load] Engine is paused, waiting for preload event to resolve...","color: yellow"),d=9,{value:k,done:!1}}catch(m){g=m;d=1;break}case 9:try{if(void 0===l){d=10;break}d=-1;
throw l;}catch(m){g=m;d=1;break}case 10:try{console.log("%c[hamonengine.core.engine.load] Preload completed.","color: green");d=2;break}catch(m){g=m;d=1;break}case 1:e=g,console.error("[hamonengine.core.engine.load] Resources could not be loaded due to a failure! Stopping the engine."),console.error(e),b.stop({reasons:"A critical error occured during resource loading."});case 2:return d=-1,{value:b,done:!0};default:return{value:void 0,done:!0}}}var d=0,e,f,h,g,k,l={next:function(a){return c(a,void 0)},
throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();l[Symbol.iterator]=function(){return this};return l}())};hamonengine.core.engine.prototype.start=function(){console.debug("[hamonengine.core.engine.start]");2===this._state&&(this._state=1,console.log("[hamonengine.core.engine.start] State: "+a[this._state]),this.fpsCounter.start(),this.onDraw(0));return this};hamonengine.core.engine.prototype.stop=function(b){b=(void 0===b?
{reasons:"Stopped By User"}:b).reasons;console.debug("[hamonengine.core.engine.stop]");window.cancelAnimationFrame(this._animationId);this._state=this._startTimeStamp=this._animationId=0;console.log("[hamonengine.core.engine.stop] State: "+a[this._state]);this.onStop(b);return this};hamonengine.core.engine.prototype.onPreload=function(){console.debug("[hamonengine.core.engine.onPreload]");return!1};hamonengine.core.engine.prototype.onloadResources=function(){return $jscomp.executeAsyncGenerator(function(){function a(a,
b){for(;;)switch(c){case 0:return console.debug("[hamonengine.core.engine.onloadResources]"),c=-1,{value:Promise.resolve(),done:!0};default:return{value:void 0,done:!0}}}var c=0,d={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d}())};hamonengine.core.engine.prototype.onEventBinding=function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function b(b,
c){for(;;)switch(d){case 0:return d=-1,{value:new Promise(function(b,c){window.addEventListener("DOMContentLoaded",function(b){var c=new Map,d=function(b,d){var e=function(b,c){var e=new hamonengine.geometry.vector2(c.offsetX,c.offsetY);a.onMouseEvent(b,e,c,d)},f=function(b,e){var f=c.has(d.name)?c.get(d.name):"";c.set(d.name,b);var g=d.position;if(g){for(var h=[],k=0;k<e.touches.length;k++)h.push(new hamonengine.geometry.vector2(e.touches[k].clientX-g.x,e.touches[k].clientY-g.y));f="end"===b&&"start"===
f;a.onTouchEvent(b,h,e,d);f&&a.onTouchEvent("click",h,e,d);a.captureTouchAsMouseEvents&&(b="start"===b?"down":b,b="end"===b?"up":b,g=new hamonengine.geometry.vector2(e.changedTouches[0].clientX-g.x,e.changedTouches[0].clientY-g.y),a.onMouseEvent(b,g,e,d),f&&a.onMouseEvent("click",g,e,d))}};b.addEventListener("keyup",function(b){return a.onKeyEvent("up",b.code,b,d)});b.addEventListener("keydown",function(b){return a.onKeyEvent("down",b.code,b,d)});b.addEventListener("click",function(a){return e("click",
a)});b.addEventListener("mouseup",function(a){return e("up",a)});b.addEventListener("mousedown",function(a){return e("down",a)});b.addEventListener("mousemove",function(a){return e("move",a)});b.addEventListener("mouseenter",function(a){return e("enter",a)});b.addEventListener("mouseleave",function(a){return e("leave",a)});b.addEventListener("touchstart",function(a){return f("start",a)},{passive:!1});b.addEventListener("touchmove",function(a){return f("move",a)},{passive:!1});b.addEventListener("touchend",
function(a){return f("end",a)},{passive:!1});b.addEventListener("touchcancel",function(a){return f("cancel",a)},{passive:!1})};a.allowDocumentEventBinding&&d(document,a);a.externalElements.forEach(function(a){return d(a,a)});a.layers.forEach(function(a){return a.allowEventBinding&&d(a.canvas,a)})});b()}),done:!0};default:return{value:void 0,done:!0}}}var d=0,e={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
e[Symbol.iterator]=function(){return this};return e}())};hamonengine.core.engine.prototype.onKeyEvent=function(a,c,d,e){d&&d.preventDefault();console.debug("[hamonengine.core.engine.onKeyEvent] Type: '"+a+"' '"+c+"'")};hamonengine.core.engine.prototype.onMouseEvent=function(a,c,d,e){console.debug("[hamonengine.core.engine.onMouseEvent] Type: '"+a+"' '"+c.toString()+"'")};hamonengine.core.engine.prototype.onTouchEvent=function(a,c,d,e){d&&d.preventDefault();console.debug("[hamonengine.core.engine.onTouchEvent] Type: '"+
a+"' '"+d+"'")};hamonengine.core.engine.prototype.onDraw=function(a){var b=this;a=a||0;this._startTimeStamp||(this._startTimeStamp=a);var d=a-this._lastFrameTimeStamp;try{var e=!1;setTimeout(function(){b.onProcessingFrame(d);e=!0},1);this._animationId=window.requestAnimationFrame(function(a){b._state=3;b.syncFrames&&!e||b.onFrame(d);b.onDraw(a)})}catch(f){this.stop(),console.debug(f)}this._lastFrameTimeStamp=a;return this};hamonengine.core.engine.prototype.onFrame=function(a){return this};hamonengine.core.engine.prototype.onProcessingFrame=
function(a){return this};hamonengine.core.engine.prototype.onStop=function(a){return this};$jscomp.global.Object.defineProperties(hamonengine.core.engine.prototype,{primaryLayer:{configurable:!0,enumerable:!0,get:function(){return this._layers.canvas0}},resourcesLoaded:{configurable:!0,enumerable:!0,get:function(){return this._resourcesLoaded}},fpsCounter:{configurable:!0,enumerable:!0,get:function(){return this._fpsCounter}},layers:{configurable:!0,enumerable:!0,get:function(){return Object.values(this._layers)}},
externalElements:{configurable:!0,enumerable:!0,get:function(){return this._externalElements}},syncFrames:{configurable:!0,enumerable:!0,get:function(){return this._syncFrames},set:function(a){this._syncFrames=a}},allowDocumentEventBinding:{configurable:!0,enumerable:!0,get:function(){return this._allowDocumentEventBinding}},captureTouchAsMouseEvents:{configurable:!0,enumerable:!0,get:function(){return this._captureTouchAsMouseEvents},set:function(a){this._captureTouchAsMouseEvents=a}}})})();
