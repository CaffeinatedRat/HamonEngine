/*
 Hamonengine 波紋
 Copyright (c) 2020, CaffeinatedRat.
 All rights reserved.
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

     * Redistributions of source code must retain the above copyright
       notice, this list of conditions and the following disclaimer.
     * Redistributions in binary form must reproduce the above copyright
       notice, this list of conditions and the following disclaimer in the
       documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY
 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE AUTHOR AND CONTRIBUTORS BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var e in b)if("prototype"!=e)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,e);d&&Object.defineProperty(a,e,d)}else a[e]=b[e]};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,e={next:function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,g){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){e(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var d=a[b];delete a[b];try{d()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}};d.prototype.createResolveAndReject_=
function(){function a(a){return function(g){d||(d=!0,a.call(b,g))}}var b=this,d=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(m){this.reject_(m);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var d=this.createResolveAndReject_();try{a.call(b,d.resolve,d.reject)}catch(l){d.reject(l)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{g(a(b))}catch(q){e(q)}}:b}var g,e,f=new d(function(a,
b){g=a;e=b});this.callWhenSettled_(c(a,g),c(b,e));return f};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function d(){switch(c.state_){case 1:a(c.result_);break;case 2:b(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?f.asyncExecute(d):this.onSettledCallbacks_.push(function(){f.asyncExecute(d)})};d.resolve=c;d.reject=function(a){return new d(function(b,d){d(a)})};d.race=function(a){return new d(function(b,
d){for(var e=$jscomp.makeIterator(a),g=e.next();!g.done;g=e.next())c(g.value).callWhenSettled_(b,d)})};d.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?c([]):new d(function(a,d){function g(b){return function(d){f[b]=d;h--;0==h&&a(f)}}var f=[],h=0;do f.push(void 0),h++,c(e.value).callWhenSettled_(g(f.length-1),d),e=b.next();while(!e.done)})};return d},"es6","es3");var hamonengine={debug:!1};hamonengine.util=hamonengine.util||{debug:!1};(function(){hamonengine.util.logger=function(){};hamonengine.util.logger.debug=function(a){hamonengine.util.debug&&console.log(a)};hamonengine.util.bitwise=function(){};hamonengine.util.bitwise.toggle=function(a,b,c){return void 0!==c?c?a|b:a&~b:a^b};hamonengine.util.bitwise.isSet=function(a,b){return(a&b)===b};Object.prototype.forEach=function(a){var b=this;a&&Object.keys(this).forEach(function(c){b.hasOwnProperty(c)&&a(c,b[c])})}})();hamonengine.math=hamonengine.math||{};(function(){Math.PI2=6.283185307179586;Math.PI3_2=3*Math.PI/2;Math.PI_2=Math.PI/2;Math.HalfPI=1.5707963267948966;Math.QuarterPI=4.71238898038469;Math.maxInt32=2147483647;Math.maxUInt32=4294967296;Math.bitRound=function(a){return.5+a<<0};Math.truncate=function(a){return a>=Math.maxInt32?Math.maxInt32:~~a};Math.sqr=function(a){return a*a};Math.toRadians=function(a){return a*Math.PI/180};Math.toRadians=function(a){return 180*a/Math.PI}})();hamonengine.math=hamonengine.math||{};
(function(){hamonengine.math.sort=function(a){a=a||{};this._compareFunc=a.compareFunc?a.compareFunc:sort.ascending};hamonengine.math.sort.prototype.quickSort=function(a){hamonengine.math.sort.iquicksort(this._compareFunc,a,0,a.length-1)};hamonengine.math.sort.ascending=function(a,b){return a==b?0:a<b?-1:1};hamonengine.math.sort.descending=function(a,b){return a==b?0:a<b?1:-1};hamonengine.math.sort.iquicksort=function(a,b,c,e){for(var d=c,f=e,g=b[Math.truncate((c+e)/2)];d<=f;){for(;0>a(b[d],g);)d++;
for(;0<a(b[f],g);)f--;if(d<=f){var h=b[d];b[d]=b[f];b[f]=h;d++;f--}}c<f&&hamonengine.math.sort.iquicksort(a,b,c,f);d<e&&hamonengine.math.sort.iquicksort(a,b,d,e)}})();hamonengine.math=hamonengine.math||{};(function(){var a=Math.maxUInt32;hamonengine.math.LCGRandom=function(a){this._seed=a};hamonengine.math.LCGRandom.prototype.random=function(){return this._seed=(214013*this._seed+2531011)%a}})();hamonengine.geometry=hamonengine.geometry||{};(function(){hamonengine.geometry.rect=function(a){a=a||{};this.x=a.x||0;this.y=a.y||0;this.width=a.width||0;this.height=a.height||0};hamonengine.geometry.rect.prototype.toString=function(){return"x: "+this.x+" y: "+this.y+" width: "+this.width+" height: "+this.height}})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.vector2=function(a,b){this.x=a||0;this.y=b||0};hamonengine.geometry.vector2.prototype.toString=function(){return"x: "+this.x+" y: "+this.y};hamonengine.geometry.vector2.prototype.length=function(){return Math.sqrt(Math.sqr(this.x)+Math.sqr(this.y))};hamonengine.geometry.vector2.prototype.theta=function(){return(Math.atan2(this.y,this.x)+Math.PI2)%Math.PI2};hamonengine.geometry.vector2.prototype.normalize=function(){var a=this.length();return new hamonengine.geometry.vector2(this.x/
a,this.y/a)};hamonengine.geometry.vector2.prototype.mirror=function(){return new hamonengine.geometry.vector2(-this.x,this.y)};hamonengine.geometry.vector2.prototype.flip=function(){return new hamonengine.geometry.vector2(this.x,-this.y)};hamonengine.geometry.vector2.prototype.add=function(a){return new hamonengine.geometry.vector2(this.x+a.x,this.y+a.y)};hamonengine.geometry.vector2.prototype.subtract=function(a){return new hamonengine.geometry.vector2(this.x-a.x,this.y-a.y)};hamonengine.geometry.vector2.prototype.multiplyScalar=
function(a){return new hamonengine.geometry.vector2(this.x*a,this.y*a)};hamonengine.geometry.vector2.prototype.multiplyVector=function(a){return new hamonengine.geometry.vector2(this.x*a.x,this.y*a.y)};hamonengine.geometry.vector2.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y};hamonengine.geometry.vector2.prototype.crossProduct=function(a){return new hamonengine.geometry.vector3(0,0,this.x*a.y-this.y*a.x)}})();hamonengine.geometry=hamonengine.geometry||{};
(function(){hamonengine.geometry.vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};hamonengine.geometry.vector3.prototype.toString=function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z};hamonengine.geometry.vector3.prototype.length=function(){return Math.sqrt(Math.sqr(this.x)+Math.sqr(this.y)+Math.sqr(this.z))};hamonengine.geometry.vector3.prototype.normalize=function(){var a=this.length();return new hamonengine.geometry.vector3(this.x/a,this.y/a,this.z/a)};hamonengine.geometry.vector3.prototype.add=
function(a){return new hamonengine.geometry.vector3(this.x+a.x,this.y+a.y,this.z+a.z)};hamonengine.geometry.vector3.prototype.subtract=function(a){return new hamonengine.geometry.vector3(this.x-a.x,this.y-a.y,this.z-a.z)};hamonengine.geometry.vector3.prototype.multiplyScalar=function(a){return new hamonengine.geometry.vector3(this.x*a,this.y*a,this.z*a)};hamonengine.geometry.vector3.prototype.multiplyVector=function(a){return new hamonengine.geometry.vector3(this.x*a.x,this.y*a.y,this.z*a.z)};hamonengine.geometry.vector3.prototype.dotProduct=
function(a){return this.x*a.x+this.y*a.y+this.z*a.z};hamonengine.geometry.vector3.prototype.crossProduct=function(a){return new hamonengine.geometry.vector3(this.y*a.z-this.z*a.y,a.x*this.z-this.x*a.z,this.x*a.y-this.y*a.x)}})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.layer=function(a){a=a||{};this._canvasId=a.canvasId||"";this._name=a.name||"";this._alpha=void 0!==a.alpha?a.alpha:!1;this._allowEventBinding=void 0!==a.allowEventBinding?a.allowEventBinding:!1;this._wrapVertical=void 0!==a.wrapVertical?a.wrapVertical:!1;this._wrapHorizontal=void 0!==a.wrapHorizontal?a.wrapHorizontal:!1;if(!this._canvasId)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvasId: '"+this._canvasId+"' unable to create the engine!"),
"Cannot create the engine";this._canvas=document.getElementById(this._canvasId);if(!this._canvas)throw console.error("[hamonengine.graphics.layer.constructor] Invalid canvas: '"+this._canvasId+"' unable to create the engine!"),"Cannot create the engine";try{this._canvasContext=this._canvas.getContext("2d",{alpha:this._alpha})}catch(b){}this.enableImageSmoothing(a.enableImageSmoothing);if(!this._canvasContext)throw console.error("[hamonengine.graphics.layer.constructor] Unable to get the 2d context: '"+
this._canvasId+"' unable to create the engine!"),"Cannot create the engine";this._viewPort=a.viewPort||new hamonengine.geometry.rect({x:0,y:0,width:this._canvas.width,height:this._canvas.height});this._wasReset=!1;this._allowSaveStateEnabled=!0;this._viewPortBorderColor=""};hamonengine.graphics.layer.prototype.enableImageSmoothing=function(a){a=void 0===a?!0:a;hamonengine.util.logger.debug("[hamonengine.graphics.layer.constructor] EnableImageSmoothing: "+a);this._enableImageSmoothing=a;try{this.context.webkitImageSmoothingEnabled=
a,this.context.mozImageSmoothingEnabled=a,this.context.imageSmoothingEnabled=a}catch(b){}};hamonengine.graphics.layer.prototype.clear=function(a,b,c,e){c=void 0===c?this.width:c;e=void 0===e?this.height:e;this._wasReset=!1;this.context.clearRect(a,b,c,e)};hamonengine.graphics.layer.prototype.reset=function(){this._wasReset||(this.context.resetTransform(),this._wasReset=!0)};hamonengine.graphics.layer.prototype.save=function(){this.allowSaveState&&this.context.save()};hamonengine.graphics.layer.prototype.restore=
function(){this.allowSaveState&&this.context.restore()};hamonengine.graphics.layer.prototype.beginPainting=function(){this.clear(0,0);this.borderColor&&(this.context.strokeStyle=this.borderColor,this.context.strokeRect(this.viewPort.x,this.viewPort.y,this.viewPort.width,this.viewPort.height));if(0!==this.viewPort.x||0!==this.viewPort.y||this.viewPort.width!==this.width||this.viewPort.height!==this.height)this.context.beginPath(),this.context.rect(this.viewPort.x,this.viewPort.y,this.viewPort.width,
this.viewPort.height),this.context.clip()};hamonengine.graphics.layer.prototype.endPainting=function(){this.reset()};$jscomp.global.Object.defineProperties(hamonengine.graphics.layer.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},allowEventBinding:{configurable:!0,enumerable:!0,get:function(){return this._allowEventBinding}},context:{configurable:!0,enumerable:!0,get:function(){return this._canvasContext}},canvas:{configurable:!0,enumerable:!0,get:function(){return this._canvas}},
width:{configurable:!0,enumerable:!0,get:function(){return this._canvas.width}},height:{configurable:!0,enumerable:!0,get:function(){return this._canvas.height}},offsetX:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetLeft}},offsetY:{configurable:!0,enumerable:!0,get:function(){return this.canvas.offsetTop}},viewPort:{configurable:!0,enumerable:!0,get:function(){return this._viewPort}},wrapHorizontal:{configurable:!0,enumerable:!0,get:function(){return this._wrapHorizontal},
set:function(a){this._wrapHorizontal=a}},wrapVertical:{configurable:!0,enumerable:!0,get:function(){return this._wrapVertical},set:function(a){this._wrapVertical=a}},allowSaveState:{configurable:!0,enumerable:!0,get:function(){return this._allowSaveStateEnabled},set:function(a){this._allowSaveStateEnabled=a}},borderColor:{configurable:!0,enumerable:!0,get:function(){return this._viewPortBorderColor},set:function(a){this._viewPortBorderColor=a}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.sprite=function(a){a=a||{};a instanceof hamonengine.graphics.sprite&&(a={name:a.name,image:a._image,dimensions:a._dimensions,theta:a.theta});this._name=a.name;this._image=a.image;this._dimensions=a.dimensions||new hamonengine.geometry.rect;this._theta=a.theta||0;this._scaleVector=new hamonengine.geometry.vector2(1,1);this._spriteOrientation=0;this._wrappingTestPattern=!1;this._maxWrapping=0;hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] Starting Dimensions: {"+this._dimensions.toString()+
"}");hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] Name: "+this._name);hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] Theta: "+this._theta);hamonengine.util.logger.debug("[hamonengine.graphics.sprite.constructor] ScaleVector: {"+this._scaleVector.toString()+"}")};hamonengine.graphics.sprite.prototype.copyProperties=function(a){this._theta=a.theta;this._scaleVector=a._scaleVector;this._spriteOrientation=a._spriteOrientation;this._wrappingTestPattern=
a._wrappingTestPattern};hamonengine.graphics.sprite.prototype.copy=function(a){return new hamonengine.graphics.sprite(this)};hamonengine.graphics.sprite.prototype.rotate=function(a){this._theta=a||0};hamonengine.graphics.sprite.prototype.scale=function(a,b){this._scaleVector.x=a;this._scaleVector.y=b};hamonengine.graphics.sprite.prototype.mirror=function(a){this._spriteOrientation=hamonengine.util.bitwise.toggle(this._spriteOrientation,2,a)};hamonengine.graphics.sprite.prototype.flip=function(a){this._spriteOrientation=
hamonengine.util.bitwise.toggle(this._spriteOrientation,1,a)};hamonengine.graphics.sprite.prototype.drawRaw=function(a,b,c,e,d,f){d=void 0===d?this._dimensions.width:d;f=void 0===f?this._dimensions.height:f;this._image.complete&&a.context.drawImage(this._image,this._dimensions.x,this._dimensions.y,this._dimensions.width,this._dimensions.height,Math.bitRound(c),Math.bitRound(e),Math.bitRound(d),Math.bitRound(f))};hamonengine.graphics.sprite.prototype.draw=function(a,b,c,e,d,f){d=void 0===d?this._dimensions.width:
d;f=void 0===f?this._dimensions.height:f;c=Math.bitRound(c);e=Math.bitRound(e);var g=Math.bitRound(d/2)+c,h=Math.bitRound(f/2)+e,m=hamonengine.util.bitwise.isSet(this._spriteOrientation,1)?-1:1,l=hamonengine.util.bitwise.isSet(this._spriteOrientation,2)?-1:1;a.save();if(1!==this._scaleVector.x||1!==this._scaleVector.y)a.context.translate(c,e),a.context.scale(this._scaleVector.x,this._scaleVector.y),a.context.translate(-c,-e);0<this._spriteOrientation&&(a.context.translate(g,h),a.context.scale(l,m),
a.context.translate(-g,-h));0!==this.theta&&(a.context.translate(g,h),a.context.rotate(this.theta),a.context.translate(-g,-h));(a.wrapHorizontal||a.wrapVertical)&&this.wrappingTestPattern&&(this.drawRaw(a,b,c+.25*a.viewPort.width,e,d,f),this.drawRaw(a,b,c-.25*a.viewPort.width,e,d,f),this.drawRaw(a,b,c,e+.25*a.viewPort.height,d,f),this.drawRaw(a,b,c,e-.25*a.viewPort.height,d,f));this.drawRaw(a,b,c,e,d,f);if(a.wrapHorizontal||a.wrapVertical){h=Math.cos(-this.theta);var p=Math.sin(-this.theta),k=d*this._scaleVector.x;
g=f*this._scaleVector.y;if(a.wrapHorizontal){var n=a.viewPort.width/this._scaleVector.x*l;l=Math.bitRound(h*n);n=Math.bitRound(p*n);if(c-k<=a.viewPort.x){if(k=Math.abs(parseInt((c-k)/a.viewPort.width))+1,0===this._maxWrapping||k<this._maxWrapping)this.drawRaw(a,b,c+l*k,e+n*k,d,f),0<--k&&this.drawRaw(a,b,c+l*k,e+n*k,d,f)}else c+k>=a.viewPort.width&&(k=parseInt((c+k)/a.viewPort.width),0===this._maxWrapping||k<this._maxWrapping)&&(this.drawRaw(a,b,c-l*k,e-n*k,d,f),0<--k&&this.drawRaw(a,b,c-l*k,e-n*k,
d,f))}if(a.wrapVertical)if(l=a.viewPort.height/this._scaleVector.y*m,m=Math.bitRound(p*l),h=Math.bitRound(h*l),e-g<=a.viewPort.y){if(g=Math.abs(parseInt((e-g)/a.viewPort.height))+1,0===this._maxWrapping||g<this._maxWrapping)this.drawRaw(a,b,c-m*g,e+h*g,d,f),0<--g&&this.drawRaw(a,b,c-m*g,e+h*g,d,f)}else e+g>=a.viewPort.height&&(g=parseInt((e+g)/a.viewPort.height),0===this._maxWrapping||g<this._maxWrapping)&&(this.drawRaw(a,b,c+m*g,e-h*g,d,f),0<--g&&this.drawRaw(a,b,c+m*g,e-h*g,d,f))}a.restore()};$jscomp.global.Object.defineProperties(hamonengine.graphics.sprite.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},theta:{configurable:!0,enumerable:!0,get:function(){return this._theta}},wrappingTestPattern:{configurable:!0,enumerable:!0,get:function(){return this._wrappingTestPattern},set:function(a){this._wrappingTestPattern=a}},maxWrapping:{configurable:!0,enumerable:!0,set:function(a){this._maxWrapping=a}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.animsprite=function(a){hamonengine.graphics.sprite.call(this,a=a||{});a instanceof hamonengine.graphics.animsprite&&(a={frames:a._frames,animationRate:a._animationRate,animationCycles:a._animationCycles});this._frames=a.frames||[];this._animationRate=a.animationRate||0;this._animationCycles=a.animationCycles||-1;this._numberOfAnimationCycles=this._timeSinceLastFrame=this._index=0;this._enableAnimation=!0;hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Rate: "+this._animationRate);
hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Animation Cycle: "+this._animationCycles);hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Index: "+this._index);hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.constructor] Starting Enable Animation: "+this._enableAnimation)};$jscomp.inherits(hamonengine.graphics.animsprite,hamonengine.graphics.sprite);hamonengine.graphics.animsprite.prototype.copy=function(a){return new hamonengine.graphics.animsprite(this)};
hamonengine.graphics.animsprite.prototype.start=function(){this._enableAnimation=!0;this._numberOfAnimationCycles=0};hamonengine.graphics.animsprite.prototype.stop=function(){this._enableAnimation=!1};hamonengine.graphics.animsprite.prototype.pause=function(){this._enableAnimation=!this._enableAnimation};hamonengine.graphics.animsprite.prototype.addFrame=function(a){hamonengine.util.logger.debug("[hamonengine.graphics.animsprite.animsprite.addFrame]");this._frames.push(a)};hamonengine.graphics.animsprite.prototype.draw=
function(a,b,c,e,d,f){d=void 0===d?null:d;f=void 0===f?null:f;var g=this._timeSinceLastFrame+b;if(this._enableAnimation){var h=parseInt(g/this.animationRate);h=this.index+h;-1<this.animationCycles&&(this._numberOfAnimationCycles+=parseInt(h/this._frames.length),this._enableAnimation=this._numberOfAnimationCycles<=this.animationCycles);this.index=h%this._frames.length}0<this._frames.length&&(this._frames[this.index].copyProperties(this),this._frames[this.index].draw(a,b,c,e,d,f));this._timeSinceLastFrame=
g%this.animationRate};$jscomp.global.Object.defineProperties(hamonengine.graphics.animsprite.prototype,{index:{configurable:!0,enumerable:!0,get:function(){return this._index},set:function(a){this._index=a%this._frames.length||0}},animationRate:{configurable:!0,enumerable:!0,get:function(){return this._animationRate},set:function(a){this._animationRate=a}},animationCycles:{configurable:!0,enumerable:!0,get:function(){return this._animationCycles},set:function(a){this._animationCycles=a;this._enableAnimation=
!0}}})})();hamonengine.graphics=hamonengine.graphics||{};
(function(){hamonengine.graphics.spritesheet=function(a){this._imageResource=new Image;this._sprites={};this._spriteIndex=[];this._state=0};hamonengine.graphics.spritesheet.prototype.load=function(a){var b=this;return new Promise(function(c,e){b._imageResource.src=a.spritesheetUrl;b._state=1;b._imageResource.addEventListener("load",function(){b._state=2;c()},!1);b._imageResource.addEventListener("error",function(a){b._state=3;e("The image '"+(a&&a.path&&0<a.path.length&&a.path[0].src||"")+"' could not be loaded.",
a)},!1);a.sprites.forEach(function(a){b._spriteIndex.push(a.name);b._sprites[a.name]=new hamonengine.graphics.sprite({image:b._imageResource,name:a.name,dimensions:new hamonengine.geometry.rect({x:a.x,y:a.y,width:a.width,height:a.height})})});a.animSprites.forEach(function(a){var d=new hamonengine.graphics.animsprite({animationRate:a.animationRate});a.frames.forEach(function(a){d.addFrame(new hamonengine.graphics.sprite({image:b._imageResource,name:a.name,dimensions:new hamonengine.geometry.rect({x:a.x,
y:a.y,width:a.width,height:a.height})}))});b._spriteIndex.push(a.name);b._sprites[a.name]=d})})};hamonengine.graphics.spritesheet.prototype.getSprite=function(a){return this._sprites[a].copy()};hamonengine.graphics.spritesheet.prototype.getSpriteByOrdinal=function(a){return this._sprites[this._spriteIndex[a]]};$jscomp.global.Object.defineProperties(hamonengine.graphics.spritesheet.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this._spriteIndex.length}},isLoaded:{configurable:!0,
enumerable:!0,get:function(){return 2===this._state}}})})();hamonengine.entities=hamonengine.entities||{};
(function(){hamonengine.entities.object2d=function(a){a=a||{};this._name=a.name||"";this._boundingBox=a.boundingBox;this._width=a.width;this._height=a.height;this._movementRate=a.movementRate||0;this._position=a.position||new hamonengine.geometry.vector2;this._direction=a.direction||new hamonengine.geometry.vector2;this._theta=a.theta||0;hamonengine.util.logger.debug("[hamonengine.entities.actor.constructor] Starting Dimensions {Width: "+this.width+", Height: "+this.height+"}");hamonengine.util.logger.debug("[hamonengine.entities.actor.constructor] Starting Direction: {x: "+
this.direction.x+", y: "+this.direction.y+"}");hamonengine.util.logger.debug("[hamonengine.entities.actor.constructor] Starting Position: {x: "+this.position.x+", y: "+this.position.y+"}");hamonengine.util.logger.debug("[hamonengine.entities.actor.constructor] Movement Rate: "+this._movementRate)};hamonengine.entities.object2d.prototype.move=function(a){this.position.x+=this._movementRate*this.direction.x*a;this.position.y+=this._movementRate*this.direction.y*a};hamonengine.entities.object2d.prototype.isCollision=
function(a,b){a-=this.position.x;b-=this.position.y;return 0<=a&&a<=this._boundingBox.width&&0<=b&&b<=this._boundingBox.height};hamonengine.entities.object2d.prototype.render=function(a){};$jscomp.global.Object.defineProperties(hamonengine.entities.object2d.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},position:{configurable:!0,enumerable:!0,get:function(){return this._position}},direction:{configurable:!0,enumerable:!0,get:function(){return this._direction}},theta:{configurable:!0,
enumerable:!0,get:function(){return this._theta||0}},width:{configurable:!0,enumerable:!0,get:function(){return this._width}},height:{configurable:!0,enumerable:!0,get:function(){return this._height}},boundingBox:{configurable:!0,enumerable:!0,get:function(){return this._boundingBox=this._boundingBox||new hamonengine.geometry.rect({x:0,y:0,width:this.width,height:this.height})}}})})();hamonengine.core=hamonengine.core||{};
(function(){hamonengine.core.engine=function(a){var b=this;a=a||{};hamonengine.util.logger.debug("HamonEngine -- Using version: 0.1.0");this._movementRate=a.movementRate||.25;this._size=a.size||64;this._lastFrameTimeStamp=this._startTimeStamp=this._state=0;this._testIndex=12;this._layers={};var c=0;a.canvas.forEach(function(e){var d=e.name||"canvas"+c++;b._layers[d]=new hamonengine.graphics.layer({name:d,canvasId:e.id,viewPort:e.viewPort,allowEventBinding:e.allowEventBinding,enableImageSmoothing:a.enableImageSmoothing})});
this._resourcesLoaded=!1;hamonengine.util.logger.debug("[hamonengine.core.engine.constructor] MovementRate: "+this._movementRate);hamonengine.util.logger.debug("[hamonengine.core.engine.constructor] State: "+this._state)};hamonengine.core.engine.prototype.getLayer=function(a){return this._layers[a]};hamonengine.core.engine.prototype.load=function(){var a=this;hamonengine.util.logger.debug("[hamonengine.core.engine.load]");this._state=2;hamonengine.util.logger.debug("[hamonengine.core.engine.constructor] State: "+
this._state);this._stats=new Stats;this._stats.domElement.style.position="absolute";this._stats.domElement.style.left="0px";this._stats.domElement.style.top="0px";var b=document.getElementById("canvas-wrapper");b.insertBefore(this._stats.domElement,b.firstChild);this.onEventBinding().then(function(){hamonengine.util.logger.debug("[hamonengine.core.engine.load] Event binding completed.")});this.onloadResources().then(function(){a._resourcesLoaded=!0;hamonengine.util.logger.debug("[hamonengine.core.engine.load] Load resources completed.")}).catch(function(b){hamonengine.util.logger.debug("[hamonengine.core.engine.load] Failed!");
a.stop()});return this};hamonengine.core.engine.prototype.start=function(){hamonengine.util.logger.debug("[hamonengine.core.engine.start]");2===this._state&&(this._state=1,hamonengine.util.logger.debug("[hamonengine.core.engine.start] State: "+this._state),this.onDraw(0));return this};hamonengine.core.engine.prototype.stop=function(){hamonengine.util.logger.debug("[hamonengine.core.engine.stop]");window.cancelAnimationFrame(this._animationId);this._state=this._startTimeStamp=this._animationId=0;hamonengine.util.logger.debug("[hamonengine.core.engine.stop] State: "+
this._state);return this};hamonengine.core.engine.prototype.onloadResources=function(){hamonengine.util.logger.debug("[hamonengine.core.engine.onloadResources]")};hamonengine.core.engine.prototype.onEventBinding=function(){var a=this;return new Promise(function(b,c){window.addEventListener("DOMContentLoaded",function(b){a._layers.forEach(function(b,c){c.allowEventBinding&&(c.canvas.addEventListener("keyup",function(b){a.onKeyUp(b.code,b,c)}),c.canvas.addEventListener("keydown",function(b){a.onKeyDown(b.code,
b,c)}),c.canvas.addEventListener("click",function(b){a.onMouseClick(b,c)}),c.canvas.addEventListener("mouseup",function(b){a.onMouseUp(new hamonengine.geometry.vector2(b.clientX,b.clientY),b,c)}),c.canvas.addEventListener("mousedown",function(b){a.onMouseDown(new hamonengine.geometry.vector2(b.clientX,b.clientY),b,c)}),c.canvas.addEventListener("touchstart",function(b){for(var d=[],e=0;e<b.touches.length;e++)d.push({left:b.touches[e].clientX-(c.offsetX||0),top:b.touches[e].clientY-(c.offsetY||0)});
a.onTouchStart(b,d,c)}),c.canvas.addEventListener("touchend",function(b){a.onTouchEnd(b,c)}),c.canvas.addEventListener("touchcancel",function(b){a.onTouchCancel(b,c)}),c.canvas.addEventListener("touchmove",function(b){for(var d=[],e=0;e<b.touches.length;e++)d.push({left:b.touches[e].clientX-(c.offsetX||0),top:b.touches[e].clientY-(c.offsetY||0)});a.onTouchMove(b,d,c)}))})});b()})};hamonengine.core.engine.prototype.onMouseClick=function(a,b){hamonengine.util.logger.debug("[hamonengine.core.engine.onMouseClick] '"+
a+"'")};hamonengine.core.engine.prototype.onMouseUp=function(a,b,c){hamonengine.util.logger.debug("[hamonengine.core.engine.onMouseUp] '"+a.toString()+"'")};hamonengine.core.engine.prototype.onMouseDown=function(a,b,c){hamonengine.util.logger.debug("[hamonengine.core.engine.onMouseDown] '"+a.toString()+"'")};hamonengine.core.engine.prototype.onKeyUp=function(a,b,c){hamonengine.util.logger.debug("[hamonengine.core.engine.onKeyUp] '"+a+"'")};hamonengine.core.engine.prototype.onKeyDown=function(a,b,
c){hamonengine.util.logger.debug("[hamonengine.core.engine.onKeyDown] '"+a+"'")};hamonengine.core.engine.prototype.onTouchStart=function(a,b,c){a.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchStart] '"+a+"'")};hamonengine.core.engine.prototype.onTouchMove=function(a,b,c){a.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchMove] '"+a+"'")};hamonengine.core.engine.prototype.onTouchEnd=function(a,b){a.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchEnd] '"+
a+"'")};hamonengine.core.engine.prototype.onTouchCancel=function(a,b){a.preventDefault();hamonengine.util.logger.debug("[hamonengine.core.engine.onTouchCancel] '"+a+"'")};hamonengine.core.engine.prototype.onDraw=function(a){var b=this;a=a||0;this._startTimeStamp||(this._startTimeStamp=a);var c=a-this._lastFrameTimeStamp;try{this._animationId=window.requestAnimationFrame(function(a){b._state=3;b._stats.begin();b.onFrame(c);b._stats.end();b.onDraw(a)})}catch(e){this.stop(),hamonengine.util.logger.debug(e)}this._lastFrameTimeStamp=
a;return this};hamonengine.core.engine.prototype.onFrame=function(a){return this};$jscomp.global.Object.defineProperties(hamonengine.core.engine.prototype,{primaryLayer:{configurable:!0,enumerable:!0,get:function(){return this._layers.canvas0}},resourcesLoaded:{configurable:!0,enumerable:!0,get:function(){return this._resourcesLoaded}}})})();
